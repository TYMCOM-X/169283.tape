MODULE GAMI(DOLLAR, ENTRIES=($CING), FSAVE,TIMING,
                        TIMER=EXTERNAL(SIX12) )=
BEGIN

REQUIRE KDEFS.BLI[7,107355];
REQUIRE CDEFS.BLI[7,107355];
REQUIRE FDEFS.BLI[7,107355];
REQUIRE GDEFS.BLI[7,107355];

UNDECLARE $CING;


GLOBAL ROUTINE $CING(BUF)=
  BEGIN
  MAP G$ BUF;
  LOCAL TKNSIZ;
  LOCAL KFCB$ FCB;
  FCB_.CFLCB$[CV$GAMMAIN];
  IF .FCB[K$EOFILE]  %TEST FOR HARD E-O-F%
    THEN  $FATAL(#412); %TO BE EXPANDED TO USE UOUT%
  FCB[K$DCNT]_1;
  FCB[K$DADR]_.BUF;
  $KREAD(FCB);
  IF (TKNSIZ _ .BUF[G$LENGTH]) GTR GV$MAXGREC  OR
      .TKNSIZ LEQ 0
    THEN %INSERT CODE HERE TO EXPAND ON ERROR USING UOUT%
         $FATAL(#421);
  FCB[K$DCNT]_.TKNSIZ-1;
  FCB[K$DADR]_.BUF+1;
  $KREAD(FCB);
  CACTI$[CV$GAMMAIN]_.CACTI$[CV$GAMMAIN]+1;
  RETURN .TKNSIZ
  END;

%THIS ROUTINE WILL EVENTUALLY BE EXPANDED TO ALLOW FOR
 TRANSFER OF TOKENS TO CORE AS AN ALTERNATIVE TO DISK WHEN
 "FILE" SIZE PERMITS.
%

END
ELUDOM
