100 '     C O R R
102 '     -------
104 '
106 '     COMPANY PROPRIETARY, LUPFER & LONG COMP. SERV.
107 '
108 '     CORR6 - VERSION 1.0
109 '
110 DIM F(16,15),H(72),N$(15),U$(30),L$(400)
115 DIM I(132),O(132)
120 DIM T(50),Z(15)
130 DIM R$(15),G$(15),F$(10)
135 '
140 DEF FNN                      '  FNN=1 IF R$ IS NUMERIC
142   FNN=0
144   CHANGE R$ TO T
145   IF T(0)=0 GO TO 156
146   FOR T1=1 TO T(0)
148     IF T(T1) < ASC(0) GO TO 156
150     IF T(T1) > ASC(9) GO TO 156
152   NEXT T1
154   FNN=1
156 FNEND
158 '
160 FILE #1, "COMCOM.TMP"
170 MAT READ #1, F$
190 '
230 FILE :1:F$(3)
235   GOSUB 8000
240 FILE :2:F$(4)
244 '
246 FOR I=1 TO O9		'  INITIALIZE "STATE" OF FIELDS
248   Z(I)=0
250   IF F(2,I)=0 GO TO 254
252     Z(I)=1
254 NEXT I
256 '
260 READ :2: I$
270 CHANGE I$ TO I
275 GOSUB 6100
280 N9=100*I(3)+I(4)
290 D1$="/"
300 D1=ASC(/)
310 GOSUB 2500               '   EXPL. FORM
315 PRINT
320 PRINT "TYPE 'DONE' WHEN FINISHED"
325 PRINT
330 REM ========= START ==========
340 PRINT
350 PRINT "ENTRY #";
360 '   - DISPLAY -
370 INPUT R$
372   IF R$="DONE" GO TO 720
374   IF FNN=0 GO TO 350
376   N7=VAL(R$)
380   IF N7<1 GO TO 720
390   IF N7>N9 GO TO 350
400 PRINT
410 SET :2, N7+1
420 READ :2: I$
430   CHANGE I$ TO I
440 PRINT "  OLD: ";
450   FOR J1=1 TO H(8)
460     IF Z(J1)=0 GO TO 510
470     GOSUB 1100               '   EXT. & FORMAT
480     IF J1=1 GO TO 500
490     PRINT D1$;
500     PRINT G$(J1);
510   NEXT J1
520   PRINT
530 REM ------ NEW TRANS --------
540 SET :2, N7+1
550 PRINT "  NEW";
560 INPUT R$
565   IF R$="" GO TO 330
570   IF R$="NO" GO TO 330
580   IF R$="DONE" GO TO 720
590   GOSUB 2200		'  BREAK
600   IF N1=Z8 GO TO 630
610     PRINT "YOU FORGOT A FIELD - RETYPE ENTRY"
620     GO TO 550
630 FOR J1=1 TO H(8)
640   IF Z(J1)=0 GO TO 690
650   IF R$(J1)<>"^" GO TO 670
660     R$(J1)=G$(J1)
670 GOSUB 3000			' EDIT
680   IF E1<>0 GO TO 550
690 NEXT J1
700 GOSUB 1760
710 GO TO 330
720 REM ------- DONE ------------
730 CHAIN F$(10)+F$(9)
1010 REM ======== SUBROUTINES ========
1020 '
1100 REM ----- EXT. & FORMAT -------
1110 K1=0
1120 FOR K2=F(13,J1) TO F(13,J1)+F(6,J1)-1
1130   K1=K1+1
1140   T(K1)=I(K2)
1150 NEXT K2
1160 T(0)=K1
1170 '   - DECODE FORMAT -
1172 IF F(2,J1)<>H(10) GO TO 1180
1174   V3=F(8,J1)
1176   GO TO 1326
1180 IF F(5,J1)=2 GO TO 1220
1190 IF F(5,J1)=3 GO TO 1350
1200 IF F(5,J1)=4 GO TO 1280
1210   GO TO 1440
1220 '   - STRING -
1230 FOR K1=T(0) TO 1 STEP -1
1240   IF T(K1)<>ASC(SP) GO TO 1260
1250 NEXT K1
1260 T(0)=K1
1270 GO TO 1440
1280 '   - $$ -
1290 FOR K1=T(0) TO T(0)-3 STEP -1
1300   T(K1+1)=T(K1)
1310 NEXT K1
1320 T(0)=T(0)+1
1322 T(T(0)-3)=ASC(.)
1324 V3=4
1326 '   - LEFT STRIP -
1328 FOR K1=1 TO T(0)-V3+1
1330   IF T(K1)<>ASC(0) GO TO 1334
1332 NEXT K1
1334 K3=0
1336 FOR K2=K1 TO T(0)
1338   K3=K3+1
1340   T(K3)=T(K2)
1342 NEXT K2
1344 T(0)=K3
1346 GO TO 1440
1350 '   - DATE -
1360 T(0)=8
1370 T(7)=T(1)
1380 T(8)=T(2)
1390 T(1)=T(3)
1400 T(2)=T(4)
1410 T(4)=T(5)
1420 T(5)=T(6)
1425 T(3)=ASC(-)
1430 T(6)=ASC(-)
1440 '   - RETURN -
1450 CHANGE T TO G$(J1)
1460 RETURN
1520 REM ------ BOMB ---------
1530 PRINT "SYSTEM ERROR - CORR"
1540 STOP
1760 REM ----- TRANS TO FILE ------
1770 O(0)=H(6)
1775 FOR J=1 TO O(0)
1780   O(J)=ASC(0)
1785 NEXT J
1790 O(1)=INT(N7/100)
1792 O(2)=INT(N7-100*O(1))
1794 O(1)=O(1)+20
1796 O(2)=O(2)+20
1800 FOR J1=1 TO H(8)
1810   IF Z(J1)=0 GO TO 1890
1820   IF Z(J1)>1 GO TO 1840
1830   G$(J1)=R$(J1)
1840   CHANGE G$(J1) TO T
1850   FOR K1=1 TO T(0)
1860     K2=F(13,J1)+K1-1
1862   IF K2<1 GO TO 1520
1870     O(K2)=T(K1)
1880   NEXT K1
1890 NEXT J1
1900 CHANGE O TO O$
1910 WRITE :2: O$
1920 RETURN
2100 REM ------ YES/NO -------
2110 PRINT
2120 PRINT Q$;
2130 INPUT R$
2140   IF R$="YES" GO TO 2180
2150   IF R$="NO" GO TO 2180
2160 PRINT "PLEASE ANSWER 'YES' OR 'NO'"
2170   GO TO 2100
2180 RETURN
2200 REM ------ BREAK ---------
2210 CHANGE R$ TO I
2220 I(I(0)+1)=D1
2230 K1=1
2240 J1=N1=0
2250 FOR K2=1 TO I(0)+1
2260   IF I(K2)<>D1 GO TO 2400
2270   N1=N1+1
2280   J1=J1+1
2290   IF J1>O9 GO TO 2410
2300   IF Z(J1)<>1 GO TO 2280
2310   T(0)=K2-K1
2320   IF T(0)>0 GO TO 2350
2330     R$(J1)="?"
2340     GO TO 2390
2350   FOR J=1 TO T(0)
2360     T(J)=I(J+K1-1)
2370   NEXT J
2380   CHANGE T TO R$(J1)
2390   K1=K2+1
2400 NEXT K2
2410 RETURN
2500 REM ---- EXPL. FORM, COUNT FIELDS -----
2504 PRINT
2510 PRINT
2520 PRINT "TRANSACTION FORMAT IS:"
2530 PRINT
2540 Z8=0
2550 FOR J1=1 TO H(8)
2560   IF Z(J1)<>1 GO TO 2590
2562   IF Z8>0 GO TO 2570
2564     PRINT "   ";N$(J1);
2566     GO TO 2580
2570   PRINT D1$;N$(J1);
2580   Z8=Z8+1
2590 NEXT J1
2600 PRINT
2610 RETURN
3000 REM ------ EDIT ----------
3010 E1=0
3020 E1$="-"
3030 CHANGE R$(J1) TO T
3040 L6=F(6,J1)
3050 IF F(5,J1)<>3 GO TO 3070
3060   L6=8
3070 REM    - START -
3080 REM
3090 REM     - $ FIELD -
3100 IF F(5,J1)<>4 GO TO 3300
3110 IF T(T(0))=ASC(-) GO TO 3160
3120 IF T(T(0))=ASC(+) GO TO 3150
3130 IF T(T(0))=32     GO TO 3150
3140   T(0)=T(0)+1
3150   T(T(0))=32
3160 IF T(0)<4 GO TO 3270
3170 IF T(T(0)-3)<>ASC(.) GO TO 3270
3180   T(T(0)-3)=ASC(,)
3190 K2=0
3200 FOR K1=1 TO T(0)
3210   IF T(K1)=ASC(,) GO TO 3240
3220   K2=K2+1
3230   T(K2)=T(K1)
3240 NEXT K1
3250 T(0)=K2
3260   GO TO 3300
3270 E1$="NO DECIMAL"
3280   GO TO 4120
3290 REM
3300 REM     - LENGTH -
3310 IF F(5,J1)=3 GO TO 3380
3320 IF T(0)>L6 GO TO 3350
3330 IF T(0)<F(9,J1) GO TO 3350
3340   GO TO 3380
3350 E1$="INCORRECT LENGTH"
3360   GO TO 4120
3370 REM
3380 REM     - FILL -
3390 IF T(0)>=L6 GO TO 3560
3400   D=L6-T(0)
3410   IF F(5,J1)=2 GO TO 3500
3420 REM    "0"
3430 FOR K1=L6 TO 1 STEP -1
3440   IF K1<=D GO TO 3470
3450   T(K1)=T(K1-D)
3460     GO TO 3480
3470   T(K1)=ASC(0)
3480 NEXT K1
3490 GO TO 3540
3500 REM    " "
3510 FOR K1=T(0)+1 TO L6
3520   T(K1)=32
3530 NEXT K1
3540 T(0)=L6
3550 REM
3560 REM     - DATE -
3570 IF F(5,J1)<>3 GO TO 3790
3580 IF T(6)<>ASC(-) GO TO 3760
3590 IF T(3)= ASC(-) GO TO 3650
3600 IF T(4)<>ASC(-) GO TO 3760
3610   FOR K1=1 TO 3
3620     T(K1)=T(K1+1)
3630   NEXT K1
3640   T(4)=ASC(0)
3650 T(6)=T(5)
3690 T(5)=T(4)
3700 T(4)=T(2)
3710 T(3)=T(1)
3720 T(1)=T(7)
3730 T(2)=T(8)
3740 T(0)=6
3742 IF T(1)<>ASC(7) GO TO 4120
3744 IF (T(3)-ASC(0))*10 + T(4)-ASC(0) > 12 GO TO 4120
3746 IF (T(5)-ASC(0))*10 + T(6)-ASC(0) > 31 GO TO 4120
3750   GO TO 3790
3760 E1$="USE FORM 'MM-DD-YY'"
3770   GO TO 4120
3790 REM     - NUMERIC -
3800 IF F(5,J1)=2 GO TO 3910
3810 T1=T(0)
3820 IF F(5,J1)<>4 GO TO 3840
3830   T1=T1-1
3840 FOR K1=1 TO T1
3850   IF T(K1)>ASC(9) GO TO 3890
3860   IF T(K1)<ASC(0) GO TO 3890
3870 NEXT K1
3880   GO TO 3910
3890 E1$="NON-NUMERIC CHARACTER"
3900   GO TO 4120
3910 REM      END
3920 REM
3930 REM    - BACK TO STRING -
3940 CHANGE T TO R$(J1)
3950 REM
3960 REM     - LIST -
3970 IF F(3,J1)<>1 GO TO 4040
3980 FOR I=F(11,J1) TO F(11,J1)+F(12,J1)-1
3990   IF R$(J1)=L$(I) GO TO 4150
4000 NEXT I
4010 E1$="NOT IN LIST"
4020   GO TO 4120
4030 REM
4040 REM     - RANGE -
4050 IF F(3,J1)<>2 GO TO 4150
4060 IF R$(J1)<U$(J1) GO TO 4090
4070 IF R$(J1)>U$(O9+J1) GO TO 4090
4080   GO TO 4150
4090 E1$="OUT OF RANGE"
4100   GO TO 4120
4110 REM
4120 PRINT N$(J1);" IN ERROR - ";E1$;" - RE-TYPE LINE"
4130 E1=1
4140 CHANGE T TO R$(J1)
4150 RETURN
6000 REM --- KLUDGE CHAR SET FOR PDP-10 ---
6010 FOR K1=1 TO O(0)
6020   IF O(K1)>13 GO TO 6040
6030     O(K1)=100+O(K1)
6040 NEXT K1
6050 RETURN
6100 REM ---- UNKLUDGE PDP-10 CHARS -----
6110 FOR K1=1 TO I(0)
6120   IF I(K1)<100 GO TO 6140
6130     I(K1)=I(K1)-100
6140 NEXT K1
6150 RETURN
8000 REM ---READ STRUCTURE FILE---
8005 O9=15
8010 GOSUB 8400
8015 CHANGE I$ TO I
8020 GOSUB 6100
8025 FOR Y=0 TO I(0)
8030   H(Y)=I(Y)
8035 NEXT Y
8040 N$=MID$(I$,20,13)
8045 N$(0)=MID$(I$,34,H(33))
8050 FOR T2=1 TO H(3)
8055   GOSUB 8400
8060   CHANGE I$ TO I
8065   GOSUB 6100
8070   T3=I(2)
8075   FOR T1=1 TO 16
8080     F(T1,T3)=I(T1)
8085   NEXT T1
8088   F(11,T3)=100*F(15,T3)+F(11,T3)
8090   F(12,T3)=100*F(16,T3)+F(12,T3)
8095   N$(T3)=MID$(I$,17,I(7))
8130 NEXT T2
8135 L=1
8140 T5=1
8145 FOR T1=1 TO H(8)
8150   IF F(3,T1)<>1 THEN 8205
8155   FOR T2=1 TO F(10,T1)
8160     GOSUB 8400
8165     T4=1
8170     FOR T3=1 TO INT(132/F(6,T1))
8175       L$(L)=MID$(I$,T4,F(6,T1))
8180       T4=T4+F(6,T1)
8185     L=L+1
8190     IF L-T5=F(12,T1) THEN 8205
8195     NEXT T3
8200   NEXT T2
8205   T5=L
8210 NEXT T1
8215 IF H(5)=0 GO TO 8260
8220 FOR T1=1 TO H(5)
8225   GOSUB 8400
8230   CHANGE I$ TO I
8235   GOSUB 6100
8240   T2=I(1)
8245   U$(T2)=MID$(I$,2,F(6,T2))
8250   U$(T2+O9)=MID$(I$,2+F(6,T2),F(6,T2))
8255 NEXT T1
8260 F(13,0)=1
8265 F(6,0)=2
8270 RETURN
8400 REM -----READ WITH RETRY -------
8405 READ :1: I$
8410 SET :1, LOC(1)-1
8415 READ :1: S$
8420 IF I$=S$ GO TO 8435
8425   SET :1, LOC(1)-1
8430   GO TO 8405
8435 RETURN
9999 END
