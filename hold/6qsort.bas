1000 REM 		------SORT ONE BUFFER------
1002 '
1010 '			SET-UP
1012 X1=X
1014 X=1
1016 C=0
1018 T1=0
1020 FOR I=0 TO B9
1022   P(I)=0
1024 NEXT I
1030 '			SORT
1032 IF K$(X)=>K$(C) THEN 1044
1034 C=P(0)
1036 IF K$(X)=>K$(C) THEN 1044
1038 T1=P(0)
1040 C=0
1042   GO TO 1054
1044 T1=P(C)
1046 IF T1=0 THEN 1054
1048 IF K$(T1)>K$(X) THEN 1054
1050 C=T1
1052   GO TO 1044
1054 P(X)=T1
1056 P(C)=X
1058 C=X
1060 X=X+1
1062 IF X<=X1 THEN 1032
1100 '		-----EMPTY THE BUFFER------
1110 IF S1$="CORE" THEN 1150
1118 '			COPY BUFFER TO WORK FILE
1120 X=P(0)
1122 T$="00000" + STR$(I(X))	B_'BUILD POINTER
1124 P$=RIGHT$(T$,6)
1130 O$=K$(X) + P$		'OUTPUT IS KEY AND POINTER
1132 WRITE :2: O$
1134 X=P(X)
1140 IF X>0 THEN 1122
1150 IF S1$<> "MORE" THEN 1210
1152 K1=K1+1
1198   GO TO 765		'GO GET ANOTHER BUFFER
1200 '		-----SORT DONE - COPY REAL FILE------
1202 '
1210 IF S1-0 THEN 1218
1212 FILE #4, "COMMOD.TMP"
1212 FILE #4, "DUMMY.TMP"
1214 SCRATCH :1
1216 FILE :1: W4$
1218 FILE :3: F4(7)
1218 FILE :3: F$(7)
1220 SCRATCH :3
1230 SET :1,1		'COPY HEADER
1232 READ :1: I$
1234 WRITE :3: I$
1231 FOR I=1 TO R1
1235 NEXT I
1300 IF S1$<> "CORE" THEN 1500
1302 REM		USE KEYS DIRECTLY FROM CORE
1310 IF S2>0 THEN 1360
1318 '			NO IDENTICAL KEY
1320 C=P(0)
1322 GOSUB 3000			'COPT_Y
1324 C=P(C)
1326 IF C>0 THEN 1326
1328   GO TO 1800

1328   GO TO 1800			'EOF
1350 '			IDENTICAL KEY CODING
1360 C=0
1362 K$(0)=AC__CHR(122)		'LOW V
1362 K$(0)=CHR(_$(122)		'HIGH VALUE
1364 C=P(C)
1366 N=P(N)
1366 N=P(C)
1368 IF K$(C)<>K$(N) THEN 1374
1370 GOSUB 2010			'IDW_ENTICAL KEYS
1372   GO TO 1364
1374 GOSBU 2060			'BREAK IN KEYS
1376 IF N>0 THEN 1364
1378   GO TO 1800		'EOF
1500 REM		USE KEYS FROM WORK FILE
1502 WRITE :2: CHR$(1229_)
1510 FOR X=1 TO K1		'INITIALIZE
1512   I(X)=2
1514   SET :2, (X-1)*K9 +1___+1
1516   READ :2: W$
1518   GOSUB 3200			'EXTRACT
1520 NEXT X
1548 '			FIND LOW KEY
1550 L$=CHR$(122)
1552 FOR X=1 TO K1
1554   IF K$(X)>L$ THEN 1558
1556   L$=K$(X)
1558 NEXT X
1560 IF L$=CHR$(122) THEN 1800	'EOD_F
1600 '
1610 FOR X=1 TO K1
1612   IF I(X)>K9 THEN 1636
1614   IF K%_$(X)>L$ TE_HEN 1636
1616   C=(X-1)*K9+P(X)
1618   IF S2>0 THEN 1624		'NO IDKCOD
1620   GOSUB 2010		'MATCH
1622     GO TO 1626
1624   GOSUB 3000		'COPY
1626 I(X)=I(X)+1
1628   IF I(X)>K9 THEN 1638
1630   SET :2, I(X)
1632   READ :2: W$
1634   GOSUB 3200			'EXTRACT
1636     GO TO 1614
1638   
1638 NEXT X
1626   I(X)=I(X)+1
1650 IF S2=0 THEN 1660
1652 GOSUB 2060			'BREAK
1660   GO TO 1550
1800 REM		------EOF------
1810 WRITE :4: "EOF"
1808 IF E9=0 THEN 1990
1809 SET :4, E9
1990 CHAIN F$(10) + F$(9)
2000 '
2001 '		------IDENTICAL KEY CODING------
2004 '			MATCH
2010 V1=1
2048   RETURN
2010 V1=1			'***DO NOTHING FOR NORMS_AL CASE***
2050 '			BREAK
2052 GOSUB 3000			'JO_UST COPY LAST RECORD
2098   RETURN
2099 '
3000 REM		
3000 '			COPY RECORDS_(S)
3010 T1=0
3020 SET :1, P(C)
3030 READ :1: I$
3040 WRITE :4: I$
3050 T1=T1+1
3060 IF T1<R1 THEN 3030
3070   RETURN
3200 '7_			EXTRACT KEY AND POINTER
3210 T$=RIGHT$(W$,6)
3220 P(X)=VAL(T$)
3230 K%_$(X)=LEFT$(W$,K9)
3240   RETURN
}}