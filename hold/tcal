      SUBROUTINE TCAL(X,Y,TS,KOUNT,TEMP,U,IHOUR,IT,IFLAG,HEAT,ASP)
      IMPLICIT INTEGER*2(I-N)
      DIMENSION X(20),Y(20),TEMP(24)
      FO=6.0
      CF=1./((1./U)-FO)
      SAT=TEMP(IHOUR)+IT*ASP*FO
      GO TO (10,20),IFLAG
   10 SAT=SAT-7.
   20 TO=(SAT-TS)/(TS*(1.-FO*CF))
      HEAT=0.0
      DO 50 I=1,KOUNT
      J=IHOUR-I
      IF (J) 30,30,40
   30 J=J+24
   40 HEAT=HEAT+(Y(I)*(TEMP(J)-TS))
   50 CONTINUE
      RETURN
      END
