110 '     R E P O R T
120 '     -----------
130 '
140 '     COPYRIGHT 1973, LUPFER & LONG COMPUTER SERVICES.
150 '
160 DIM R(13,15),H(72),H$(5),E(16),K(2,15)
170 DIM A(12,15),T(30)
180 DIM F$(10),I(132),O(132)
190 '
192 MAT READ E
194 DATA 1,1,1,1,2,1,1,1,2,1,1,4,3,4,4,4
200 FILE #3, "COMCOM.TMP"
210 MAT READ #3, F$
232 FILE :4: F$(5)		'  .COA
234   GOSUB 8500
240 FILE :1: F$(6)		'  .RPT
250   GOSUB 7500
260 FILE :2: F3$		'  .DAT
270 READ :2: I$
300 REM ===SET UP SUBTOTALS===
310 IF K1=0 THEN 500
315 FOR Y=1 TO K1
320   FOR Y1=1 TO H(1)
325     IF R(12,Y1)<>Y THEN 340
330     K(1,Y)=Y1
335     K(2,Y)=R(4,Y1)+K(2,Y-1)
340   NEXT Y1
345 NEXT Y
500 REM ========== INITIALIZE =============
502 P8=69
504 C1$=" * TOTAL * "
506 B7$=SPACE$(H(3))
508 CHANGE B7$ TO O
550 REM======EXTRACT & FORMAT======
551 IF E9>0 THEN 950		'EOF FLAG
552 IF END :2 THEN 556
554 READ :2: I$
555 IF I$<>"EOF" THEN 559
556 E9=1			'SET EOF FLAG
557 K0$=SPACE$(K(2,K1))		'EOF
558 IF K1=0 THEN 950
559 CHANGE I$ TO I
560   IF K1=0 THEN 670
562   REM------SUBTOTAL CHECK------
564   T(0)=K(2,K1)		'LENGTH
566   T1=1
568   FOR X=1 TO K1
570     T2=R(11,K(1,X))			'  POSITION
572     T(T1)=I(T2)		'EXTRACT
574     T1=T1+1
576     T2=T2+1
578       IF T1<=K(2,X) THEN 572
580   NEXT X
582   CHANGE T TO K1$
584   IF LOC(2)>3 THEN 590
586   K0$=K1$			'FIRST TIME
590    FOR Z=K1 TO 1 STEP -1
592     T1=K(2,Z)
594     IF LEFT$(K1$,T1)=LEFT$(K0$,T1) THEN 652
595     S9=1
596     CHANGE B7$ TO I
597     GOSUB 4000
598     J1=1
600     FOR Y=1 TO H(1)
602       IF R(10,Y)<>1 THEN 616
604       A9=K1*K2+J1
606       A7=A9-K2
608       GOSUB 5800		'READ/ROLL/CLEAR
610       GOSUB 4600		'MOVE TO I
612       GOSUB 720		'FROM I TO PRINT LNE
614       J1=J1+1
616     NEXT Y
618   FOR T1=K8+1 TO K8+1+K1-Z
620       O(T1)=ASC(*)
622     NEXT T1
624     GOSUB 4000
628   R(15,K(1,Z))=1
640 NEXT Z
652 IF S9=0 THEN 670		'NO BREAK
653 S9=0
654 GOSUB 4000
656 K0$=K1$			'OLD KEY = CURRENT KEY
658 CHANGE I$ TO I		'NEXT DETAIL LINE
660 IF E9=1 THEN 950		'EOF
670 REM ------- INSERT FIELDS --------
671 J1=1
672 FOR Y=0 TO H(1)
675   IF R(8,Y)=0 THEN 710
690   IF R(10,Y)<>1 THEN 700
692   A9=K1*K2+J1
693   K=R(11,Y)
694   GOSUB 5000		'ACCUMULATE TOTALS
696   T9=T9+1
700   IF R(13,Y)=0 THEN 708	'NORMAL
702   IF R(13,Y)=2 THEN 710	'SKIP
704   R(13,Y)=2			'ONCE ONLY
708    GOSUB 720
710 NEXT Y
712 GOSUB 4000
714   GO TO 550			'END OF READ LOOP
716 '
719 REM------MOVE FIELD TO PRINT LINE (GOSUB)------
720 K=R(11,Y)
725 ON R(3,Y) GO TO 730,730,810,780,730,730,912
730   FOR X=R(8,Y) TO R(9,Y)
740     O(X)=I(K)
750     K=K+1
760   NEXT X
770   GO TO 920
780 '     - DOLLAR (4) -
790   GOSUB 2200
800   GO TO 920
810 '     - DATE (3) -
830   T1=R(8,Y)
840   O(T1)=I(K+2)
850   O(T1+1)=I(K+3)
860   O(T1+2)=ASC(-)
870   O(T1+5)=ASC(-)
880   O(T1+3)=I(K+4)
890   O(T1+4)=I(K+5)
900   O(T1+6)=I(K)
902   O(T1+7)=I(K+1)
904     GO TO 920
910 '	- PACKED NUMERIC (7) -
912   T2=R(8,Y)
913   FOR T1=K TO K+R(4,Y)-1
914     O(T2)=INT((I(T1)-20)/10) + ASC(0)
915     O(T2+1)=(I(T1)-20) - (O(T2)-ASC(0))*10 + ASC(0)
916     T2=T2+1
917   NEXT T1
920   ON R(3,Y) GO TO 922,930,930,930,922,930,922
922   FOR X=R(8,Y) TO R(9,Y)	'ZERO  SUPPRESS
924     IF O(X)<>ASC(0) THEN 930
926     O(X)=ASC(SP)
928  NEXT X
930 RETURN
950 REM ========= WRAP-UP ===============
955 GOSUB 4000
960 CHANGE C1$ TO O
965 O(0)=H(3)
970 CHANGE B7$ TO I
975 T9=1
980 FOR Y=1 TO H(1)
990   IF R(10,Y)<>1 THEN 1150
1000   A9=T9
1010   GOSUB 5200
1020   GOSUB 4600		'MOVE TO I
1030   GOSUB 720		'FROM I TO PRINT LINE
1031   T9=T9+1
1150 NEXT Y
1155 GOSUB 4000
1160 P1$="DONE"
1170 GOSUB 4030
1300 CHAIN F$(10)+F$(9)
2000 REM ============ SUBROUTINES ===========
2010 '
2200 REM ------ $ FORMAT ----------
2210 T1=0
2220 X2=K
2230 X3=17-R(5,Y)
2240 FOR X1=R(8,Y) TO R(9,Y)
2250   ON E(X3) GO TO 2260,2330,2360,2290
2260   IF T1>0 THEN 2290
2270   IF I(X2)=ASC(0) THEN 2310
2280   IF I(X2)=32 THEN 2310
2290   O(X1)=I(X2)
2300   T1=T1+1
2310   X2=X2+1
2320     GO TO 2370
2330   IF T1=0 THEN 2370
2340   O(X1)=ASC(,)
2350     GO TO 2370
2360   O(X1)=ASC(.)
2370   X3=X3+1
2380 NEXT X1
2390   RETURN
4000 REM --- TOP OF PAGE/PRINT ----
4010 IF P8<59 THEN 4210
4020 IF P7=0 THEN 4070
4030 FOR P9=P8 TO 62
4040   PRINT
4050 NEXT P9
4060 PRINT TAB(31);"PAGE";P7
4070 PRINT
4080 PRINT "."
4090 PRINT
4100 P7=P7+1
4110 IF P1$="DONE" THEN 4320
4120 GOSUB 4330
4130 FOR P9=1 TO 3
4140   PRINT TAB(24);H$(P9)
4150 NEXT P9
4160 PRINT
4165 PRINT
4170 PRINT H$(4)
4180 PRINT H$(5)
4190 PRINT
4200 P8=12
4210 FOR T3=O(0) TO 1 STEP -1
4211   IF O(T3)<>32 THEN 4214
4212 NEXT T3
4214 O(0)=T3
4216 CHANGE O TO O$
4220 PRINT O$
4230 P8=P8+1
4240 CHANGE B7$ TO O
4270 P5=0
4280 IF P5=0 THEN 4320
4290 IF P8=51 THEN 4320
4300 PRINT
4310 P8=P8+1
4320   RETURN
4330 PRINT
4340 PRINT
4350 PRINT
4360   RETURN
4368 B0$=" "
4370 IF F$(2)="FILE" THEN 4376
4372 PRINT B0$
4374   GO TO 4378
4376 PRINT #3, B0$
4378   RETURN
4600 REM---MOVE TOTAL TO INPUT LINE---
4620 T1=12
4630 FOR T2=R(4,Y)+R(11,Y)-1 TO R(11,Y) STEP -1
4640   I(T2)=T(T1)
4650   T1=T1-1
4660 NEXT T2
4670   RETURN
5000 REM ------ SPECIAL ACCUMULATE ------
5010 A1=13-R(4,Y)
5020 A2=1
5030 IF I(12-A1+K)<>ASC(-) THEN 5050
5040 A2=-1
5050 FOR A8=A1 TO 11
5060   IF I(A8-A1+K)=ASC(0) THEN 5100
5065   IF I(A8-A1+K)=ASC(SP) THEN 5100
5070   A4=I(A8-A1+K)-48
5080   A5=INT((A2*A4)+.5)
5090   A(A8,A9)=A(A8,A9)+A5
5100 NEXT A8
5110   RETURN
5200 REM ---READ ACCUMULATOR---
5210 T(12)=32
5220 FOR A8=11 TO 1 STEP -1
5230   A1=0
5240   IF A(A8,A9)=0 THEN 5260
5250   A1=A(A8,A9)/10
5260   A2=INT(A1)
5270   A(A8-1,A9)=A(A8-1,A9)+A2
5280   A(A8,A9)=INT(.5+10*(A1-A2))
5290 NEXT A8
5300 IF A(0,A9)=0 THEN 5350
5310 A(11,A9)=A(11,A9)-1
5320 A(0,A9)=0
5330 T(12)=ASC(-)
5340   GO TO 5220
5350 FOR A8=1 TO 11
5360   IF T(12)<>ASC(-) THEN 5390
5370   T(A8)=ASC(0)+9-A(A8,A9)
5380     GO TO 5400
5390   T(A8)=ASC(0)+A(A8,A9)
5400 NEXT A8
5410 T(0)=12
5420 IF T(12)<>ASC(-) THEN 5450
5430 A(0,A9)=-1
5440 A(11,A9)=A(11,A9)+1
5450   RETURN
5800 REM---SPECIAL READ/ROLL TOTALS---
5810 GOSUB 5200			'READ
5820 A2=1
5830 IF T(12)<>ASC(-) THEN 5850
5840 A2=-1
5850 FOR A8=0 TO 11
5860   A5=INT((A2*A(A8,A9))+.5)
5870   A(A8,A7)=A(A8,A7)+A5
5880   A(A8,A9)=0
5890 NEXT A8
5900   RETURN
6100 REM ---- UNKLUDGE PDP-10 CHARS -----
6110 FOR T1=1 TO I(0)
6120   IF I(T1)<100 THEN 6140
6130   I(T1)=I(T1)-100
6140 NEXT T1
6150 RETURN
7500 REM -------- READ .RPT ----------
7505 READ :1: I$
7510 CHANGE I$ TO I
7520 GOSUB 6100
7530 FOR T1=1 TO I(0)
7540   H(T1)=I(T1)
7550 NEXT T1
7560 F3$=MID$(I$,9,10)
7570 FOR Y=1 TO H(1)
7580   READ :1: I$
7590   CHANGE I$ TO I
7600   GOSUB 6100		'  UN-KLUDGE
7610   FOR X=1 TO I(0)
7620     R(X,Y)=I(X)
7630   NEXT X
7633 R(12,1)=1		'*** TEST BREAK ROUTINE *****
7640   K2=K2+R(10,Y)		'NUMBER OF TOTALS
7645   IF R(12,Y)=0 THEN 7660
7650   K1=K1+1			'NUMBER OF SUBTOTAL BREAKS
7660 NEXT Y
7665 K8=R(9,Y)+2		'LAST PRINT POSITION
7670 FOR X=1 TO 5
7680   READ :1: I$
7685   H$(X)=I$
7690 NEXT X
7700 H$(3)="PERIOD ENDING "+G2$
7710 IF H(6)=0 THEN 7790
7715 '			TEMP. KLUDGE FOR ENTRY NUMBER
7720 FOR X=1 TO 12
7725   READ R(X,0)
7730 NEXT X
7735 DATA 0,0,7,2,4,1,0,0,0,0,1,0
7740 R(8,0)=H(6)
7745 R(9,0)=H(6)+3
7790 RETURN
8500 REM ------ COA END OF PERIOD ---------
8510 S1=0
8520 READ :4: I$
8521 G1$=I$
8530 CHANGE G1$ TO I
8535 GOSUB 6100
8570 G4=I(13)
8590 G6=I(15)
8602 S$=G1$
8604 G2$=MID$(S$,29+8*(G4-G6),8)
8690 RETURN
9999 END
