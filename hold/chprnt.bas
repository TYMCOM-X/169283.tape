100 '     C H P R N T
110 '
120 '     CHECK PRINTING MODULE - ADAPTED FOR G.A.M.A.
130 '
140 DIM I(132),O(132),A(15,2),T(50)
150 DIM H(72),F(16,15),N$(15)
160 DIM F$(10),R$(15),O$(20)
170 '
180 FILE #1, "COMCOM.TMP"
190 MAT READ #1, F$
200 '
210 F$(3)="F0104.STR$"
220 F$(4)="F0104.DAT$"
230 F$(5)="F0101.TX1$"
240 F$(6)="F0101.CK1$"
250 FILE :1: F$(3)		' STRUCTURE
260   GOSUB 8000
270 FILE :1: F$(4)		'  DATA
280   READ :1: I$
290   CHANGE I$ TO I
300   GOSUB 6100
310   N8=N9=100*I(3)+I(4)+1
320   SET :1, N8+1
330 FILE :2: F$(5)		'  NAME & ADDRESS FILE
340   READ :2: I$
350   CHANGE I$ TO I
360   GOSUB 6100
370   D(9)=I(9)
380 FILE :3: F$(6)		'  CHECKS
390   READ :3: I$
400 FILE :4: "DISB.TMP$60"
410   SCRATCH :4
420 '
430 F$(2)="PROOF"
440 IF F$(2)<>"PROOF" GO TO 470
450   S1=1
460 '
470 O(0)=H(6)
480 FOR J=1 TO O(0)
490   O(J)=ASC(0)
500 NEXT J
510 CHANGE O TO B8$
520 '
530 REM ============= START-UP ==================
540 IF S1=0 GO TO 570
550   C$="1000"
560   GO TO 590
570 PRINT "THIS CHECK'S NO. IS";
580 INPUT C$
590 R$(4)=C$
600 J1=4
610 GOSUB 3000
620   IF E1>0 GO TO 570
630 PRINT "CHECKS' DATE";
640 INPUT O$(1)
650 R$(2)=O$(1)
660 J1=2
670 GOSUB 3000
680   IF E1>0 GO TO 630
690 D$=R$(2)
700 S$=C$+" "
710 CHANGE S$ TO T
720 A9=1
730 GOSUB 5000		'  LOAD BEGINNING CHECK INTO ACCUMULATOR
740 REM --------- BUILD DUMMY ----------
750 IF S1=1 GO TO 950
760 O$(2)="0000000 "
770 O$(3)="NAME"
780 O$(4)=O$(5)=O$(6)="-     ADDRESS     -"
790 O$(7)="-     DISTRIBUTION     -"
800 GOSUB 4000
810 REM ---------- ALIGN ---------------
820 GOSUB 4200
830 PRINT "ALIGN FORM, PUSH RETURN KEY TO START"
840 INPUT R$
850 S2=1
860 GOSUB 4400
870 GOSUB 4000
880 Q$="ALIGNMENT CORRECT"
890 GOSUB 2100
900   IF R$="NO" GO TO 760
910 FOR I=1 TO 3
920   PRINT
930 NEXT I
940 S2=0
950 REM ============= PRINT CHECKS ==============
960 READ :3: I$
970 GOSUB 4900		'EXTRACT
980 REM -------- CASH ACCT. ENTRY --------
990 C7$=R$(4)
1000 N4=0
1010 GOSUB 4200		'  BUMP CHECK NO.
1020 R$(2)=D$		'  INSERT DATE
1030 R$(4)=C$		'  INSERT REAL CHECK
1040 GOSUB 1700
1050 O$(2)=R$(7)
1060 O$(3)=R$(5)		'  DESCRIPTION
1070 REM ----------- LOOK-UP ----------------
1080 T=VAL(R$(9))
1090 IF T=0 GO TO 1140
1100 SET :2, (T-1)*D(9)+2
1110 FOR I=1 TO D(9)
1120   READ :2: O$(2+I)
1130 NEXT I
1140 REM ---------- DISTRIBUTION ----------
1150 IF END :3 GO TO 1330
1160 READ :3: I$
1170 IF I$="EOF" GO TO 1330
1180 GOSUB 4900		'  EXTRACT FIELDS
1190 IF R$(4)<>C7$ GO TO 1330
1200 R$(4)=C$		'  INSERT REAL CHECK NO
1210 GOSUB 1700
1220 REM ---- BUILD DIST. PRINT LINE -----------
1230 N4=N4+1
1240   IF N4>13 GO TO 1140'  LINE LIMIT EXCEEDED
1250 CHANGE R$(2) TO T
1260 GOSUB 2500
1270 CHANGE T TO S1$
1280 CHANGE R$(7) TO T
1290 GOSUB 2330
1300 CHANGE T TO S2$
1310 O$(6+N4)=RIGHT$(R$(1),4)+"   "+S1$+"   "+R$(10)+"   "+S2$
1320   GO TO 1140
1330 REM ------- PRINT CHECK --------
1340 GOSUB 4400
1350 IF END :3 GO TO 1370
1360   GO TO 980
1370 REM ============= WRAP-UP ==================
1380 IF S1=1 GO TO 1610
1390 Q$="GOOD RUN"
1400 GOSUB 2100
1410 IF R$="NO" GO TO 1610
1420 SET :4, 1
1430 IF END :4 GO TO 1470
1440 READ :4: I$
1450 WRITE :1: I$
1460   GO TO 1430
1470 E$="EOF"
1480 WRITE :1: E$
1490 N9=N9-1
1500 GOSUB 2000
1510 PRINT
1520 PRINT "ENTRIES";N8;"-";N9;"WRITTEN TO ";N$(0)
1530 O(1)=O(2)=O(3)=O(4)=100
1540 O(34)=ASC(1)
1550 CHANGE O TO O$
1560 SET :3, 1		'****SCRATCH :3
1570 WRITE :3: O$
1580 'WRITE :3 : E$			'****
1590 PRINT
1600 PRINT "CHECK FILE EMPTIED"
1610 REM ---------- RETURN -------------
1620 STOP
1630 CHAIN F$(10)+F$(9)
1650 REM ============= SUBROUTINES ===============
1660 '
1700 REM ------ WRITE ENTRY TO .TMP ----------
1710 CHANGE B8$ TO O
1790 O(1)=INT(N9/100)
1792 O(2)=INT(N9-100*O(1))
1794 O(1)=O(1)+20
1796 O(2)=O(2)+20
1800 FOR J1=1 TO H(8)
1810   IF Z(J1)<0 GO TO 1890
1840   CHANGE R$(J1) TO T
1850   FOR K1=1 TO T(0)
1860     K2=F(13,J1)+K1-1
1870     O(K2)=T(K1)
1880   NEXT K1
1890 NEXT J1
1900 CHANGE O TO O$
1910 WRITE :4: O$
1915 N9=N9+1
1920 RETURN
2000 REM ----- WRITE HEADER -------
2005 SET :1, 1
2010 CHANGE B8$ TO O
2030 O(1)=INT(N8/100)
2035 O(2)=INT(N8-100*O(1))
2040 O(3)=INT(N9/100)
2045 O(4)=INT(N9-100*O(3))
2050 GOSUB 6000
2055 CHANGE O TO O$
2060 WRITE :1: O$
2065 RETURN
2100 REM ------ YES/NO -------
2110 PRINT
2120 PRINT Q$;
2130 INPUT R$
2132   IF R$<>"Y" GO TO 2136
2134     R$="YES"
2136   IF R$<>"N" GO TO 2140
2138     R$="NO"
2140   IF R$="YES" GO TO 2180
2150   IF R$="NO" GO TO 2180
2160 PRINT "PLEASE ANSWER 'YES' OR 'NO'"
2170   GO TO 2100
2180 RETURN
2300 REM -------- FORMAT DOLLAR ---------
2310 C1=ASC(*)
2320   GO TO 2340
2330 C1=ASC(SP)		'  E.P. 2
2340 FOR K1=1 TO T(0)-5
2350   IF T(K1)<>ASC(0) GO TO 2380
2360   T(K1)=C1
2370 NEXT K1
2380 T(T(0))=T(T(0)-1)
2390 T(T(0)-1)=T(T(0)-2)
2400 T(T(0)-2)=ASC(.)
2490   RETURN
2500 REM -------- FORMAT DATE -----------
2510 T(0)=8
2520 T(7)=T(1)
2530 T(8)=T(2)
2540 T(1)=T(3)
2550 T(2)=T(4)
2560 T(4)=T(5)
2570 T(5)=T(6)
2580 T(3)=ASC(-)
2590 T(6)=ASC(-)
2595   RETURN
3000 REM ------ EDIT ----------
3005 E1=0
3010 E1$="-"
3015 CHANGE R$(J1) TO T
3020 L6=F(6,J1)
3025 IF F(5,J1)<>3 GO TO 3150
3030   L6=8
3150 '     - LENGTH -
3155 IF F(5,J1)=3 GO TO 3185
3160 IF T(0)>L6 GO TO 3175
3165 IF T(0)<F(9,J1) GO TO 3175
3170   GO TO 3185
3175 E1$="INCORRECT LENGTH"
3180   GO TO 3520
3185 '     - FILL -
3190 IF T(0)>=L6 GO TO 3270
3195   D=L6-T(0)
3210 FOR K1=L6 TO 1 STEP -1
3215   IF K1<=D GO TO 3230
3220   T(K1)=T(K1-D)
3225     GO TO 3235
3230   T(K1)=ASC(0)
3235 NEXT K1
3270 '     - DATE -
3275 IF F(5,J1)<>3 GO TO 3380
3280 IF T(6)<>ASC(-) GO TO 3370
3285 IF T(3)= ASC(-) GO TO 3315
3290 IF T(4)<>ASC(-) GO TO 3370
3295   FOR K1=1 TO 3
3300     T(K1)=T(K1+1)
3305   NEXT K1
3310   T(4)=ASC(0)
3315 T(6)=T(5)
3335 T(5)=T(4)
3340 T(4)=T(2)
3345 T(3)=T(1)
3350 T(1)=T(7)
3355 T(2)=T(8)
3360 T(0)=6
3362 IF T(1)<>ASC(7) GO TO 3520
3364 IF (T(3)-ASC(0))*10 + T(4)-ASC(0) > 12 GO TO 3520
3366 IF (T(5)-ASC(0))*10 + T(6)-ASC(0) > 31 GO TO 3520
3368   GO TO 3380
3370 E1$="USE FORM 'MM-DD-YY'"
3375   GO TO 3520
3380 '     - NUMERIC -
3385 IF F(5,J1)=2 GO TO 3440
3390 T1=T(0)
3395 IF F(5,J1)<>4 GO TO 3405
3400   T1=T1-1
3405 FOR K1=1 TO T1
3410   IF T(K1)>ASC(9) GO TO 3430
3415   IF T(K1)<ASC(0) GO TO 3430
3420 NEXT K1
3425   GO TO 3440
3430 E1$="NON-NUMERIC CHARACTER"
3435   GO TO 3520
3440 '     - BACK TO STRING
3445 CHANGE T TO R$(J1)
3500   GO TO 3545
3515 '
3520 IF E9>1 GO TO 3530
3525 PRINT TAB(2);N$(J1);" IN ERROR - ";E1$;" - RE-TYPE"
3530 E1=1
3535 E9=E9+1
3540 CHANGE T TO R$(J1)
3545 RETURN
4000 REM -------- VOID ENTRY ----------
4010 PRINT "VOID"
4090 RETURN
4200 REM -------- BUMP CHECK NO. ---------
4210 CHANGE "1 " TO T
4220 A9=1
4230 GOSUB 5000
4240 GOSUB 5200
4250 CHANGE T TO C$
4260 C$=MID$(C$,8,4)
4290 RETURN
4400 REM ----------- PRINT CHECK --------------
4410 FOR I=1 TO 1
4420   PRINT
4430 NEXT I
4440 PRINT TAB(40);O$(1)
4450 PRINT
4460 CHANGE O$(2) TO T
4470 GOSUB 2300
4475 CHANGE T TO S$
4480 S1$=LEFT$(S$,5)
4485 S2$=RIGHT$(S$,2)
4490 PRINT TAB(5);S1$;" AND ";S2$;"/100";TAB(50);S$
4530 PRINT
4540 PRINT
4550 FOR I=3 TO 6
4560   PRINT TAB(3);O$(I)
4570 NEXT I
4580 FOR I=1 TO 4
4590   PRINT
4600 NEXT I
4605 T(T(0))=T(T(0))+13
4610 FOR I=7 TO 9		'***19****
4615   T(T(0))=ASC(SP)
4620   PRINT O$(I)
4630 NEXT I
4670 FOR I=2 TO 19
4680   O$(I)=""
4690 NEXT I
4700 IF S1=1 GO TO 4790
4710 FOR I=1 TO 2
4720   PRINT
4730 NEXT I
4790 RETURN
4800 IF S2=1 GO TO 4790
4900 REM ---------- EXTRACT ----------------
4902 CHANGE I$ TO I
4905 FOR J1=1 TO H(8)
4910   IF F(2,J1)=0 GO TO 4970
4915   K1=0
4920   FOR K2=F(13,J1) TO F(13,J1)+F(6,J1)-1
4925     K1=K1+1
4930     T(K1)=I(K2)
4940   NEXT K2
4950   T(0)=K1
4960   CHANGE T TO R$(J1)
4970 NEXT J1
4990 RETURN
5000 REM ---ACCUMULATE---
5010 A1=13-T(0)
5020 A2=1
5030 IF T(13-A1)<>ASC(-) THEN 5050
5040 A2=-1
5050 FOR A8=A1 TO 11
5060   IF T(A8-A1+1)=ASC(0) THEN 5100
5070   A4=T(A8-A1+1)-48
5080   A5=INT((A2*A4)+.5)
5090   A(A8,A9)=A(A8,A9)+A5
5100 NEXT A8
5110   RETURN
5200 REM ---READ ACCUMULATOR---
5210 T(12)=32
5220 FOR A8=11 TO 1 STEP -1
5230   A1=0
5240   IF A(A8,A9)=0 THEN 5260
5250   A1=A(A8,A9)/10
5260   A2=INT(A1)
5270   A(A8-1,A9)=A(A8-1,A9)+A2
5280   A(A8,A9)=INT(.5+10*(A1-A2))
5290 NEXT A8
5300 IF A(0,A9)=0 THEN 5350
5310 A(11,A9)=A(11,A9)-1
5320 A(0,A9)=0
5330 T(12)=ASC(-)
5340   GO TO 5220
5350 FOR A8=1 TO 11
5360   IF T(12)<>ASC(-) THEN 5390
5370   T(A8)=ASC(0)+9-A(A8,A9)
5380     GO TO 5400
5390   T(A8)=ASC(0)+A(A8,A9)
5400 NEXT A8
5410 T(0)=12
5420 IF T(12)<>ASC(-) THEN 5450
5430 A(0,A9)=-1
5440 A(11,A9)=A(11,A9)+1
5450 RETURN
5600 REM ---CLEAR ACCUMULATOR---
5610 FOR A8=0 TO 12
5620   A(A8,A9)=0
5630 NEXT A8
5640 RETURN
6000 REM --- KLUDGE CHAR SET FOR PDP-10 ---
6010 FOR K1=1 TO O(0)
6020   IF O(K1)>13 GO TO 6040
6030     O(K1)=100+O(K1)
6040 NEXT K1
6050 RETURN
6100 REM ---- UNKLUDGE PDP-10 CHARS -----
6110 FOR K1=1 TO I(0)
6120   IF I(K1)<100 GO TO 6140
6130     I(K1)=I(K1)-100
6140 NEXT K1
6150 RETURN
8000 REM ---READ STRUCTURE FILE---
8005 O9=15
8010 READ :1: I$
8015 CHANGE I$ TO I
8020 GOSUB 6100
8025 FOR Y=0 TO I(0)
8030   H(Y)=I(Y)
8035 NEXT Y
8040 N$(0)=MID$(I$,34,H(33))
8050 FOR T2=1 TO H(3)
8055   READ :1: I$
8060   CHANGE I$ TO I
8065   GOSUB 6100
8070   T3=I(2)
8075   FOR T1=1 TO 16
8080     F(T1,T3)=I(T1)
8085   NEXT T1
8095   N$(T3)=MID$(I$,17,I(7))
8130 NEXT T2
8260 F(13,0)=1
8265 F(6,0)=2
8270 RETURN
9999 END
 