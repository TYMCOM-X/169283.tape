1 * TEXT OUTPUT BEGINS IN LINE 16, VERSION IN LINE 20E TRANSLATOR ONLY IF"
2 STRING QSTR(10)(100),LNUM(15),SNUM(15),STMTHD(32)(11),COMNT(32)(25)
3 INTEGER CFLG,NST(32),IFF(100)
4 COMMON QSTR,IXQ,CFLG,LNUM
5 STRING FNI(40),FNO(40),SNR(4),SCR(3),FND(40)
6 IFFX=0 ; FLNUM=999.
7 SNR='(/S&)'
8 SCR="(S)"
9 DATA NST(5),NST(11),NST(13),NST(14),NST(15),NST(16),NST(18)

            ,NST(19),NST(20),NST(21),NST(22),NST(23),NST(24),NST(25)

            ,NST(26),NST(27),NST(28),NST(29),NST(30)/19*1/
10 DATA NST(1),NST(2),NST(3),NST(4),NST(6),NST(7),NST(8),NST(9)

            ,NST(10),NST(12),NST(17),NST(31),NST(32)/2,3,4,5,6,7,8,

            9,10,11,12,13,14/
11 * DATA (STMTHD(J),J=1,24)/'ASCII','FILENAME','DATA','FORMAT','IMPLICIT','EQUIVALENCE','IF','READ','INPUT','PRINT','ENTRY','RETURN','LOAD','CALLBREAK','CALLPID','CALLEXITLM','CALLBYE','CHECK','NOCHECK','LINE','NOLINE','ENCODE','DECODE','FILELIST'/
12 * DATA (STMTHD(J),J=25,32)/'SET','OPENFILE','CLOSEFILE','BACKSPACE','REWIND','ENDFILE','CHAIN','WRITE'/
13 * DATA COMNT(5),COMNT(22),COMNT(23),COMNT(11),COMNT(13),COMNT(18),COMNT(19)

            ,COMNT(20),COMNT(21)/3*'USE BFO',6*'MANUALLY REPROGRAM'/
14 * DATA COMNT(14),COMNT(15),COMNT(16),COMNT(17)/4*''/
15 * DATA COMNT(24),COMNT(25),COMNT(26),COMNT(27),

            COMNT(28),COMNT(29),COMNT(30)/7*'CONVERT I-O'/
16 STRING INPSTR(300),CRSTR(300),NXSTR(100),RSTR(300),TSTR(12)
17 ** ON INTERRUPT GO TO 910
18 910 CONTINUE
19 * ON INTERRUPT GO TO 900
20 * CLOSE (*)
21 GO TO 930
22 900 CLOSE (-1)
23 930 WRITE(1,SNR)'INPUT FILE: '
24 READ(*,SCR,ERR=900,END=900)FNI
25 CLOSE (2);OPEN(2,FNI,INPUT,ERR=900)
26 GO TO 931
27 901 CLOSE (-1)
28 931 WRITE(1,SNR)'OUTPUT FILE: '
29 READ(*,SCR,ERR=901,END=901)FNO
30 CLOSE (3);OPEN (3,FNO,OUTPUT,ERR=901)
31 CLOSE (3);OPEN(3,"GETYM.TMP",OUTPUT,ERR=902)
32 GO TO 933
33 903 CLOSE (-1)
34 933 WRITE(1,SNR)'DIAGNOSTIC FILE (OR TEL):  '
35 READ(*,SCR,ERR=903,END=903)FND
36 CLOSE (4);OPEN(4,FND,OUTPUT,ERR=903)
37 ** ON INTERRUPT GO TO 906
38 READ(2,SCR)INPSTR
39 5 I=NUMPUL(INPSTR); IORG=1 ; IXIF=1
40 LNUM=LEFT(INPSTR,I)+' '; INPSTR=SUBSTR(INPSTR,I+1)
41 
42 I=NUMPUL(INPSTR)
43 IF (I.EQ.0)(SNUM='' ;  GO TO 10)
44 SNUM=LEFT(INPSTR,I)+" "; INPSTR=SUBSTR(INPSTR,I+1)
45 
46 10 READ(2,SCR,END=999)NXSTR
47 I=NUMPUL(NXSTR)+1
48 17 IF(SUBSTR3(NXSTR,I,1).EQ.' ')(I=I+1; GO TO 17)
49 IF(SUBSTR3(NXSTR,I,1).NE.'&') GO TO 20
50 INPSTR=INPSTR+SUBSTR(NXSTR,I+1); GO TO 10
51 
52 20 CALL CRUNCH(INPSTR,CRSTR)
53 IF (SNUM.NE.'') GO TO 21
54 IF(LEFT(INPSTR,1).EQ.'C')

            (INPSTR='*'+SUBSTR(INPSTR,2); GO TO 70)
55 IF(LEFT(CRSTR,1).EQ.'*') GO TO 70
56 21 ISC=INDEX(CRSTR,';')
57 16 DO 25 I=1 , 32
58  IF(INDEX(CRSTR,STMTHD(I)).EQ.IXIF) GO TO 30
59 25 CONTINUE
60 GO TO 80
61 
62 
63 * FOUND A STMT THAT NEEDS TRANSLATING
64 30 GO TO(31,32,33,34,35,36,37,38,39,40,41

            ,42,43,44),NST(I)
65 31 WRITE (4,SCR)STMTHD(I)+' FOUND IN LINE '+LNUM
66 IF(COMNT(I).NE.'') WRITE(4,SCR)COMNT(I)
67 CRSTR='*'+CRSTR; GO TO 90
68 *
69 * ALPHA AND FILENAME HERE
70 *
71 32 CONTINUE
72 33 CRSTR='STRING '+SUBSTR(CRSTR,NST(I)*3)
73 TSTR='('+STR((NST(I)-1)*4)+')'
74 CRSTR=CRSTR+TSTR; J=1
75 330 I=INDEX3(CRSTR,',',J)
76 IF(I.EQ.0)GO TO 90
77 CRSTR=LEFT(CRSTR,I-1)+TSTR+SUBSTR(CRSTR,I); J=I+5
78 GO TO 330
79 *
80 ******* HANDLE OCTAL CONSTANTS IN DATA STMT HERE****
81 *
82 34 I=1
83 340 I=INDEX3(CRSTR,'/',I); J=INDEX3(CRSTR,'/',I+1)
84 IF(I.EQ.0) GO TO 90
85 342 IF(SUBSTR3(CRSTR,I+1,1).EQ.'O') GO TO 341
86 I=INDEX3(CRSTR,',',I+1)
87 IF(I.GT.J)GO TO 340
88 GO TO 342
89 341 WRITE(4,SCR)'OCTAL CONSTANT FOUND IN LINE '+LNUM
90 WRITE(4,SCR)'MANUALLY REPROGRAM'
91 CRSTR='*'+CRSTR; GO TO 90
92 *
93 ********EQUIVALENCE****
94 *
95 36 WRITE(4,SCR)'EQUIVALENCE FOUND IN LINE '+LNUM
96 WRITE(4,SCR)'BE SURE TYPES MATCH!!'
97 GO TO 90
98 *
99 ******IF(X> ** IF X< ******HERE***
100 *
101 37 I=INDEX(CRSTR,'<'); J=INDEX(CRSTR,'>')
102 IF(I.EQ.0.AND.J.EQ.0) GO TO 50
103 IF(I.GT.J)(CRSTR=LEFT(CRSTR,I-1)+'.LT.'+SUBSTR

            (CRSTR,I+1); GO TO 37)
104 CRSTR=LEFT(CRSTR,J-1)+'.GT.'+SUBSTR(CRSTR,J+1); GO TO 37
105 50 IPCNT=1
106 DO 51 I=4,LENGTH(CRSTR)
107 TSTR=SUBSTR3(CRSTR,I,1)
108 IF(TSTR.EQ.')')(IPCNT=IPCNT-1; GO TO 52)
109 IF(TSTR.EQ.'(')IPCNT=IPCNT+1
110 GO TO 51
111 52 IF(IPCNT.EQ.0)(IXIF=I+1; GO TO 16)
112 51 CONTINUE
113 *
114 *
115 *******RETURN #****
116 *
117 41 IF(LENGTH(CRSTR).EQ.IXIF+5) GO TO 90
118 IF (NUMPUL(SUBSTR(CRSTR,7)).EQ.0) GO TO 90
119 WRITE (4,SCR)'ALTERNATE RETURN IN LINE '+LNUM+'... MANUALLY REPROGRAM'
120 ** CRSTR='*'+CRSTR ; GO TO 90
121 *
122 *****CALL BYE******
123 42 CRSTR=LEFT(CRSTR,IXIF-1)+'LOGOUT' ; GO TO 90
124 *
125 *****CHAIN***
126 *
127 43 CRSTR=LEFT(CRSTR,IXIF-1)+'LINK '+SUBSTR(CRSTR,IXIF+5)

               ; GO TO 90
128 *
129 *****************
130 *
131 * FORMATS TREATED HERE****
132 *
133 ****************
134 35 IF(CRSTR.EQ.'FORMAT(V)')(IFFX=IFFX+1; IFF(IFFX)=VAL(SNUM);

                 CRSTR='*'+CRSTR; GO TO 90)
135 I=8; J=1
136 IF(SUBSTR3(CRSTR,I,1).EQ.'"')(I=9;GO TO 55)
137 57 I=INDEX3(CRSTR,'"',I)+1 ;J=J+1
138 IF(I.EQ.1)GO TO 90
139 IF(.NOT.(SUBSTR3(CRSTR,I-2,1).EQ.'/'))GO TO 57
140 *
141 *****PERHAPS CARR.CONTROL
142 *
143 55 TSTR=QSTR(J)
144 IF(.NOT.(TSTR.EQ.'1'.OR.TSTR.EQ.' '.OR.TSTR.EQ.'-'.OR.TSTR.EQ.'+'

            .OR.TSTR.EQ.'&'.OR.TSTR.EQ.'0'))GO TO 57
145 CRSTR='*'+CRSTR
146 WRITE(4,SCR)'CARRIAGE CONTROL CHAR FOUND IN FORMAT IN LINE '+LNUM
147 GO TO 90
148 *
149 ****************************
150 *****READ,WRITE,INPUT,PRINT*********
151 **********
152 *
153 44 CONTINUE
154 38 CONTINUE
155 39 CONTINUE
156 40 J=NST(I)
157 IF(J.EQ.8)I=IXIF+4.ELSE.(I=IXIF+5)
158 TSTR=SUBSTR3(CRSTR,I,1)
159 IF(TSTR.EQ.',')GO TO 60
160 IF(TSTR.EQ.':')GO TO 60
161 IF(TSTR.GE.'0'.AND.TSTR.LE.'9')GO TO 65
162 IF(TSTR.EQ.'(')(IRFLG=-1; IF (J.EQ.8.OR.J.EQ.14)GO TO 66)
163 GO TO 69
164 *
165 *::: DISPLAY AND ACCEPT CONVERSION***
166 *
167 60 IF(J.EQ.10.OR.J.EQ.14)(TSTR='DISPLAY ';I=I+1).ELSE.(

            TSTR="ACCEPT '?'")
168 68 CRSTR=LEFT(CRSTR,IXIF-1)+TSTR+SUBSTR(CRSTR,I); GO TO 69
169 *
170 ******WRITE(1,FMT)---READ(0,FMT)*********
171 *
172 65 IF(J.EQ.10.OR.J.EQ.14)TSTR='WRITE(1,'.ELSE.(TSTR='READ(0,')
173 K=INDEX3(CRSTR,',',I+1); IF(K.EQ.0)CRSTR=CRSTR+')'.ELSE.(

            CRSTR=LEFT(CRSTR,K-1)+')'+SUBSTR(CRSTR,K+1)); IRFLG=-1
174 GO TO 68
175 *
176 * LOOK FOR POSIBLE FILENAME INSTEAD OF NUMMBER**
177 *
178 66 TSTR=SUBSTR3(CRSTR,I+1,1)
179 IF(TSTR.EQ.'"')(CRSTR='*'+CRSTR;GO TO 67)
180 IF('A'.LE.TSTR.AND.TSTR.LE.'Z')WRITE(4,SNR)

            'POSSIBLE '.ELSE.(GO TO 69)
181 67 WRITE(4,SCR)'FILE NAME USED AS FILE NUMBER IN LINE '+LNUM
182 69 IF(J.EQ.10.OR.J.EQ.14)GO TO 80
183 GO TO 90
184 *
185 *
186 *
187 *
188 *
189 **************
190 80 CALLFUNCSRCH ( CRSTR)
191 90 IF(ISC.EQ.0)GO TO 100
192 ISC=INDEX(CRSTR,';'); RSTR=SUBSTR(CRSTR,ISC+1)
193 CRSTR=LEFT(CRSTR,ISC-1)
194 100 K=1
195 DO 101 I=IORG,IXQ
196 J=INDEX3(CRSTR,'"',K);IF(J.EQ.0) GO TO 106
197 CRSTR=LEFT(CRSTR,J)+QSTR(I)+'"'+SUBSTR(CRSTR,J+1)
198 K=J+LENGTH(QSTR(I))+2
199 101 CONTINUE
200 * QUOTES NOW ALL FILLED IN
201 *
202 106 IORG=I+1
203 IF(VAL(LNUM).GT.999)(FLNUM=FLNUM+.001 ;

            LNUM=SUBSTR(STR(FLNUM),2)+' ')
204 IF(IRFLG.NE.0)(LNUM='\'+LNUM; IRFLG=0)
205 WRITE(3,SCR)LNUM+SNUM+CRSTR
206 IF(ISC.EQ.0)(INPSTR=NXSTR; GO TO 5)
207 LNUM=SUBSTR(STR(VAL(LNUM)+.001),2)+' '
208 CRSTR=RSTR
209 I=NUMPUL(CRSTR)
210 IF(I.EQ.0)SNUM=''.ELSE

            .(SNUM=LEFT(CRSTR,I)+' '; CRSTR=SUBSTR(CRSTR,I+1))
211 GO TO 21
212 
213 70 IF(VAL(LNUM).GT.999)(FLNUM=FLNUM+.001 ;

            LNUM=SUBSTR(STR(FLNUM),2)+' ')
214 WRITE(3,SCR)LNUM+SNUM+INPSTR
215 INPSTR=NXSTR; GO TO 5
216 
217 999 IF(IEOF.EQ.0)(IEOF=1; GO TO 20)
218 *
219 *
220 *  FILL IN FORMAT WITH FREE FORM
221 *
222 CLOSE(3); CLOSE(2); OPEN(2,"GETYM.TMP",INPUT); OPEN(3,FNO,OUTPUT)
223 105 READ(2,SCR,END=9999)INPSTR
224 IF (LEFT(INPSTR,1).NE.'\') GO TO 110
225 INPSTR=SUBSTR(INPSTR,2)
226 IF(IFFX.EQ.0)GO TO 110
227 J=INDEX(INPSTR,','); K=INDEX(INPSTR,')')
228 IF(J.GT.K)GO TO 110; CRSTR=SUBSTR3(INPSTR,J+1,K-J-1)
229 DO 115 L=1,LENGTH(CRSTR)
230 TSTR=SUBSTR3(CRSTR,L,1)
231 IF(TSTR.LT.'0'.OR.TSTR.GT.'9')GO TO 110
232 115 CONTINUE
233 JVAL=VAL(CRSTR)
234 DO 120 I=1,IFFX
235 IF(IFF(I).EQ.JVAL)GO TO 140
236 120 CONTINUE
237 GO TO 110
238 *
239 * REPAIR FREE FORMAT
240 *
241 140 INPSTR=LEFT(INPSTR,J-1)+SUBSTR(INPSTR,K)
242 110 IF(LENGTH(INPSTR).GT.72)(WRITE(3,SNR)

            LEFT(INPSTR,72)+CHAR(106);INPSTR=SUBSTR(INPSTR,73); GO TO 110)
243 WRITE(3,SCR)INPSTR; GO TO 105
244 *
245 9999 CLOSE(2); CLOSE(3)
246 DISPLAY 'EOF'
247 QUIT
248 902 DISPLAY "UNABLE TO OPEN SCRATCH FILE, ABORTING JOB"
249 CLOSE (*)
250 QUIT
251 906 CLOSE (*);CLOSE(2);CLOSE(3);CLOSE(4)
252 DISPLAY CHAR(109)+'ABORTED'
253 ** ON INTERRUPT GO TO 900
254 GO TO 900
255 *
256 END
    