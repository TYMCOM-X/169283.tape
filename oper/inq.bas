100 '     I N Q
110 '     -----
120 '
130 '     VERSION 1.0
140 '
150 '     COPYRIGHT 1973, LUPFER AND LONG COMPUTER SERVICES
160 '
170 DIM H(72),F(16,15),N$(60)
180 DIM F$(10),I(132),O(132),A(12,6),T(50)
190 DIM C(4,15),C$(50),S(50),K(12)
200 DIM D(16),D$(6)
210 '
220 FILE #3, "COMCOM.TMP"
230 FOR X=1 TO 10
240   READ #3, F$(X)
250 NEXT X
260 '
270 FILE :1: F$(3)		'  STRUCTURE
280   GOSUB 8000
290 FILE :2: F$(4)		'  DATA
300   READ :2: I1$
310 IF F$(2)<>"ENTR" GO TO 330
320   S2=1
330 IF F$(2)<>"LIST" GO TO 350
332   FILE :4: F$(5)		'  COA
334   GOSUB 8500
340   S2=2
350 IF F$(7)="*" GO TO 390
360   FILE :4: F$(7)		'  OUTPUT
370   WRITE :4: I1$
380   S8=2
390 IF F$(8)="*" GO TO 420
400   FILE :5: F$(8)		'  COMMANDS
410   S4=1
420 REM ------ CALC. PRINT SPACINGS, TRUNCATE --
430 B7=0
440 FOR Y=1 TO H(8)
450   IF F(2,Y)=0 GO TO 470
460   B7=B7+F(8,Y)
470 NEXT Y
480 T1=67-B7
490 B2=INT(T1/(H(3)-1))
500 IF B2<2 GO TO 530
510   B2=2
520   GO TO 620
530 IF B2=1 GO TO 620
540 B2=1
550 T2=(H(3)-1)-T1
560 IF H(11)=0 GO TO 615
570 IF F(8,H(11))=0 GO TO 615
580   F(8,H(11))=F(8,H(11))-T2
590   T=F(8,H(11))
600   N$(H(11)+2*O9)=LEFT$(N$(H(11)+2*O9),T)
610   N$(H(11)+3*O9)=LEFT$(N$(H(11)+3*O9),T)
615 B7=B7-T2
620 B7=B7+B2*(H(3)-1)
630 B7$=SPACE$(B7)
640 B2$=SPACE$(B2)
650 REM ========== SET UP RUN =================
660 D(0)=16
670 H$(2)=F$(1)
680 H$(3)=" "
690 ON S2+1 GO TO 890,700,800
700 REM -------- SUMMARY AFTER ENTRY ----------
710 CHANGE I1$ TO I
720 GOSUB 6100
730 V1=100*I(1)+I(2)
740 V2=100*I(3)+I(4)
750 V3=V4=0
760 H$(1)=N$(0)
770 L1$="CURRENT "
780 L2$="ALL     "
790   GO TO 1550
800 REM -------- LIST ENTIRE FILE -------------
810 V1=1
820 V2=999999
830 V3=V4=0
840 H$(1)=N$(0)
850 H$(3)="PERIOD ENDING "+G2$
860 L1$="TOTAL "
870 L2$=" "
880   GO TO 1600
890 REM -------- NORMAL (INQUIRY) -------------
900 H0$="*** SELECTED TRANSACTIONS ***"
910 H$(1)="INQUIRY ON "+N$(0)
920 L1$="SELECTED "
930 L2$="TOTAL    "
940 PRINT
950 PRINT "---DETERMINE THE SELECTION CRITERIA---"
960 PRINT
970 PRINT "TRANSACTIONS MAY BE SELECTED USING ANY DATA FIELD(S)"
980 Z=0
990 C=1
1000 GOSUB 4300			'   WHICH FIELD
1010 IF R$="DONE" GO TO 1550
1020 Z=Z+1
1030 T1=J1
1040 C(2,Z)=T1
1050 PRINT "METHOD OF SELECTION ";
1060 ON F(5,T1) GO TO 1090,1090,1090,1070
1070 PRINT "(VALUE, RANGE, LIST OR DEBIT/CREDIT)";
1080   GO TO 1100
1090 PRINT "(VALUE, RANGE, OR LIST)";
1100 INPUT I$
1110 GOSUB 4540
1120 IF I$<>"VALUE" THEN 1200
1130 PRINT "VALUE";
1140 GOSUB 3505
1150 IF T2=1 THEN 1100
1160 C(1,Z)=1
1170 C(3,Z)=1
1180 C(4,Z)=C-1
1190   GO TO 1000
1200 IF I$<>"RANGE" THEN 1310
1210 PRINT "LOWEST VALUE";
1220 GOSUB 3505
1230 IF T2=1 THEN 1210
1240 PRINT "HIGHEST VALUE";
1250 GOSUB 3505
1260 IF T2=1 THEN 1240
1270 C(1,Z)=2
1280 C(3,Z)=2
1290 C(4,Z)=C-2
1300   GO TO 1000
1310 IF I$<>"LIST" THEN 1420
1320 PRINT "ENTER A LIST OF VALUES FOR ";N$(T1)
1330 PRINT "TYPE 'DONE' WHEN FINISHED"
1340 C(4,Z)=C
1350 INPUT I$
1360 IF I$="DONE" THEN 1390
1370 GOSUB 3510
1380   GO TO 1350
1390 C(1,Z)=3
1400 C(3,Z)=C-C(4,Z)
1410   GO TO 1000
1420 IF F(5,T1)<>4 THEN 1530
1430 C(1,Z)=4
1440 C(3,Z)=1
1450 C(4,Z)=C
1460 IF I$<>"DEBIT" THEN 1490
1470 S(C)=32
1480   GO TO 1510
1490 IF I$<>"CREDIT" THEN 1530
1500 S(C)=ASC(-)
1510 GOSUB 3860
1520   GO TO 1000
1530 PRINT I$;" IS NOT A VALID METHOD OF SELECTION"
1540   GO TO 1050
1550 Q$="LIST "+L1$+"TRANSACTIONS"
1560 GOSUB 4600
1570 S8=0
1580 IF R$="NO" GO TO 1690
1590 H$(3)=L1$+"TRANSACTIONS"
1600 REM ----- SET-UP TRANSACTION HEADINGS -----
1610 S8=1
1620 H$(4)=N$(1+2*O9)
1630 H$(5)=N$(1+3*O9)
1640 FOR J=2 TO O9
1650   IF F(2,J)=0 THEN 1680
1660   H$(4)=H$(4)+B2$+N$(J+2*O9)
1670   H$(5)=H$(5)+B2$+N$(J+3*O9)
1680 NEXT J
1690 GOSUB 4510
1700 FOR I=1 TO 3
1710   IF H$(I)=" " GO TO 1730
1720   PRINT TAB(34-LEN(H$(I))/2);H$(I)
1730 NEXT I
1740 IF S2<>1 GO TO 1770
1750 PRINT
1760 PRINT TAB(25);"ENTRIES";V1;"THRU";V2
1770 IF S8<>1 GO TO 1820
1780 PRINT
1785 PRINT
1790 PRINT TAB(5);H$(4)
1800 PRINT TAB(5);H$(5)
1810 PRINT
1820 REM ========== SELECT ===========
1830 IF END :2 THEN 2680
1840 READ :2: I$
1850 SET :2, LOC(2)-1
1860 READ :2: S$
1870 IF I$=S$ GO TO 1900
1880   SET :2, LOC(2)-1
1890   GO TO 1840'  RETRY
1900 IF I$="EOF" GO TO 2680
1910 V3=V3+1
1920 IF S2=0 GO TO 1950'  REAL INQUIRY
1930   IF V3<V1 GO TO 2150
1940     GO TO 2130
1950 FOR X=1 TO Z
1960   C2=C(2,X)
1970   S3$=I$             '  BUG
1980   K$=MID$(S3$,F(13,C2),F(6,C2))
1990   C4=C(4,X)
2000   ON C(1,X) GO TO 2010,2030,2060,2100
2010   IF K$=C$(C4) THEN 2120
2020     GO TO 2150
2030   IF K$<C$(C4) THEN 2150
2040   IF K$>C$(C4+1) THEN 2150
2050     GO TO 2120
2060   FOR X1=C4 TO C4+C(3,X)-1
2070     IF K$=C$(X1) THEN 2120
2080   NEXT X1
2090     GO TO 2150
2100   CHANGE K$ TO K
2110   IF K(K(0))<>S(C4) GO TO 2150
2120 NEXT X
2130 S7=1
2140 V4=V4+1
2150 REM ========== ADD TO TOTALS ==========
2160 S3$=I$             '  BUG
2170 T$=MID$(S3$,F(13,H(13)),F(6,H(13)))
2180 CHANGE T$ TO T
2190 A9=3
2200 IF T(T(0))<>ASC(-) THEN 2220
2210 A9=4
2220 GOSUB 5000
2230 IF S7=0 GO TO 1820
2240 S7=0
2250 A9=A9-2
2260 GOSUB 5000
2270 ON S8+1 GO TO 1820,2310,2280
2280 REM ------ WRITE TO FILE --------
2290 WRITE :4: I$
2300   GO TO 1820
2310 REM ---PRINT TRANSACTION---
2320 CHANGE I$ TO I
2330 J=1
2340 CHANGE B7$ TO O
2350 FOR Y=1 TO O9
2360   ON F(5,Y)+1 GO TO 2640,2560,2590,2370,2470
2370   I=F(13,Y)
2380   O(J)=I(I+2)
2390   O(J+1)=I(I+3)
2400   O(J+3)=I(I+4)
2410   O(J+4)=I(I+5)
2420   O(J+6)=I(I)
2430   O(J+7)=I(I+1)
2440   O(J+2)=ASC(-)
2450   O(J+5)=ASC(-)
2460     GO TO 2630
2470   FOR K=0 TO F(6,Y)-1              '  DOLLAR
2480     T(K+1)=I(K+F(13,Y))
2490   NEXT K
2500   T(0)=F(6,Y)
2510   GOSUB 4000
2520   FOR K=D1 TO 16
2530     O(J+K-D1)=D(K)
2540   NEXT K
2550     GO TO 2630
2560   K2=F(13,Y)+F(6,Y)-F(8,Y)-J       '  NUMERIC
2570   IF F(2,Y)<>1 GO TO 2600
2580     GO TO 2600
2590   K2=F(13,Y)-J                     '  TEXT
2600   FOR K=J TO J+F(8,Y)-1
2610     O(K)=I(K+K2)
2620   NEXT K
2630   J=J+F(8,Y)+B2
2640 NEXT Y
2650 CHANGE O TO O$
2660 PRINT V3;TAB(5);O$
2670   GO TO 1820
2680 REM ---------- EOF ---------------------
2690 IF V4>0 THEN 2710
2700 PRINT "NO TRANSACTIONS WERE SELECTED"
2710 PRINT
2720 PRINT
2730 PRINT TAB(27);"*** SUMMARY ***"
2740 PRINT
2750 PRINT TAB(20);"DEBIT          CREDIT             NET"
2760 PRINT
2770 FOR K=1 TO 2
2780   FOR J=1 TO 2
2790     A9=(K-1)*2+J
2800     GOSUB 5200
2810     GOSUB 4000
2820     CHANGE D TO D$(A9)
2830     A9=K+4
2840     GOSUB 5000
2850   NEXT J
2860   GOSUB 5200
2870   GOSUB 4000
2880   CHANGE D TO D$(A9)
2890 NEXT K
2900 PRINT L1$;TAB(10);D$(1);D$(2);D$(5)
2910 PRINT
2920 IF L2$=" " GO TO 2950
2930 PRINT L2$;TAB(10);D$(3);D$(4);D$(6)
2940 PRINT
2950 IF S2>0 GO TO 2980
2960 PRINT "TRANSACTIONS EXAMINED:";V3
2970 PRINT "TRANSACTIONS SELECTED:";V4
2980 GOSUB 4510
3000 CHAIN F$(10)+F$(9)
3500 REM ----- GET VALUE AND EDIT ----------
3505 INPUT I$
3510 CHANGE I$ TO I
3515 ON F(5,T1) GOTO 3520,3540,3610,3710
3520 REM ---NUMERIC---
3525 T0=ASC(0)
3530 T9=F(6,T1)-I(0)+1
3535   GO TO 3555
3540 REM ---STRING---
3545 T0=32
3550 T9=1
3555 IF I(0)>F(6,T1) THEN 3825
3560 FOR T6=1 TO F(6,T1)
3565   T(T6)=T0
3570   IF T6<T9 THEN 3595
3575   IF T6>=T9+I(0) THEN 3595
3580   T(T6)=I(T6-T9+1)
3585   IF T0<>ASC(0) THEN 3595
3590   IF ABS(T(T6)-52.5)>5 THEN 3835
3595 NEXT T6
3600   GO TO 3850
3605 REM ---DATE---
3610 T7=2
3615 T(3)=ASC(0)
3620 T(5)=ASC(0)
3625 IF ABS(I(0)-7)>1 THEN 3685
3630 FOR T6=I(0) TO 1 STEP -1
3635   IF ABS(I(T6)-52.5)<5 THEN 3645
3640   ON T7 GO TO 3685,3685,3685,3655,3650,3655
3645   T(T7)=I(T6)
3650   T7=T7+5-6*SGN(T7-1)
3655 NEXT T6
3660 IF ABS(T7-2.5)>1 THEN 3685
3665 IF T(1)<>ASC(7) THEN 3695
3670 IF (((T(3)-ASC(0))*10)+(T(4)-ASC(0))) > 12 THEN 3695
3675 IF (((T(5)-ASC(0))*10)+(T(6)-ASC(0))) > 31 THEN 3695
3680   GO TO 3850
3685 PRINT "ERROR---USE MM-DD-YY FORMAT"
3690  GO TO 3840
3695 PRINT "ERROR---BAD DATE"
3700   GO TO 3840
3705 REM ---AMOUNT---
3710 T6=I(0)
3715 T7=F(6,T1)
3720 T(T7)=32
3725 IF I(T6)=32 THEN 3740
3730 IF I(T6)<>ASC(-) THEN 3750
3735 T(T7)=ASC(-)
3740 T6=T6-1
3745 S(C)=T(T7)
3750 IF T6<3 THEN 3780
3755 IF I(T6-2)<>ASC(.) THEN 3815
3760 I(T6-2)=I(T6-1)
3765 I(T6-1)=I(T6)
3770 T6=T6-1
3775 IF T6+2>T7 THEN 3825
3780 FOR T8=T7-1 TO 1 STEP -1
3785   T(T8)=ASC(0)
3790   IF T8<T7-T6 THEN 3805
3795   T(T8)=I(T8-T7+T6+1)
3800   IF ABS(T(T8)-52.5)>5 THEN 3835
3805 NEXT T8
3810   GO TO 3850
3815 PRINT "ERROR---DECIMAL POINT"
3820   GO TO 3840
3825 PRINT "ERROR---MAX SIZE IS";F(6,T1);"CHAR"
3830   GO TO 3840
3835 PRINT "ERROR---NON-NUMERIC CHARACTER"
3840 T2=1
3845   GO TO 3885
3850 T(0)=F(6,T1)
3855 CHANGE T TO C$(C)
3860 C=C+1
3865 T2=0
3870 IF C<51 THEN 3885
3875 PRINT "TOO MANY VALUES FOR INQUIRY"
3880 STOP
3885   RETURN
4000 REM ---DOLLAR FIELD PRINT---
4010 D1=16-T(0)-INT((T(0)-4)/3)
4020 D2=1
4030 D3=0
4040 FOR D9=1 TO 16
4050   D(D9)=32
4060   IF D9<D1 THEN 4100
4070   IF D9>8 THEN 4090
4080   ON D9 GO TO 4100,4120,4120,4120,4180,4120,4120,4120
4090   ON D9-8 GO TO 4180,4120,4120,4140,4210,4140,4140,4140
4100 NEXT D9
4110   RETURN
4120 IF D3>0 THEN 4140
4130 IF T(D2)=ASC(0) THEN 4160
4140 D(D9)=T(D2)
4150 D3=1
4160 D2=D2+1
4170   GO TO 4100
4180 IF D3=0 THEN 4200
4190 D(D9)=ASC(,)
4200   GO TO 4100
4210 D(D9)=ASC(.)
4220   GO TO 4100
4300 REM ------ WHICH FIELD -------
4305 PRINT
4310 PRINT "SELECT ON FIELD";
4312 IF Z=0 GO TO 4315
4314 PRINT " (OR 'DONE')";
4315 INPUT R$
4316 IF R$="HELP" GO TO 4370
4318 IF R$="DONE" GO TO 4490
4320 FOR J1=1 TO O9
4325   IF F(2,J1)=0 GO TO 4340
4330   IF N$(J1)=R$ GO TO 4490
4340 NEXT J1
4350 PRINT " '";R$;"' NOT PRESENT - TYPE HELP IF NEEDED"
4360   GO TO 4300
4370 '  HELP
4375 PRINT
4380 PRINT "FIELDS ARE:"
4385 PRINT
4390 FOR J1=1 TO O9
4400   IF F(2,J1)=0 GO TO 4420
4410     PRINT TAB(3);N$(J1)
4420 NEXT J1
4450   GO TO 4300
4490 RETURN
4500 REM ---PRINT BLANK LINES---
4510 PRINT
4520 PRINT "."
4530 PRINT
4540 PRINT
4550   RETURN
4600 REM ------ YES/NO -------
4610 PRINT
4620 PRINT Q$;
4630 INPUT R$
4640   IF R$<>"Y" GO TO 4660
4650     R$="YES"
4660   IF R$<>"N" GO TO 4680
4670     R$="NO"
4680   IF R$="YES" GO TO 4720
4690   IF R$="NO" GO TO 4720
4700 PRINT "PLEASE ANSWER 'YES' OR 'NO'"
4710   GO TO 4600
4720 RETURN
4800 REM ------- INPUT FROM TTY, COMMANDS FILE -----
4810 IF S4=1 GO TO 4840
4820 INPUT I$
4830   GO TO 4890
4840 IF END #5 GO TO 4880
4850 INPUT #5, I$
4860   GO TO 4890
4880 S4=0
4890 RETURN
5000 REM ---ACCUMULATE---
5010 A1=13-T(0)
5020 A2=1
5030 IF T(13-A1)<>ASC(-) THEN 5050
5040 A2=-1
5050 FOR A8=A1 TO 11
5060   IF T(A8-A1+1)=ASC(0) THEN 5100
5070   A4=T(A8-A1+1)-48
5080   A5=INT((A2*A4)+.5)
5090   A(A8,A9)=A(A8,A9)+A5
5100 NEXT A8
5110   RETURN
5200 REM ---READ ACCUMULATOR---
5210 T(12)=32
5220 FOR A8=11 TO 1 STEP -1
5230   A1=0
5240   IF A(A8,A9)=0 THEN 5260
5250   A1=A(A8,A9)/10
5260   A2=INT(A1)
5270   A(A8-1,A9)=A(A8-1,A9)+A2
5280   A(A8,A9)=INT(.5+10*(A1-A2))
5290 NEXT A8
5300 IF A(0,A9)=0 THEN 5350
5310 A(11,A9)=A(11,A9)-1
5320 A(0,A9)=0
5330 T(12)=ASC(-)
5340   GO TO 5220
5350 FOR A8=1 TO 11
5360   IF T(12)<>ASC(-) THEN 5390
5370   T(A8)=ASC(0)+9-A(A8,A9)
5380     GO TO 5400
5390   T(A8)=ASC(0)+A(A8,A9)
5400 NEXT A8
5410 T(0)=12
5420 IF T(12)<>ASC(-) THEN 5450
5430 A(0,A9)=-1
5440 A(11,A9)=A(11,A9)+1
5450 RETURN
5600 REM ---CLEAR ACCUMULATOR---
5610 FOR A8=0 TO 12
5620   A(A8,A9)=0
5630 NEXT A8
5640 RETURN
6100 REM ---- UNKLUDGE PDP-10 CHARS -----
6110 FOR K1=1 TO I(0)
6120   IF I(K1)<100 GO TO 6140
6130     I(K1)=I(K1)-100
6140 NEXT K1
6150 RETURN
8000 REM ---READ STRUCTURE FILE---
8005 O9=15
8010 GOSUB 8400
8015 CHANGE I$ TO I
8020 GOSUB 6100
8025 FOR Y=0 TO I(0)
8030   H(Y)=I(Y)
8035 NEXT Y
8040 N$=MID$(I$,20,13)
8045 N$(0)=MID$(I$,34,H(33))
8050 FOR T2=1 TO H(3)
8055   GOSUB 8400
8060   CHANGE I$ TO I
8065   GOSUB 6100
8070   T3=I(2)
8075   FOR T1=1 TO 16
8080     F(T1,T3)=I(T1)
8085   NEXT T1
8090   T4=17
8095   N$(T3)=MID$(I$,T4,I(7))
8100   T4=T4+I(7)
8105   N$(T3+1*O9)=MID$(I$,T4,I(8))
8110   T4=T4+I(8)
8115   N$(T3+2*O9)=MID$(I$,T4,I(8))
8120   T4=T4+I(8)
8125   N$(T3+3*O9)=MID$(I$,T4,I(8))
8130 NEXT T2
8260 F(13,0)=1
8265 F(6,0)=2
8270 RETURN
8400 REM -----READ WITH RETRY -------
8405 READ :1: I$
8410 SET :1, LOC(1)-1
8415 READ :1: S$
8420 IF I$=S$ GO TO 8435
8425   SET :1, LOC(1)-1
8430   GO TO 8405
8435 RETURN
8500 REM ------ COA END OF PERIOD ---------
8510 S1=0
8520 GOSUB 8900
8521 G1$=I$
8530 CHANGE G1$ TO I
8535 GOSUB 6100
8570 G4=I(13)
8590 G6=I(15)
8602 S$=G1$
8604 G2$=MID$(S$,29+8*(G4-G6),8)
8690 RETURN
8900 '   SPECIAL READ WITH RE-TRY
8910 READ :4: I$
8920 SET :4, LOC(4)-1
8930 READ :4: I2$
8940 IF I$=I2$ GO TO 8990
8960   SET :4, LOC(4)-1
8970   GO TO 8910
8990 RETURN
9999 END
 