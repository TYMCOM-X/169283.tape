      SUBROUTINE MODCHK
      COMMON NODPLC(800),YNL(2001),TSTORE(2001),TRACUR(1700),VN(401),
     1   VNIM1(401),IORDER(401),IUR(402),IUC(800),MATLOC(1800)
      COMMON/INDATA/NUMEL,NUNODS,NUMNOD,NOSTOP,JELCNT(20),LOCATE(21),
     1   ICURNT(21),JUNODE(401),NAME(200),LOCAL(200),MNAME(200)
      COMMON/PARAM/VALUE(200),SOURCE(150),SYMVAL(25,25)
      COMMON/MODELS/NUMMOD,MODNAM(25),KIND(25)
      COMMON/MISCEL/NOGO,IGOOF,NOPRNT,IACCT,JOBNAM(16),IDI,IDO
      COMMON/KNSTNT/TWOPI,XLOG2,XLOG10,RAD,BOLTZ,CHARGE,VT
      COMMON/TEMPER/TEMPS(6),NUMTEM,ITEMNO
        COMMON/NAMPAR/NAMPAR(25,5)
        COMMON/TBLOK/FNDATA(25,5)
C
C
      DIMENSION MOTYP(6),MODEF(4),DEFEM(16),DEFGP(25),DEFD(7),DEFJ(10),
     1   DEFM(15)
      DATA MOTYP /7,7,8,8,9,10/
      DATA MODEF /1,3,5,6/
      DATA DEFEM /1.0,100.0,1.0,8*0.0,1.0E-14,2*1.0,0.0,1.11/
      DATA DEFGP /1.0,100.0,1.0,8*0.0,1.0E-14,4*0.0,2.0,2*0.0,2.0,1.0,
     1   0.5,1.0,0.5,1.11/
      DATA DEFD /3*0.0,1.0E-14,2*1.0,1.11/
        DATA SBDEG /0.69/
      DATA DEFJ /1.0,-2.0,1.0E-4,5*0.0,1.0,1.0E-14/
      DATA DEFM /-1.0,2.0,0.5,1.0E-4,9*0.0,1.0,1.0E-14/
      DATA IBLNK,IDEF,JLETP,JLETN,LSJUN,LSSBD /' ',
     1   'DEFLT','P','N','D','SBD'/
C
C  ASSIGN MODEL NAMES
C
      ID=6
    5 ID=ID+1
      IF (ID.GT.10) GO TO 60
      IKNT=LOCATE(ID)-1
      ISTOP=LOCATE(ID+1)-1
   10 IKNT=IKNT+1
      IF (IKNT.GT.ISTOP) GO TO 5
      JKNT=0
   20 JKNT=JKNT+1
      IF (JKNT.GT.NUMMOD) GO TO 30
      IF (MNAME(IKNT).NE.MODNAM(JKNT)) GO TO 20
      MTYPE=KIND(JKNT)
      IF (ID.NE.MOTYP(MTYPE)) GO TO 20
      MNAME(IKNT)=JKNT
      GO TO 10
   30 IF (MNAME(IKNT).EQ.IBLNK) GO TO 40
      WRITE (5,31) MNAME(IKNT)
   31 FORMAT (/1X,'***  WARNING  ***  MODEL ',A5,' HAS NOT BEEN '
     1   'DEFINED CORRECTLY'/)
   40 IF (NUMMOD.GE.25) GO TO 55
      NUMMOD=NUMMOD+1
      MODNAM(NUMMOD)=MNAME(IKNT)
      KIND(NUMMOD)=MODEF(ID-6)
      MNAME(IKNT)=NUMMOD
      DO 50 I=1,25
   50 SYMVAL(NUMMOD,I)=0.0
      GO TO 10
   55 NOGO=1
      WRITE (5,56)
   56 FORMAT (/1X,'  MODEL LIMIT EXCEEDED'/)
      GO TO 10
C
C  PROCESS MODEL PARAMETERS
C
   60 IF (NUMMOD.EQ.0) RETURN
      IF (NOPRNT.GT.0) GO TO 70
   70 IF (JELCNT(7).EQ.0) GO TO 100
C
C  EBERS-MOLL MODELS
C
        IF(NOPRNT.EQ.0)WRITE(IDO,71)
71      FORMAT(/1X,'*****EBERS-MOLL MODEL PARAMETERS')
      DO 90 I=1,NUMMOD
      IF (KIND(I).NE.1) GO TO 90
   75 IF (SYMVAL(I,1).EQ.0.0) SYMVAL(I,1)=DEFEM(1)
      DO 80 J=2,16
      IF (SYMVAL(I,J).LE.0.0) SYMVAL(I,J)=DEFEM(J)
   80 CONTINUE
      IF (NOPRNT.GT.0) GO TO 85
      NAM=JLETN
      IF (SYMVAL(I,1).EQ.-1.0) NAM=JLETP
      MNAM=MODNAM(I)
      IF (MNAM.EQ.IBLNK) MNAM=IDEF
      WRITE (IDO,81) MNAM,NAM
81      FORMAT(/1X,'NAME',3X,A5/1X,'TYPE',3X,A5)
        DO 83 J=2,16
        WRITE (IDO,82)NAMPAR(J,1),SYMVAL(I,J)
82      FORMAT(1X,A5,G10.3)
83      CONTINUE
   85 IF (SYMVAL(I,4).NE.0.0) SYMVAL(I,4)=1.0/SYMVAL(I,4)
      IF (SYMVAL(I,5).NE.0.0) SYMVAL(I,5)=1.0/SYMVAL(I,5)
      IF (SYMVAL(I,6).NE.0.0) SYMVAL(I,6)=1.0/SYMVAL(I,6)
      IF (SYMVAL(I,13).LT.0.1) SYMVAL(I,13)=0.1
      IF (SYMVAL(I,14).LT.0.1) SYMVAL(I,14)=0.1
      IF (SYMVAL(I,15).NE.0.0) SYMVAL(I,15)=1.0/SYMVAL(I,15)
      IF (SYMVAL(I,16).LT.0.1) SYMVAL(I,16)=0.1
   90 CONTINUE
C
C  GUMMEL-POON MODELS
C
        IF(NOPRNT.EQ.0)WRITE(IDO,471)
      DO 490 I=1,NUMMOD
      IF (KIND(I).NE.2) GO TO 490
471     FORMAT(/1X,'*****GUMMEL-POON MODEL PARAMETERS')
  475 IF (SYMVAL(I,1).EQ.0.0) SYMVAL(I,1)=DEFGP(1)
      DO 480 J=2,25
      IF (SYMVAL(I,J).LE.0.0) SYMVAL(I,J)=DEFGP(J)
  480 CONTINUE
      IF (NOPRNT.GT.0) GO TO 485
      NAM=JLETN
      IF (SYMVAL(I,1).EQ.-1.0) NAM=JLETP
      MNAM=MODNAM(I)
      IF (MNAM.EQ.IBLNK) MNAM=IDEF
      WRITE (IDO,81) MNAM,NAM
        DO 483 J=2,25
        WRITE (IDO,82)NAMPAR(J,2),SYMVAL(I,J)
483     CONTINUE
485   SYMVAL(I,2)=1.0/SYMVAL(I,2)
      SYMVAL(I,3)=1.0/SYMVAL(I,3)
      IF (SYMVAL(I,4).NE.0.0) SYMVAL(I,4)=1.0/SYMVAL(I,4)
      IF (SYMVAL(I,5).NE.0.0) SYMVAL(I,5)=1.0/SYMVAL(I,5)
      IF (SYMVAL(I,6).NE.0.0) SYMVAL(I,6)=1.0/SYMVAL(I,6)
      IF (SYMVAL(I,21).LT.0.1) SYMVAL(I,21)=0.1
      IF (SYMVAL(I,22).GT.0.9) SYMVAL(I,22)=0.9
      IF (SYMVAL(I,23).LT.0.1) SYMVAL(I,23)=0.1
      IF (SYMVAL(I,24).GT.0.9) SYMVAL(I,24)=0.9
      IF (SYMVAL(I,13).NE.0.0) SYMVAL(I,13)=1.0/SYMVAL(I,13)
      IF (SYMVAL(I,14).NE.0.0) SYMVAL(I,14)=1.0/SYMVAL(I,14)
      IF (SYMVAL(I,16).NE.0.0) SYMVAL(I,16)=1.0/SYMVAL(I,16)
      SYMVAL(I,17)=VT*SYMVAL(I,17)
      IF (SYMVAL(I,19).NE.0.0) SYMVAL(I,19)=1.0/SYMVAL(I,19)
      SYMVAL(I,20)=VT*SYMVAL(I,20)
      IF (SYMVAL(I,25).LT.0.1) SYMVAL(I,25)=0.1
  490 CONTINUE
C
C  DIODES
C
  100 IF (JELCNT(8).EQ.0) GO TO 130
      IF (NOPRNT.GT.0) GO TO 105
      WRITE (IDO,101)
101     FORMAT(/1X,'*****DIODE MODEL PARAMETERS')
  105 DO 120 I=1,NUMMOD
      IF (KIND(I).EQ.3) GO TO 108
      IF (KIND(I).NE.4) GO TO 120
      IF (SYMVAL(I,7).EQ.0.0) SYMVAL(I,7)=SBDEG
  108 DO 110 J=1,7
      IF (SYMVAL(I,J).LE.0.0) SYMVAL(I,J)=DEFD(J)
  110 CONTINUE
      IF (NOPRNT.GT.0) GO TO 115
      MNAM=MODNAM(I)
      IF (MNAM.EQ.IBLNK) MNAM=IDEF
      NAM=LSJUN
      IF (KIND(I).EQ.4) NAM=LSSBD
      WRITE (IDO,81) MNAM,NAM
        DO 113 J=1,7
        WRITE (IDO,82)NAMPAR(J,3),SYMVAL(I,J)
113     CONTINUE
  115 IF (SYMVAL(I,1).NE.0.0) SYMVAL(I,1)=1.0/SYMVAL(I,1)
      SYMVAL(I,5)=SYMVAL(I,5)*VT
      IF (SYMVAL(I,6).LT.0.1) SYMVAL(I,6)=0.1
  120 CONTINUE
C
C  JFETS
C
  130 IF (JELCNT(9).EQ.0) GO TO 160
      IF (NOPRNT.GT.0) GO TO 135
      WRITE (IDO,131)
131     FORMAT(/1X,'*****JFET MODEL PARAMETERS')
  135 DO 150 I=1,NUMMOD
      IF (KIND(I).NE.5) GO TO 150
      IF (SYMVAL(I,1).EQ.0.0) SYMVAL(I,1)=DEFJ(1)
      IF (SYMVAL(I,2).EQ.0.0) SYMVAL(I,2)=DEFJ(2)
      DO 140 J=3,10
      IF (SYMVAL(I,J).LE.0.0) SYMVAL(I,J)=DEFJ(J)
  140 CONTINUE
      IF (NOPRNT.GT.0) GO TO 145
      NAM=JLETN
      IF (SYMVAL(I,1).EQ.-1.0) NAM=JLETP
      MNAM=MODNAM(I)
      IF (MNAM.EQ.IBLNK) MNAM=IDEF
      WRITE (IDO,81) MNAM,NAM
        DO 143 J=2,10
        WRITE (IDO,82)NAMPAR(J,4),SYMVAL(I,J)
143     CONTINUE
  145 IF (SYMVAL(I,5).NE.0.0) SYMVAL(I,5)=1.0/SYMVAL(I,5) 
      IF (SYMVAL(I,6).NE.0.0) SYMVAL(I,6)=1.0/SYMVAL(I,6) 
      IF (SYMVAL(I,9).LT.0.1) SYMVAL(I,9)=0.1 
  150 CONTINUE
C 
C  MOSFETS
C 
  160 IF (JELCNT(10).EQ.0) GO TO 200
      IF (NOPRNT.GT.0) GO TO 165
      WRITE (IDO,161)
161     FORMAT(/1X,'*****MOSFET MODEL PARAMETERS')
  165 DO 180 I=1,NUMMOD
      IF (KIND(I).NE.6) GO TO 180 
      IF (SYMVAL(I,1).EQ.0.0) SYMVAL(I,1)=DEFM(1) 
      IF (SYMVAL(I,2).EQ.0.0) SYMVAL(I,2)=DEFM(2) 
      DO 170 J=3,15
      IF (SYMVAL(I,J).LE.0.0) SYMVAL(I,J)=DEFM(J) 
  170 CONTINUE
      IF (NOPRNT.GT.0) GO TO 175
      NAM=JLETN
      IF (SYMVAL(I,1).EQ.-1.0) NAM=JLETP
      MNAM=MODNAM(I)
      IF (MNAM.EQ.IBLNK) MNAM=IDEF
      WRITE (IDO,81) MNAM,NAM
        DO 173 J=2,15
        WRITE (IDO,82)NAMPAR(J,5),SYMVAL(I,J)
173     CONTINUE
  175 IF (SYMVAL(I,7).NE.0.0) SYMVAL(I,7)=1.0/SYMVAL(I,7) 
      IF (SYMVAL(I,8).NE.0.0) SYMVAL(I,8)=1.0/SYMVAL(I,8) 
      IF (SYMVAL(I,3).LT.0.1) SYMVAL(I,3)=0.1 
      IF (SYMVAL(I,14).LT.0.1) SYMVAL(I,14)=0.1
        SYMVAL(I,2)=SYMVAL(I,2)-SYMVAL(I,5)*SQRT(SYMVAL(I,3))
  180 CONTINUE
C
C  TEMPORARY PROCESSING OF FLICKER NOISE PARAMETERS
C
  200 IFLAG=0
      DO 1000 I=1,NUMMOD
      IF (FNDATA(I,2).LT.0.1) FNDATA(I,2)=0.1
      IF (FNDATA(I,1).LT.0.0) FNDATA(I,1)=0.0
      IF (FNDATA(I,1).EQ.0.0) GO TO 1000
      IFLAG=1
 1000 CONTINUE
      IF (IFLAG.EQ.0) GO TO 1030
        IF(NOPRNT.GT.0)GO TO 1030
        WRITE(IDO,1011)
1011    FORMAT(/1X,'*****FLICKER NOISE PARAMETERS'//1X,'MODEL',
     1   9X,'KFN',8X,'FNA')
      WRITE (6,1021) (MODNAM(I),FNDATA(I,1),FNDATA(I,2),I=1,NUMMOD)
 1021 FORMAT (/1X,A5,4X,1PE10.3,4X,0PF7.4)
C
C  RESERVE ADDITIONAL NODES
C
C  TRANSISTORS
C
 1030 IF (NOGO.EQ.1) RETURN
      ISTART=LOCATE(7)
      ISTOP=LOCATE(8)-1
      IF (ISTART.GT.ISTOP) GO TO 240
      DO 230 I=ISTART,ISTOP
      MNAM=MNAME(I)
      LOC=LOCAL(I)
      IF (SYMVAL(MNAM,4).EQ.0.0) GO TO 205
      NUMNOD=NUMNOD+1 
      NODPLC(LOC+4)=NUMNOD
      GO TO 210
  205 NODPLC(LOC+4)=NODPLC(LOC+1) 
  210 IF (SYMVAL(MNAM,5).EQ.0.0) GO TO 215
      NUMNOD=NUMNOD+1 
      NODPLC(LOC+3)=NUMNOD
      GO TO 220
  215 NODPLC(LOC+3)=NODPLC(LOC)
  220 IF (SYMVAL(MNAM,6).EQ.0.0) GO TO 225
      NUMNOD=NUMNOD+1 
      NODPLC(LOC+5)=NUMNOD
      GO TO 230
  225 NODPLC(LOC+5)=NODPLC(LOC+2) 
  230 CONTINUE
C 
C  DIODES 
C 
  240 ISTART=LOCATE(8)
      ISTOP=LOCATE(9)-1
      IF (ISTART.GT.ISTOP) GO TO 260
      DO 250 I=ISTART,ISTOP
      MNAM=MNAME(I)
      LOC=LOCAL(I)
      IF (SYMVAL(MNAM,1).EQ.0.0) GO TO 245
      NUMNOD=NUMNOD+1 
      NODPLC(LOC+2)=NUMNOD
      GO TO 250
  245 NODPLC(LOC+2)=NODPLC(LOC)
  250 CONTINUE
C 
C  JFETS
C 
  260 ISTART=LOCATE(9)
      ISTOP=LOCATE(10)-1
      IF (ISTART.GT.ISTOP) GO TO 290
      DO 280 I=ISTART,ISTOP
      MNAM=MNAME(I)
      LOC=LOCAL(I)
      IF (SYMVAL(MNAM,5).EQ.0.0) GO TO 265
      NUMNOD=NUMNOD+1 
      NODPLC(LOC+3)=NUMNOD
      GO TO 270
  265 NODPLC(LOC+3)=NODPLC(LOC)
  270 IF (SYMVAL(MNAM,6).EQ.0.0) GO TO 275
      NUMNOD=NUMNOD+1 
      NODPLC(LOC+4)=NUMNOD
      GO TO 280
  275 NODPLC(LOC+4)=NODPLC(LOC+2) 
  280 CONTINUE
C 
C  MOSFETS
C 
  290 ISTART=LOCATE(10)
      ISTOP=LOCATE(11)-1
      IF (ISTART.GT.ISTOP) RETURN 
      DO 310 I=ISTART,ISTOP
      MNAM=MNAME(I)
      LOC=LOCAL(I)
      IF (SYMVAL(MNAM,7).EQ.0.0) GO TO 295
      NUMNOD=NUMNOD+1 
      NODPLC(LOC+4)=NUMNOD
      GO TO 300
  295 NODPLC(LOC+4)=NODPLC(LOC)
  300 IF (SYMVAL(MNAM,8).EQ.0.0) GO TO 305
      NUMNOD=NUMNOD+1 
      NODPLC(LOC+5)=NUMNOD
      GO TO 310
  305 NODPLC(LOC+5)=NODPLC(LOC+2) 
  310 CONTINUE
      RETURN
      END 
  