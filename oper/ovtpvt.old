      SUBROUTINE OVTPVT
      COMMON/INDATA/NUMEL,NUNODS,NUMNOD,NOSTOP,JELCNT(20),LOCATE(21),
     1   ICURNT(21),JUNODE(401),NAME(200),LOCAL(200),MNAME(200)
      COMMON/MISCEL/NOGO,IGOOF,NOPRNT,IACCT,JOBNAM(16),IDI,IDO
      COMMON/STATUS/MODE,OMEGA,TIME,DELTA,DELOLD,ICALC
      COMMON/KNSTNT/TWOPI,XLOG2,XLOG10,RAD,BOLTZ,CHARGE,VT
      COMMON/OUTDAT/ROUT(101,10),FREQ(101),IONUM,IONAM(10),IOPND(10),
     1   IONND(10),IOFLG(10),NUMOR(3),IOVAR(10,2),IACVAR(5)
      COMMON/OCNTRL/IPRCOM(10,2),IPLCOM(10,2),PLTLIM(10,2,2),
     1   IACPRT(5,4),IACPLT(5,4),ACPLIM(5,4,2)
      COMMON/DC/ICVFLG,ITCELM,TCSTAR,TCSTOP,TCINCR,KSSOP,KINEL,KOVAR
      COMMON/TRAN/JTRFLG,TSTEP,TSTOP,TSTART,NOTINT,STEPS(5),ENDPTS(5),
     1   KFROUT,FORFRE,KFPTS
      COMMON/AC/JACFLG,FSTART,FSTOP,IDFREQ,FINCR,INOISE,NOSPRT,
     1   NOSOUT,NOSIN
      COMMON/TEMPER/TEMPS(6),NUMTEM,ITEMNO
C
C
      DIMENSION PUTOUT(2,101,5)
      EQUIVALENCE (PUTOUT(1,1,1),ROUT(1,1))
      DIMENSION ITAB(10),INAM(10),IDID(10),VOUT(10)
      DOUBLE PRECISION ITITLE(4),IHEAD(10),LSNOIS
      DATA ITITLE /'REAL PART ','IMAG PART ',
     1  'MAGNITUDE ','  PHASE   '/
      DATA LSNOIS,LSTIME /'  NOISE   ','TIME'/
C
C
        CALL VALPRI(1,201,'TYMPC')
      IF (ICALC.LT.2) RETURN
      GO TO (10,200,20),MODE
C
C  DC TRANSFER CURVES
C
   10 IFLAG=1
      NAMHDR=NAME(ITCELM)
      GO TO 50
C
C  TRANSIENT ANALYSIS
C
   20 IFLAG=2
      NAMHDR=LSTIME
C
C  PRINTS
C
   50 KNTR=0
      IKNT=0
   60 IKNT=IKNT+1
      IF (IKNT.GT.NUMOR(IFLAG)) GO TO 70
      IF (IPRCOM(IKNT,IFLAG).EQ.0) GO TO 60
      ITEMP=IOVAR(IKNT,IFLAG)
      KNTR=KNTR+1
      ITAB(KNTR)=IKNT
      INAM(KNTR)=IONAM(ITEMP)
      GO TO 60
   70 IF (KNTR.EQ.0) GO TO 140
      IF (IFLAG.EQ.2) GO TO 90
      WRITE (IDO,81)TEMPS(ITEMNO)
81      FORMAT(/1X,'*****DC TRANSFER CURVES     TEMPERATURE',F10.3,
     1  ' DEG C'/)
      GO TO 100
   90 WRITE (IDO,91)TEMPS(ITEMNO)
91      FORMAT(/1X,'*****TRANSIENT ANALYSIS     TEMPERATURE',F10.3,
     1  ' DEG C'/)
  100 WRITE (IDO,101) NAMHDR,(INAM(I),I=1,KNTR)
  101 FORMAT (3X,A5,10(6X,A5))
        WRITE (IDO,111)
111     FORMAT(1X)
      DO 130 I=1,ICALC
      DO 120 J=1,KNTR
      IKNT=ITAB(J)
  120 VOUT(J)=ROUT(I,IKNT)
      WRITE (IDO,121) FREQ(I),(VOUT(J),J=1,KNTR)
  121 FORMAT (1X,1PE9.2,1X,10(1X,E10.3))
  130 CONTINUE
C
C  PLOTS
C
  140 IKNT=0
  150 IKNT=IKNT+1
      IF (IKNT.GT.NUMOR(IFLAG)) GO TO 1000
      IF (IPLCOM(IKNT,IFLAG).EQ.0) GO TO 150
      ITEMP=IOVAR(IKNT,IFLAG)
      IF (IFLAG.EQ.2) GO TO 160
      WRITE (IDO,81)TEMPS(ITEMNO)
      GO TO 170
  160 WRITE (IDO,91)TEMPS(ITEMNO)
  170 WRITE (IDO,171) NAMHDR,IONAM(ITEMP)
  171 FORMAT (3X,A5,28X,A5/)
      IF (IPLCOM(IKNT,IFLAG).EQ.2) GO TO 180
        ISPOT=0
        ILOG=0
        IAUTO=1
        YMIN=0.0
        YMAX=0.0
        CALL PLOT(ISPOT,IKNT,ILOG,IAUTO,YMIN,YMAX)
      GO TO 150
180     ISPOT=0
        ILOG=0
        IAUTO=0
        YMIN=PLTLIM(IKNT,IFLAG,1)
        YMAX=PLTLIM(IKNT,IFLAG,2)
        CALL PLOT(ISPOT,IKNT,ILOG,IAUTO,YMIN,YMAX)
      GO TO 150
C
C  AC ANALYSIS
C
C  PRINTS
C
  200 KNTR=0
      IF (INOISE.EQ.0) GO TO 220
      IF (IACPRT(INOISE,1).EQ.0) GO TO 210
      KNTR=KNTR+1
      INAM(KNTR)=IONAM(NOSOUT)
      IHEAD(KNTR)=LSNOIS
      IDID(KNTR)=1
      ITAB(KNTR)=INOISE
  210 IF (IACPRT(INOISE,2).EQ.0) GO TO 220
      KNTR=KNTR+1
      INAM(KNTR)=NAME(NOSIN)
      IHEAD(KNTR)=LSNOIS
      IDID(KNTR)=2
      ITAB(KNTR)=INOISE
  220 IKNT=0
      IFLAG=0
  230 IKNT=IKNT+1
      IF (IKNT.GT.NUMOR(3)) GO TO 250
      ITEMP=IACVAR(IKNT)
      IF (IOFLG(ITEMP).EQ.3) GO TO 230
      JKNT=0
  240 JKNT=JKNT+1
      IF (JKNT.GT.4) GO TO 230
      IF (IACPRT(IKNT,JKNT).EQ.0) GO TO 240
      KNTR=KNTR+1
      INAM(KNTR)=IONAM(ITEMP)
      IHEAD(KNTR)=ITITLE(JKNT)
      IDID(KNTR)=JKNT
      ITAB(KNTR)=IKNT
      IF (KNTR.LT.10) GO TO 240
      IF (IFLAG.EQ.1) GO TO 280
      IFLAG=1
      GO TO 270
  250 IF (KNTR.EQ.0) GO TO 400
      IF (IFLAG.EQ.0) GO TO 270
      IFLAG=0
      GO TO 280
  270 WRITE (IDO,271)TEMPS(ITEMNO)
271     FORMAT(/1X,'*****AC ANALYSIS     TEMPERATURE',F10.3,
     1  ' DEG C'/)
  280 WRITE (IDO,281) (INAM(I),I=1,KNTR)
  281 FORMAT (2X,'FREQUENCY',4X,10(A5,6X))
      WRITE (IDO,291) (IHEAD(I),I=1,KNTR)
  291 FORMAT (4X,4H(HZ),4X,10(1X,A10))
        WRITE (IDO,111)
      DO 370 I=1,ICALC
      KKNT=0
  300 KKNT=KKNT+1
      IF (KKNT.GT.KNTR) GO TO 360
      ITEMP=ITAB(KKNT)
      ITYPE=IDID(KKNT)
      GO TO (310,320,330,340),ITYPE
  310 VOUT(KKNT)=PUTOUT(1,I,ITEMP)
      GO TO 300
  320 VOUT(KKNT)=PUTOUT(2,I,ITEMP)
      GO TO 300
  330 VOUT(KKNT)=SQRT(PUTOUT(1,I,ITEMP)*PUTOUT(1,I,ITEMP)
     1   +PUTOUT(2,I,ITEMP)*PUTOUT(2,I,ITEMP))
      GO TO 300
  340 XMAG=SQRT(PUTOUT(1,I,ITEMP)*PUTOUT(1,I,ITEMP)
     1   +PUTOUT(2,I,ITEMP)*PUTOUT(2,I,ITEMP))
      IF (XMAG.GT.1.0E-20) GO TO 350
      VOUT(KKNT)=0.0
      GO TO 300
  350 VOUT(KKNT)=RAD*ATAN2(PUTOUT(2,I,ITEMP),PUTOUT(1,I,ITEMP))
      GO TO 300
  360 WRITE (IDO,121) FREQ(I),(VOUT(J),J=1,KNTR)
  370 CONTINUE
      IF (IFLAG.EQ.0) GO TO 400
      KNTR=0
      GO TO 240
C
C  PLOTS
C
  400 IF (INOISE.EQ.0) GO TO 500
      IF (IACPLT(INOISE,1).EQ.0) GO TO 450
      DO 410 I=1,ICALC
      XMAG=PUTOUT(1,I,INOISE)
      IF (XMAG.LT.1.0E-20) XMAG=1.0E-20
      PUTOUT(1,I,INOISE)=ALOG10(XMAG)
  410 CONTINUE
      WRITE (IDO,421)TEMPS(ITEMNO)
421     FORMAT(/1X,'*****NOISE ANALYSIS     TEMPERATURE',F10.3,
     1  ' DEG C'/)
      WRITE (IDO,431) IONAM(NOSOUT)
  431 FORMAT (2X,'FREQUENCY',22X,'NOISE AT ',A5,'/RT HZ'/)
      IF (IACPLT(INOISE,1).EQ.2) GO TO 440
        ISPOT=1
        ILOG=1
        IAUTO=1
        YMIN=0.0
        YMAX=0.0
        CALL PLOT(ISPOT,INOISE,ILOG,IAUTO,YMIN,YMAX)
      GO TO 450
440     ISPOT=1
        ILOG=1
        IAUTO=0
        YMIN=ACPLIM(INOISE,1,1)
        YMAX=ACPLIM(INOISE,1,2)
        CALL PLOT(ISPOT,INOISE,ILOG,IAUTO,YMIN,YMAX)
  450 IF (IACPLT(INOISE,2).EQ.0) GO TO 500
      DO 460 I=1,ICALC
      XMAG=PUTOUT(2,I,INOISE)
      IF (XMAG.LT.1.0E-20) XMAG=1.0E-20
      PUTOUT(2,I,INOISE)=ALOG10(XMAG)
  460 CONTINUE
      WRITE (IDO,421)TEMPS(ITEMNO)
      WRITE (IDO,471) NAME(NOSIN)
  471 FORMAT (2X,'FREQUENCY',15X,'EQU NOISE AT ',A5,'/RT HZ'/)
      IF (IACPLT(INOISE,2).EQ.2) GO TO 480
        ISPOT=2
        ILOG=1
        IAUTO=1
        YMIN=0.0
        YMAX=0.0
        CALL PLOT(ISPOT,INOISE,ILOG,IAUTO,YMIN,YMAX)
      GO TO 500
480     ISPOT=2
        ILOG=2
        IAUTO=0
        YMIN=ACPLIM(INOISE,2,1)
        YMAX=ACPLIM(INOISE,2,2)
        CALL PLOT(ISPOT,INOISE,ILOG,IAUTO,YMIN,YMAX)
  500 IKNT=0
  510 IKNT=IKNT+1
      IF (IKNT.GT.NUMOR(3)) GO TO 1000
      ITEMP=IACVAR(IKNT)
      IF (IOFLG(ITEMP).EQ.3) GO TO 510
      IF (IACPLT(IKNT,1).EQ.0) GO TO 530
      WRITE (IDO,271)TEMPS(ITEMNO)
      WRITE (IDO,511) IONAM(ITEMP)
  511 FORMAT (2X,'FREQUENCY',18X,'REAL PART OF ',A5/)
      IF (IACPLT(IKNT,1).EQ.2) GO TO 520
        ISPOT=1
        ILOG=0
        IAUTO=1
        YMIN=0.0
        YMAX=0.0
        CALL PLOT(ISPOT,IKNT,ILOG,IAUTO,YMIN,YMAX)
      GO TO 530
520     ISPOT=1
        ILOG=0
        IAUTO=0
        YMIN=ACPLIM(IKNT,1,1)
        YMAX=ACPLIM(IKNT,1,2)
        CALL PLOT(ISPOT,IKNT,ILOG,IAUTO,YMIN,YMAX)
  530 IF (IACPLT(IKNT,2).EQ.0) GO TO 560
      WRITE (IDO,271)TEMPS(ITEMNO)
      WRITE (IDO,541) IONAM(ITEMP)
  541 FORMAT (2X,'FREQUENCY',18X,'IMAG PART OF ',A5/)
      IF (IACPLT(IKNT,2).EQ.2) GO TO 550
        ISPOT=2
        ILOG=0
        IAUTO=1
        YMIN=0.0
        YMAX=0.0
      CALL PLOT (ISPOT,IKNT,ILOG,IAUTO,YMIN,YMAX)
      GO TO 560
550     ISPOT=2
        ILOG=0
        IAUTO=0
        YMIN=ACPLIM(IKNT,2,1)
        YMAX=ACPLIM(IKNT,2,2)
        CALL PLOT(ISPOT,IKNT,ILOG,IAUTO,YMIN,YMAX)
  560 IF (IACPLT(IKNT,3).NE.0) GO TO 570
      IF (IACPLT(IKNT,4).NE.0) GO TO 570
      GO TO 510
  570 DO 590 I=1,ICALC
      XMAG=SQRT(PUTOUT(1,I,IKNT)*PUTOUT(1,I,IKNT)
     1   +PUTOUT(2,I,IKNT)*PUTOUT(2,I,IKNT))
      IF (XMAG.GT.1.0E-20) GO TO 580
      PUTOUT(1,I,IKNT)=-20.0
      PUTOUT(2,I,IKNT)=0.0
      GO TO 590
  580 PUTOUT(2,I,IKNT)=RAD*ATAN2(PUTOUT(2,I,IKNT),PUTOUT(1,I,IKNT))
      PUTOUT(1,I,IKNT)=ALOG10(XMAG)
  590 CONTINUE
      IF (IACPLT(IKNT,3).EQ.0) GO TO 630
      WRITE (IDO,271)TEMPS(ITEMNO)
      WRITE (IDO,611) IONAM(ITEMP)
  611 FORMAT (2X,'FREQUENCY',18X,'MAGNITUDE OF ',A5/)
      IF (IACPLT(IKNT,3).EQ.2) GO TO 620
        ISPOT=1
        ILOG=1
        IAUTO=1
        YMIN=0.0
        YMAX=0.0
        CALL PLOT(ISPOT,IKNT,ILOG,IAUTO,YMIN,YMAX)
      GO TO 630
620     ISPOT=1
        ILOG=1
        IAUTO=0
        YMIN=ACPLIM(IKNT,3,1)
        YMAX=ACPLIM(IKNT,3,2)
      CALL PLOT(ISPOT,IKNT,ILOG,IAUTO,YMIN,YMAX)
  630 IF (IACPLT(IKNT,4).EQ.0) GO TO 510
      WRITE (IDO,271)TEMPS(ITEMNO)
      WRITE (IDO,641) IONAM(ITEMP)
  641 FORMAT (2X,'FREQUENCY',16X,'PHASE OF ',A5,' DEGREES'/)
      IF (IACPLT(IKNT,4).EQ.2) GO TO 650
        ISPOT=2
        ILOG=0
        IAUTO=0
        YMIN=-180.
        YMAX=180.
      CALL PLOT(ISPOT,IKNT,ILOG,IAUTO,YMIN,YMAX)
      GO TO 510
650     ISPOT=2
        ILOG=0
        IAUTO=0
      CALL PLOT(ISPOT,IKNT,ILOG,IAUTO,ACPLIM(IKNT,4,1),ACPLIM(IKNT,4,2))
      GO TO 510
 1000 IF (MODE.LT.3) GO TO 1010
      IF (KFROUT.EQ.0) GO TO 1010
      CALL FOURAN
1010  RETURN
      END
   