					100-380-011-00

SUBJECT:	MACRO VERSION 44

DATE:		OCT-28-70
THE INFORMATION IN THIS MEMORANDUM IS
SUBJECT TO CHANGE WITHOUT NOTICE AND
SHOULD NOT BE CONSTRUED AS A COMMITMENT
BY DIGITAL EQUIPMENT CORP.


SECTION	ONE
-----------

	BIBLOGRAPHY
	-----------

	PDP-10 REFERENCE HANDBOOK PAGE 189-281
					100-380-011-00
					PAGE	2

SECTION	TWO
-----------

	NEW CAPABILITIES
	----------------

1.	ADD CODE TO ASSEMBLE PROGRAMS INTO BOTH HIGH AND LOW SEGMENT
	RELOCATABLE BINARY.TO DO THIS CREATE NEW PSEUDO-OP TWOSEG.
	SEE APPENDIX 1 TO LOADER V52 UPDATE DOCUMENT PUBLISHED IN
	PDP-10 SOFTWARE BULLETIN VOL. 6 NUMBER 3 FOR DETAILS.

2.	OUTPUT SUPPRESSED INTERNALS WITH TOP FOUR BITS  44 INSTEAD
	OF 04. RESTRICTION! NEEDS LOADER V.52 TO LOAD THESE SYMBOLS.

3.	CHANGING THE SETTING OF QUOTSW TO BE 1 (FROM 0)
	GIVES CORRECT ASSEMBLY OF NESTED MACRO'S.
	NOTE. DDT V.22 WILL NOT ASSEMBLE USE DDT V.27 OR FIX V.22

4.	ADD CODE UNDER OPHSH=1 TO HASH CODE THE OPCODE TABLE.
	THIS SHOULD SPEED UP ASSEMBLIES BUT IT DOES NOT SEEM TO MAKE
	MUCH DIFFERENCE IN OVERALL TIMINGS BUT DOES COST 1/2K EXTRA.
	STANDARD SETTING IS OPHSH=0.

5.	IF QUOTSW=1 (NOW STANDARD) USE SINGLE QUOTES TO ENCLOSE
	SIXBIT IN THE WAY THAT DOUBLE QUOTES ENCLOSE ASCII.
	E.G.
	MOVSI	0,'DSK'
	MOVSI	0,(SIXBIT /DSK/)
	ARE IDENTICAL.

6.	DEFINE A MACRO SO THAT THE VERSION OF MACRO LISTED IN THE
	TITLE LINE OF AN ASSEMBLY LISTING ALWAYS REFLECTS BOTH THE
	DEC VERSION AND THE PATCH LEVEL.USERS MUST UPDATE VPATCH
	ON EACH UPDATE.

7.	IF NO LIT STATEMENT IS SEEN BEFORE THE END STATMENT THE LITERALS
	ARE XLISTED.THIS SEEMS TO BE WHAT MOST USERS WANT SINCE THEY
	USUALLY SPECIFICALLY XLIST THEM JUST PRIOR TO THE END PSEUDO-OP.
	USERS WHO WISH TO SEE THERE LITERALS CAN DO SO BY PUTTING
	A LIT PSEUDO-OP JUST BEFORE THE END.

8.	ADD MORE CALLI'S TO MACRO'S CALLI TABLE (UP TO CALLI 65)
	AND ADD TTCALL MNEMONICS TO MACRO SO THAT
	OUTSTR	MES
	WILL GENERATE SAME BINARY AS
	TTCALL	3,MES
	ETC.

9.	ADD NEW ASSEMBLY FEATURE CONTROL SEG2SW TO ASSEMBLE TWOSEG
	VERSION OF MACRO.THE SAME SHR FILE WILL  RESULT WHETHER TWOSEG
	IS ON OR OFF.STANDARD SETTING IS SEG2SW=1 IF ASSEMBLED BY 
	MACRO V.44 SEG2SW=0 OTHERWISE.

10.	ADD ASSEMBLY FEATURE IIISW.IF IIISW=1 Q ERRORS WILL NOT BE
	GENERATED ON SOME DUBIOUS CONSTRUCTIONS.
	STANDARD SETTING IS IIISW=0

11.	METHOD TO HALF-KILL SYMBOLS.THAT IS TO SET SUPPRESSED BIT SO
	THAT OUTPUT FROM DDT IS SUPPRESSED. TO DO FOR LABELS WHAT
	== DOES FOR ASSIGNMENTS.
	USE :! OR ::!
	LABEL:!		;WILL MAKE LABEL A SUPPRESSED LOCAL SYMBOL
	LABEL::!	;WILL MAKE LABEL A SUPPRESSED INTERNAL SYMBOL

12.	METHOD TO GENERATE EXTERNAL REQUESTS WITHOUT EXPLICIT EXTERN
	PSEUDO-OP.USE ##	I.E.
	MOVE	0,JOBREL##
	IS EQUIVALENT TO
	EXTERN	JOBREL
	MOVE	0,JOBREL

13.	CHANGE THE DEFAULT VALUE OF MLON/MLOFF TO BE
	MLON ON INITIALLY.
	THIS MAY CAUSE PROBLEMS IN OLDER PROGRAMS THEREFORE THIS 
	CAN BE OVERRIDDEN BY A SWITCH (/O FOR OLD) WHICH SETS
	MLOFF .

14.	CHANGE THE LOOKUP /ENTER SEQUENCE FROM
	BINARY,LIST,SOURCE	TO BE
	SOURCE,LIST,BINARY
	THIS IS SO THAT LEVEL D CAN PUT THE TWO OUTPUT FILES ON A
	DIFFERENT PHYSICAL UNIT FROM THE SOURCE AND FROM EACH OTHER.
	THIS SAVE A LOT OF DSK HEAD MOVEMENT ON A LARGE ASSEMBLY.

15.	ADD UNIVERSAL AND SEARCH PSEUDO-OPS.
	(SEE APPENDIX 1.)

16.	NOTE.	BECAUSE OF BUG FIXES
	THE STANDARD DEC VERSION OF MACRO IS NOW 6K PURE.
	THE PREVIOUS VERSION WAS 5K. (JUST UNDER 6K BOUND)
						100-380-011-00
						PAGE	4

	BUGS FIXED
	----------

1.	STR	10-1760,10-2751
	CAN NOT PUT CR IN DOUBLE QUOTES.

2.	STR	10-1778
	BLOCK TYPE 3 IS OUTPUT AT WRONG TIME.

3.	STR	10-1779,1970
	IF LAST LINE OF A LITERAL IS BLANK A "Q" ERROR IS GIVEN.

4.	10-1841
	CONROL CHARACTERS IN THE MIDDLE OF A SYMBOL TERMINATE ASSEMBLY
	OF SYMBOL.

5.	STR	10-1802
	MACRO DOES NOT ASSUME CCL AS DEFAULT  EXTENSION FOR @ FILE.

6.	STR	10-1856,10-1867,10-1937,10-1986
	MACRO GET ILL MEM REF. WHEN ASSEMBLING SOME PROGRAMS.

7.	STR	10-1864
	NESTED MULTI-LINE LITERALS GENERATE INCORRECT PROGRAM BREAK.

8.	STR	10-1907
	ERROR MESSAGES ON PASS 1 OMIT SEQUENCE NUMBERS.

9.	STR	10-1957,10-2299,10-2721
	OPCODES AND PSEUDO-OPS CANNOT BE USED AS LABELS ON END STATEMENT.

10.	STR	10-2016,10-2180
	ONE EXTRA CR-LF IS PUT INTO THE CREF FILE EACH TIME  AN
	XLISTED FORM FEED IS ENCOUNTERED.

11.	STR	10-2037
	COMMAND DECODER WILL ALLOW MULTIPLE SPECIFICATIONS OF SAME
	FIELD IN  A COMMAND STRING WITH NO ERROR MESSAGE.

12.	STR	10-2108
	IF A COMMENT LINE IS TWO LONG ON A SYMBOL DEFINITION LINE
	THEN THE SYMBOL DEFINITION IS NOT LISTED.

13.	STR	10-2246
	UNDEFINED OP CODE ONLY FLAGGED ON FIRST REFERENCE.

14.	STR	10-2290
	INCORRECT DIGNOSTIC IF CLOSING "]" MISSING ON A PROJ-PROG
	SPECIFICATION.

15.	STR	10-2303
	FORM FEED INSIDE A FALSE CONDITIONAL GETS COUNTED TWICE.

16.	10-2388, 10-2817
	RELOC DOES NOT WORK AS SPECIFIED IF LAST TWO PSEUDO-OPS
	WERE BOTH LOC.

17.	STR	10-2389,10-2393,10-2608
	IF ICCSW=1 IOWD PSEUDO-OP WILL NOT ASSEMBLE.

20.	STR	10-2457
	MACRO SHOULD REDUCE ITS SIZE AFTER ASSEMBLY TO WHAT IT WAS
	AT THE START OF ASSEMBLY.

21.	STR	10-2504
	PSEUDO-OPS IFB AND IFND DO NOT RECOGNISE TABS AS BLANKS.
	
22.	STR	10-2515
	MACRO GIVES A Q ERROR FOR A VALID CONSTRUCTION SUCH AS
	1.0E<N>	WHERE N=0
	HOWEVER ANSWER IS CORRECT.

23.	STR	10-2374,10-2602
	LITERALS DO NOT ASSEMBLE CORRECTLY WHEN PRGEND USED.

24.	STR	10-2614
	ILL MEM REF CAN OCCUR IN NESTED MACROS IF ">" IS PASSED
	AS PART OF AN ARGUMENT.

25.	STR	10-2629,10-2650
	IF MACRO WAS DEFINED WITH MORE ARGUMENTS THAN IT IS CALLED
	WITH ")" DOES NOT TERMINATE ARGUMENT SCAN.

26.	STR	10-2269,10-2640
	WITH MLON ON A LITERAL MAY NOT CLOSE IF AN ERROR OCCURED.
	DIAGNOSTIC IS "NO END STATEMENT".

27.	STR	10-2651
	MACRO SYMBOL TABLE SHOULD BE ALPHABETIC BY COLUMN NOT BY ROW.

28.	STR	10-2760
	^F1B34 DOES NOT GENERATE CORECT NUMBER.
	IF DECIMAL POINT IS MISSING THE B IS NOT SEEN.

29.	STR	10-2765
	PAGE AND SEQUENCE NUMBER ARE NOT OUTPUT ON PASS 1 IF
	PDLOV OR CORE EXCEEDED ERRORS OCCUR.

30.	STR	10-2863	
	INCORRECT DIAGNOSTIC IF "_" MISSING FROM COMMAND STRING.
						100-380-011-00
						PAGE	6

SECTION	THREE
-------------

	KNOWN OUTSTANDING BUGS
	----------------------

	STR	10-2444
	MACRO DOES NOT KNOW ABOUT LEVEL D ERROR MESSAGES.
	(QUOTA EXCEDED ETC.)



	KNOWN RELATED PROBLEMS
	----------------------

	DDT V.22 WILL NOT ASSEMBLE WITH MACRO V.44
	USE DDT V.27

	THE 5.1 MONITOR WILL NOT ASSEMBLE WITH MACRO V.44

	MCO	D#210
	COMMON
	MISSING " IN MONTAB

	MCO	D#220
	ONCMOD
	MISSING "]" AT ASKSP1
					100-380-011-00

	APPENDIX 1
	----------

	UNIVERSAL AND SEARCH 
	--------------------

UNIVERSAL
---------

	THE PSEUDO-OP UNIVERSAL MAY BE USED TO REPLACE A TITLE
	PSEUDO-OP.IT HAS ALL THE FUNCTIONS OF TITLE PLUS IT MAKE
	THE SYMBOL TABLE AVAILABLE TO OTHER PROGRAMS. THUS UNIVERSAL
	IS USED IN PARAMETER FILE SUCH AS THE MONITOR FILE S.MAC.
	THE FILE CAN CONTAIN DEFINITION,OPDEFS,MACROS ETC.,HOWEVER
	IT SHOULD NOT GENERATE CODE.SINCE SYMBOL DEFINITION NEED
	ONLY BE ASSEMBLED ON ONE PASS THE UNIVERSAL PROGRAM
	SHOULD BE A ONE PASS FILE TO SAVE TIME.THIS CAN BE
	DONE EITHER BY:-

	UNIVERSAL NAME
	PASS2
	.......
	END

	OR
	UNIVERSAL NAME
	IF2,<END>
	.......
	END
	THE FORMER WILL GENERATE A LISTING THE LATTER WILL NOT.

SEARCH
------
	THE SEARCH PSEUDO-OP OPENS A NAMED SYMBOL TABLE FOR MACRO
	TO SCAN IF THE REQUIRED SYMBOL IS NOT FOUND IN THE CURRENT
	SYMBOL TABLE.MULTIPLE SYMBOL TABLES MAY BE SPECIFIED;THEY
	WILL BE SEARCHED IN THE ORDER SPECIFIED.
	E.G.	SEARCH S,FT50S
	WHEN A SYMBOL IS FOUND IN AN AUXILLIARY SYMBOL TABLE IT IS
	MOVED INTO THE CURRENT SYMBOL TABLE SO THAT IT WILL BE FOUND
	QUICKLY NEXT TIME IT IS REFERENCED.

IMPLEMENTATION
--------------
	IF UNIVERSAL IS SEEN IN A PROGRAM THE NAME IS STORED IN A 
	TABLE AND A FLAG SET.WHEN THE END STATEMENT IS SEEN THE
	SYMBOL TABLE IS MOVED DOWN IN CORE TO JUST AFTER THE STACKS
	AND BUFFERS.THE FREE CORE POINTER IS MOVED TO AFTER THE TOP OF THE
	MOVED TABLE.POINTERS ARE STORED TO ENABLE THE TABLE TO BE SCANNED.
	WHEN SEARCH IS SEEN THE NAMES ARE COMPARED WITH THE UNIVERSAL
	TABLE TO SEE IF THE FILE HAS BEEN SEEN,IF NOT A MESSAGE
	"CANNOT FIND UNIVERSAL 'NAME'" IS OUTPUT.IF ALL IS WELL A TABLE
	OF SEARCHING SEQUENCE IS BUILT.WHENEVER A SYMBOL IS NOT
	FOUND IN THE CURRENT SYMBOL TABLE THE UNIVERSAL
	SYMBOL TABLES ARE SEARCHED ONE BY ONE IN THE SPECIFIED
	ORDER UNTIL EITHER THE SYMBOL IS FOUND OR ALL TABLE HAVE BEEN
	SEARCHED.WHEN THE SYMBOL IS FOUND IT IS MOVED INTO THE
	CURRENT SYMBOL TABLE.THIS SAVES TIME ON FUTURE REFERENCES
	AT THE EXPENSE OF CORE.

NOTES
-----
	THERE IS NO LIMIT TO THE NUMBER OF SYMBOL TABLES THAT CAN BE
	SPECIFIED,BUT EACH NAME COSTS FOUR WORD OF CORE.
	A PRACTICAL LIMIT OF TEN HAS BEEN SET, THIS CAN BE CHANGED
	BY REDEFINING THE SYMBOL .UNIV IN MACRO.
	BECAUSE MACRO MOVES THE UNIVERSAL SYMBOL TABLES TO AFTER
	THE PUSHDOWN STACKS AND BUFFERS THESE CANNOT BE INCREASED
	DURING ASSEMBLY,THUS THE FIRST ASSEMBLY SHOULD USE  THE
	MAXIMUM OF I/O DEVICES TO BE USED LATER.
	UNIVERSAL FILES MAY SEARCH OTHER UNIVERSAL FILES SO LONG AS
	ALL NAMES IN THE SEARCH LIST HAVE BEEN ASSEMBLED.
	THE LIST OF UNIVERSAL NAMES IS CLEARED ON EACH RUN OR START,
	HOWEVER IT IS NOT CLEARED WHEN MACRO TYPES AN ASTERISK.
	WHEN ASSEMBLING FROM INDIRECT FILES THE UNIVERSAL FILES MUST BE
	FORCED TO RECOMPIL BY USING /COMPIL OTHERWISE IF A REL FILE
	LATER THAN THE SOURCE EXISTS THE UNIVERSAL FILE WILL NOT
	BE COMPILED AND THE SYMBOL TABLE NOT AVAILABLE.
	SIMILARLY IF THE UNIVERSAL ROUTINE IS MODIFIED,
	ALL ROUTINES WHICH USE IT MUST BE RECOMPILED, EITHER USE
	/COMPIL OR DELETE ALL THE REL FILES.
                                                                                                                                                                                                                                                                                                                                                             