81 REM LOANPR.BAS  LOAN PRICE PROGRAM FOR THE X. LAST CHANGE  JULY 21
82 R6=.825
85 DATA END,END,END,END,END,END,END,END
95 REM *** START OF MODEL ***
110  REM # OF MONTHS
111 READ N1
120 DIM R(480),B(480),C(480),D(480),P(480),T(480),F(480),S(480),I(480)
130 REM COMMITMENT AMOUNT
131 READ C1
135 REM *** INTEREST RATES ***
140  REM INTEREST RATE OR FIRST GROUP
141 READ R
150 IF R>=1 THEN 180
160   REM SINGLE RATE USED
161 FOR I=1 TO N1
163 R(I)=R
165 NEXT I
170 GO TO 250
180  REM GROUP OF INTEREST RATES
190 READ S
195 FOR I=1 TO R
200 R(N+I)=S
205 NEXT I
210 READ S$
220 IF S$="END" THEN 250
225 N=N+R
230 R=VAL(S$)
240 GO TO 190
245 REM *** TAKEDOWN SCHEDULE (END OF PERIODS) ***
250 READ F1
260 M5=1
270 READ S$
280 IF S$<>"START" THEN 310
290  REM TAKEDOWN FULL AT START
292 T(0)=C1
300 GO TO 570
310 IF S$<>"EVEN" THEN 360
320  REM EVEN TAKEDOWN
321 READ M5,M1,M2,M3
330 M4=(M2-M1)/M3+1
340 FOR I=M1 TO M2 STEP M3
341 T(I)=C1*M5/M4
342 NEXT I
350 GO TO 570
360 IF S$<>"SETS" THEN 460
370  REM SETS OF TAKEDOWNS, FRACTIONS
371 N=0
380 READ R
390 READ S
400 IF ABS(S)> 1 THEN 410
402 S=S*C1
410 FOR I=1 TO R
411 T(N+I)=S
412 NEXT I
420 READ S$
430 IF S$="END" THEN 570
431 N=N+R
440 R=VAL(S$)
450 GO TO 390
460 IF S$<>"EACH" THEN 550
470  REM EACH PERIOD TAKEDOWNS
471 N=0
480 READ R
490 READ S
500 IF ABS(S)>1 THEN 510
501 S=S*C1
510 T(R)=S
520 READ S$
530 IF S$="END" THEN 570
531 R=VAL(S$)
540 GO TO 490
550 PRINT "BAD TAKEDOWN CODE = "; S$
560 STOP
570 REM *** REPAYMENT SCHEDULE (END OF PERIODS) ***
580 READ S$
590 IF S$<>"END" THEN 620
592 S=0
594 FOR I=0 TO N1
596 S=S+T(I)
598 NEXT I
600 REM REPAYMENT IN LAST PERIOD
601 P(N1)=S
610 GO TO 880
620 IF S$<>"EVEN" THEN 670
630  REM EVEN REPAYMENTS
631 READ M5,M1,M2,M3
640 M4=(M2-M1)/M3+1
650 FOR I=M1 TO M2 STEP M3
651 P(I)=C1*M5/M4
652 NEXT I
660 GO TO 880
670 IF S$<>"SETS" THEN 770
680  REM SETS OF REPAYMENTS, FRACTIONS
681 N=0
690 READ R
700 READ S
710 IF ABS(S)>1 THEN 720
715 S=S*C1
720 FOR I=1 TO R
722 P(N+I)=S
724 NEXT I
730 READ S$
740 IF S$="END" THEN 880
745 N=N+R
750 R=VAL(S$)
760 GO TO 700
770 IF S$<>"EACH" THEN 860
780  REM EACH PERIOD REPAYMENTS
781 N=0
790 READ R
800 READ S
810 IF ABS(S)>1 THEN 820
815 S=S*C1
820 P(R)=S
830 READ S$
840 IF S$="END" THEN 880
845 R=VAL(S$)
850 GO TO 800
860 PRINT "BAD PAYMENT CODE = ";S$
870 STOP
880 REM *** BALANCE CALCULATIONS ***
890 B(0)=T(0)-P(0)
900 FOR I=1 TO N1
901 B(I)=B(I-1)+T(I)-P(I)
902 NEXT I
910 FOR I=0 TO N1
911 C(I)=P(I)-T(I)
912 NEXT I
920 REM *** ACCEPT, CALCULATE FEES ***
930 READ S$
940 IF S$="NONE" THEN 1146
941 IF S$="END" THEN 1146
950 IF S$<>"C" THEN 1000
960   REM COMMITMENT FEE
961 READ S
970 IF ABS(S)>1 THEN 980
971 S=S*C1
980 F(0)=F(0)+S
990 GO TO 930
1000 IF S$<>"U" THEN 1040
1010   REM FEE ON UNUSED COMMITMENTS
1011 READ S
1015 FOR I=1 TO N1
1020  IF B(I-1)>=C1*.99999 THEN 1030
1022  F(I)=F(I)+S*(C1-B(I-1))/12
1025 NEXT I
1030 GO TO 930
1040 IF S$<>"B" THEN 1080
1050  REM FEE ON BALANCES USED
1051 READ S
1060 FOR I=1 TO N1
1061 F(I)=F(I)+S*B(I-1)/12
1062 NEXT I
1070 GO TO 930
1080  REM EACH PERIOD FEES
1081 IF S$<>"S" THEN 1126
1090 READ N,S
1100 IF ABS(S)>1 THEN 1110
1105 S=S*C1
1110 F(N)=F(N)+S
1120 GO TO 930
1126 IF S$="SETS" THEN 1131
1128 IF S$="KSETS" THEN 2000
1129 GOTO 1144
1131 N=0
1132 READ R
1133 READ S
1134 IF ABS(S)>1 THEN 1136
1135 S=S*C1
1136 FOR I=1 TO R
1137 F(N+I)=F(N+I)+S
1138 NEXT I
1139 READ S$
1140 IF S$="END" THEN 930
1141 N=N+R
1142 R=VAL(S$)
1143 GO TO 1133
1144 PRINT "BAD FEE CODE = "; S$
1145 STOP
1146 REM *** ACCEPT, CALCULATE COSTS ***
1150 READ S$
1160 IF S$="NONE" THEN 1350
1165 IF S$="END" THEN 1350
1170 IF S$<>"S" THEN 1220
1180 REM SPECIAL PERIOD EXPENSES
1181 READ N,S
1190 IF ABS(S)>1 THEN 1200
1196 S=S*C1
1200 S(N)=S(N)+S
1210 GO TO 1150
1220 IF S$<>"P" THEN 1270
1230 REM MONTHLY COSTS, REGULARLY
1231 READ S
1240 IF ABS(S)>1 THEN 1250
1245 S=S*C1/12
1250 FOR I=1 TO N1
1252 S(I)=S(I)+S
1254 NEXT I
1260 GO TO 1150
1270 IF S$<>"B" THEN 1325
1280  REM COSTS ON LOAN BALANCES
1281 READ S
1290 FOR I=1 TO N1
1300  S(I)=S(I)+S*B(I-1)/12
1310 NEXT I
1320 GO TO 1150
1325 IF S$="SETS" THEN 1344
1329 IF S$="KSETS" THEN 2100
1331 N=0
1332 READ R
1333 READ S
1334 IF ABS(S)>1 THEN 1336
1335 S=S*C1
1336 FOR I=1 TO R
1337 S(N+I)=S(N+I)+S
1338 NEXT I
1339 READ S$
1340 IF S$="END" THEN 1150
1341 N=N+R
1342 R=VAL(S$)
1343 GO TO 1333
1344 PRINT "BAD COST CODE = "; S$
1345 STOP
1350 MAT F=F-S
1352 GOSUB 2198
1353 MAT T=T-P
1355 REM *** CALCULATE INTEREST RECEIPTS ***
1360 FOR I=1 TO N1
1361 I(I)=B(I-1)*R(I)/12*365/360
1363 NEXT I
1370 IF F1=1 THEN 1410
1380 FOR J=F1 TO N1 STEP F1
1390 FOR I=(J-1) TO (J+1-F1) STEP -1
1392  I(J)=I(J)+I(I)
1393 NEXT I
1394 NEXT J
1395 IF N1-F1*SGN(N1/F1)*INT(ABS(N1/F1))=0 THEN 1405
1398 FOR I=N1-1 TO 0 STEP -1
1399 IF I-F1*SGN(I/F1)*INT(ABS(I/F1))=0 THEN 1405
1400 I(N1)=I(N1)+I(I)
1402 NEXT I
1405 FOR I=1 TO N1-1
1406  IF I-F1*SGN(I/F1)*INT(ABS(I/F1))=0 THEN 1409
1408 I(I)=0
1409 NEXT I
1410 FOR I=F1 TO N1 
1411 C(I) = C(I) + I(I) 
1412 NEXT I
1413 FOR I=0 TO N1
1414 C(I)=C(I)+F(I)+S(I) 
1415 NEXT I
1420 REM *** CALCULATE RATE OF RETURN ***
1430 X2=1-.05/12
1440 FOR J2=1 TO 20
1450  Z8=0
1451 A2=C(0)
1452A3=X2
1453A4=1
1454 REM
1460  FOR I=1 TO N1
1470   A2=A2+C(I)*A3
1471 Z8=Z8+I*C(I)*A4
1480   A3=A3*X2
1481 A4=A4*X2
1490  NEXT I
1500  IF ABS(A2/Z8/X2)<1E-06 THEN 1560
1510  X2=X2-A2/Z8
1520 NEXT J2
1530 PRINT "CANNOT FIND RATE OF RETURN, CASH FLOWS ARE"
1540 FOR I=1 TO N1
1541 PRINT C(I);
1543 IF I-5*SGN(I/5)*INT(ABS(I/5))<>0 THEN 1545
1544 PRINT
1545 NEXT I
1550 STOP
1560 X2=(1/X2-1)*1200
1562 FOR I=1 TO 3
1563 PRINT
1564 NEXT I
1565 PRINT "EFFECTIVE YIELD IS :"
1566 PRINT USING 1567,X2
1567 :#####.### PCT, MONTHLY COMPOUNDED, OR
1568 PRINT USING "#####.### PCT EFFECTIVE ANNUAL RATE",((1+X2/1200)^12-1)*100
1570 V1=0
1571 FOR I=0 TO N1
1572 V1=V1+C(I) 
1573 NEXT I
1574 V1=V1*12/X2/N1*100
1575 PRINT
1576 PRINT "AVERAGE BANK FUNDS EARNING THIS YIELD"
1577 PRINT "(NOT ALWAYS SAME AS LOAN BALANCE)"
1578 PRINT USING    "OVER THE ### MONTHS IS ########", N1,V1
1579 FOR I=1 TO 3
1580 PRINT
1581 NEXT I
1582 REM *** REPORT PRINTING ***
1583 PRINT "REPORT (YES/NO) = ";
1590 INPUT S$
1592 N2=1
1593 IF S$="YES*" THEN 2610
1594 IF INSTR(S$,"/")=0 THEN 1600
1596 N2=VAL(RIGHT$(S$,LEN(S$)-INSTR(S$,"/"     )))
1598 S$="YES"
1600 IF S$<>"YES" THEN 2730
1605 FOR I=1 TO 3
1607 PRINT
1609 NEXT I
1610 PRINT "PER  TAKEDOWN,      LOAN INTEREST  FEES &  BALANCE             INT."
1620 PRINT "IOD  REPAYMENT    BALANCE  INCOME   COSTS  CHANGES CASH-FLOW   RATE"
1630 :#### ######### ########## ####### ####### ######## ######### ##.###
1640 PRINT
1645 IF S$<"YES" THEN 1651
1647 A=N2
1648 B=N1
1649 C=N2
1651  PRINT USING 1630,0,T(0),B(0),I(0),F(0),S(0),C(0),R(0)*100
1652 FOR I=A TO B STEP C
1660  PRINT USING 1630 ,I,T(I),B(I),I(I),F(I),S(I),C(I),R(I)*100
1670 NEXT I
1672 GOSUB 2510
1675 FOR I= 1 TO 3
1676 PRINT
1677 NEXT I
1680 STOP
1990 REM *** KSETS FOR FEES AND COSTS ***
2000 REM KSET FEES
2001 READ S,A,B,C
2010 IF ABS(S)>1 THEN 2020
2015 S=S*C1
2020 FOR I=A TO B STEP C
2021 F(I)=F(I)+S 
2022 NEXT I
2030 GO TO 930
2100 REM KSET COSTS
2101 READ S,A,B,C
2110 IF ABS(S)>1 THEN 2120
2115 S=S*C1
2120 FOR I=A TO B STEP C
2121 S(I)=S(I)+S 
2123 NEXT I
2130 GO TO 1150
2195 REM *** COMMENSURATE BALANCE COMPUTATIONS ***
2198 REM TRANSFER STEP (CONTINUE)
2199 FOR I=0 TO N1
2200 S(I)=0
2201 NEXT I
2203 READ S$
2210 IF S$="END" THEN 2480
2215 IF S$="NONE" THEN 2480
2220 IF S$<>"USED" THEN 2260
2230 REM BALANCES ON FUNDS USED
2231 READ R
2240 FOR I=0 TO N1
2241 S(I)=S(I)+R*R6*(T(I)-P(I)) 
2242 NEXT I
2250 GO TO 2203
2260 IF S$<>"COM" THEN 2300 
2270 REM BALANCES ON COMMITMENT AMOUNT
2271 READ R 
2280 S(0)=R*R6*C1+S(0)
2281 S(N1)=S(N1)-R*C1*R6
2290 GO TO 2203
2300 IF S$<>"OPEN" THEN 2340
2310  REM BALANCES ON UNUSED FUNDS
2311 READ R
2320 FOR I=0 TO N1
2321 S(I)=S(I)+R*R6*(C1-B(I)) 
2322 NEXT I
2330 GO TO 2203
2340 IF S$<>"MAX" THEN 2432
2350 REM BALANCES ON COMMITMENTS, USED FUNDS
2351 READ S,R
2360 S(0)=S(0)+FNM(R*T(0),S*C1)*R6
2370 FOR I=1 TO N1
2380  X=FNM(R*B(I-1),S*C1)
2390  Y=FNM(R*B(I),S*C1)
2400  S(I)=S(I)+(Y-X)*R6
2410 NEXT I
2420 S(N1)=S(N1)-Y*R6
2430 GO TO 2203
2432 IF S$<>"DOLLARS" THEN 2440
2434 REM EXACT DOLLAR BALANCES
2435 READ R
2436 S(0)=S(0)+R*R6
2437 S(N1)=S(N1)-R*R6
2438 GO TO 2203
2440 PRINT "BAD BALANCE CODE = ";S$
2450 STOP
2480 RETURN
2500 REM *** REPORT ADDITIONS ***
2510 V1=0
2512 V2=0
2513 V3=0
2520 FOR I=1 TO N1
2521 V1=V1+I(I) 
2522 NEXT I
2530 FOR I=0 TO N1
2531 V2=V2+F(I) 
2532 NEXT I
2540 FOR I=0 TO N1-1
2541 V3=V3+B(I) 
2542 NEXT I
2550 V3=V3/N1
2560 PRINT
2570 PRINT USING"AVERAGE LOAN BALANCE = ######### ",V3
2580 PRINT USING"TOTAL FEES/COSTS =     ######### ",V2
2590 PRINT USING"TOTAL INTEREST INCOME = ######## ",V1
2600 RETURN
2610 PRINT "START, STOP, INCREMENT = ";
2620 INPUT A,B,C
2630 FOR J=A TO B STEP C
2640  FOR I=J-1 TO J+1-C STEP -1
2650   C(J) = C(J)+C(I)
2660   T(J) = T(J)+T(I)
2670   F(J) = F(J)+F(I)
2680   S(J) = S(J)+S(I)
2690   I(J) = I(J)+I(I)
2700  NEXT I
2710 NEXT J
2712 FOR J=A TO B
2713  IF (J-A)-C*SGN((J-A)/C)*INT(ABS((J-A)/C))=0 THEN 2716
2714 I(J)=0
2715 F(J)=0
2716 NEXT J
2720 GOTO 1605
2730 STOP
2740 DEF FNM(X,Y)
2750 REM THIS DEF FUNCTION GIVES THE MAX(X,Y)
2755 FNM=X
2760 IF Y<=X THEN 2780
2770 FNM=Y
2780 FNEND
10000 END
    