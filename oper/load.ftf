C
       TYPE 101
101    FORMAT(' MODE,XCUT,YCUT,HEIGHT'/)
       ACCEPT 100,MODE,NI,NJ,TRUNC,DUMMY
100    FORMAT(10F10.0)
C
       CALL PLOTS
      CALL PLOT(1.,1.,-3)
      XXX=SURF(-NI,-NJ)
      CALL INLI(NI,NJ,3.,3.,3.5,TRUNC)
      CALL PL3DI(MODE)
      CALLSETTC
      STOP
      END
C
      FUNCTION SURF(I,J)
      IF (I) 2,2,5
2     NX=-I
      NY=-J
      I0=(NX+1)/2
      J0=(NY+1)/2
      SURF=0.
      RETURN
5     C=2.*3.14159/I0
      R=SQRT((FLOAT(I-I0))**2 + (FLOAT(J-J0))**2) * C
      IF (R) 10,10,20
10    SURF=1.
      RETURN
20    SURF=ABS(SIN(R)/R)
      RETURN
      END
*           
      SUBROUTINE INLI(NX,NY,DX,DY,HT,TR)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      CALL INLJ(NX,NY,DX,DY,HT)
      CALL TRUNC(TR)
      RETURN
      END
      SUBROUTINE INLJ(NX,NY,X1,X2,X3)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      COMMON NI,NJ,IX0,IX1,IX2,IX3,IX4
      NI=NX
      NJ=NY
      IX1=1000.*X1
      IX2=1000.*X2
      IX3=1000.*X3
      IX4=100000
      RETURN
      END
      SUBROUTINE INLP(I1,I2,X1,X2,X3,X4,X5,X6,X7)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      RES=.01
      CALL INLQ(I1,I2,X1,X2,X3,X4,X5,X6,X7,RES)
      RETURN
      END
      SUBROUTINE INLQ(I1,I2,X1,X2,X3,X4,X5,X6,X7,X8)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      DIMENSION IDUM(8),DUM(15)
      COMMON NX,NY,JFL,IDUM,DX,DY,DZ,VX,VY,VZ,XREF,DUM,S,S1,S2
      SS=X8
      IDUM(4)=1000.*X7
      IDUM(8)=0
   10 S1=100.*SS
      S2=S1
      S=1.
      VX=X1/S1
      VY=X2/S1
      VZ=X3/S1
      DX=X4/S1
      DY=X5/S1
      DZ=X6/S1
      NX=I1
      NY=I2
      XREF=0.
      JFL=1
      U=AMAX1(DX/1200.,DY/1200.,(DX+DY)/2000.)
      IF(U-SS) 2,2,1
    1 SS=U
      GO TO 10
    2 RETURN
      END
      SUBROUTINE INLS(NXX,NYY,XX,YY,RR,AA,BB,DZZ,TR)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      RES=.01
      CALL INLR(NXX,NYY,XX,YY,RR,AA,BB,DZZ,TR,RES)
      RETURN
      END
      SUBROUTINE INLR(NXX,NYY,XX,YY,RR,AA,BB,DZZ,TR,SS)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      DIMENSION IDUM(9),DUM(10)
      COMMON NX,NY,IDUM,DX,DY,DZ,VX,VY,VZ,XREF,X,Y,R,A,B,DUM,S,S1,S2
      IDUM(5)=1000.*TR
      IDUM(9)=0
      XREF=0.
      S1=100.*SS
      S2=S1
      S=1.
      X=XX
      Y=YY
      R=RR
      A=AA*1.74533E-2
      B=BB*1.74533E-2
      DZ=DZZ*COS(BB*1.74533E-2)/S1
      NX=NXX
      NY=NYY
      CALL INLX
      RETURN
      END
      SUBROUTINE INLX
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      DIMENSION IDUM(8),DUM(10)
      COMMON NX,NY,JFL,IDUM,DX,DY,DZ,VX,VY,VZ,XREF,X,Y,R,A,B,DUM,S,S1,S2
   10 CA=COS(A)
      SA=SIN(A)
      CB=COS(B)
      SB=SIN(B)
      VX=R*CA/(SA*CB*S1)
      VY=R*SA/(CA*CB*S1)
      VZ=R*SB/(CB*S1)
      DX=X*SA*CB/R
      DX=DX*VX/(1.+DX)
      DY=Y*CA*CB/R
      DY=DY*VY/(1.+DY)
      JFL=1
      U=AMAX1(DX/1200.,DY/1200.,(DX+DY)/2000.)
      IF(U-S1/100.) 2,2,1
    1 DZ=DZ*S1
      S1=U*100.
      S2=S1
      DZ=DZ/S1
      GO TO 10
    2 RETURN
      END
      SUBROUTINE STREO(D,S)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      DIMENSION IDUM(9),DUM(10)
	      COMMON NX,NY,IDUM,DX,DY,DZ,VX,VY,VZ,XREF,X,Y,R,A,B,DUM,SS,S1,S2
      IF(S+99.) 11,11,10
   10 XREF=DX+DY+S/S1
   11 A=A+D/R
      CALL INLX
      RETURN
      END
      SUBROUTINE PL3DI(I1)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      DIMENSION IDUM(5),DUM(23),D2(7),Z0(2001)
      COMMON NX,NY,IX0,IX1,IX2,IX3,IDUM,DUM,S1,D2,Z0
      MODE=I1
      DX=FLOAT(IX1)*.001
      DY=FLOAT(IX2)*.001
	      HT=FLOAT(IX3)*.001
      TR=FLOAT(IDUM(1))*.001
      IF(MODE+7) 7,6,6
    6 IF(MODE) 8,7,8
    7 MODE=-1
    8 M=IABS(MODE)
      X1=1000000.
      X2=1000.
      X3=1000.
      X4=DX
      X5=DY
      GO TO(11,14,15,13,11,15,13,11,15,13),M
   11 X1=1000.
      X2=1000000.
      GO TO 15
   13 X1=2000.
      X2=2000.
      GO TO 15
   14 X2=-DX/2.
      X5=-DY*DX/2000.
   15 CALL INLQ(NX,NY,X1,X2,X3,X4,X5,HT,TR,.01)
      L=MODE+8
      GO TO(21,21,22,22,22,22,21,22,24,22,23,23,23,24,24,25,25,25),L
   21 L=-2
      GO TO 26
   22 L=-1
      GO TO 26
   23 L=1
      GO TO 26
   24 L=2
      GO TO 26
   25 L=3
   26 CALL PL3DP(L)
      IF(MODE-2) 28,27,28
   27 CALL PPL(0.,Z0(3),3)
      CALL PPL(0.,0.,2)
      CALL PPL(DX/S1,0.,2)
      L=DX*100.
      CALL PPL(DX/S1,Z0(L-2),2)
   28 RETURN
      END
      SUBROUTINE PL3DP(MODE)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      IF(ABS(MODE-.5)-2.6) 9,9,7
    7 MODE=-1
    9 IF(MODE) 10,7,12
   10 CALL PLP(-MODE)
   11 RETURN
   12 L1=2
      M1=1
      M2=2
      M=1
      GO TO(13,14,15),MODE
13      L2=4
      GO TO 16
   14 L1=1
      L2=3
      M=2
      GO TO 16
   15 L2=1
      M1=0
      M2=0
   16 CALL SIDEP(L1,M1)
      CALL PLP(M)
      CALL SIDEP(L2,M2)
      IF(MODE-3) 18,17,18
   17 CALL PLP(2)
   18 CALL BASE
      RETURN
      END
      SUBROUTINE TRUNC(TR)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      DIMENSION ID1(6),ID2(4),DUM(23)
      COMMON ID1,ITR,ID2,DUM,S1
      ITR=1000.*TR
      RETURN
      END
      SUBROUTINE PLP(MODE)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      DIMENSION IDUM(8),DUMMY(5),B(10)
      COMMON NX,NY,JFL,IDUM,DX,DY,DZ,VX,VY,VZ,XREF,DUMMY,B,S
      IF(JFL) 11,11,10
   10 CALL CUT(VX,DX,VY,DY,0,0,NX,NY,0)
   11 IF(MODE-1) 19,19,21
   19 DO 20 J=1,NY
   20 CALL CUT(VX,DX,VY,DY,0,J,NX,NY,1)
      GO TO 30
   21 DO 22 I=1,NX
   22 CALL CUT(VY,DY,VX,DX,NX-I+1,0,NY,NX,1)
   30 CALL TRANS(DX,0.,X,Y)
      B(1)=.01+XREF
      B(2)=DX+.01+XREF
      B(3)=DX+DY+.01+XREF
      B(5)=Y
      B(7)=0.
      CALL TRANS(0.,DY,X,Y)
      B(9)=Y
      COST=(FLOAT((MODE-1)*NX)*DY+FLOAT((2-MODE)*NY)*DX)*.0075
      PRINT 100,COST
  100 FORMAT(1X5HCOST=F6.3)
      RETURN
      END
      SUBROUTINE CUT(VXY,DXY,VYX,DYX,I,J,NXY,NYX,KFL)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      DIMENSION Z0(2001),Z(1201),B(10),IDUM(8),D1(5),D2(8)
      COMMON NX,NY,IDUM,LN,DX,DY,DZ,VX,VY,VZ,XREF,D1,B,S,D2,Z0,Z
      AA(D,V,A)=A*D/(1.-D*(1.-A)/V)
      TRUNC=.001*FLOAT(IDUM(5))/D2(1)
      IF(I+J) 13,13,15
   13 DO 14 K=1,2001
   14 Z0(K)=-5.
      RETURN
   15 M=0
      IF(I) 150,17,150
  150 IF(J) 17,16,17
   16 M=1
   17 IDIR=MOD(I+J,2)
      YX=AA(DYX,VYX,FLOAT(M*(NX-I+1)+J-1)/FLOAT(NYX-1))
      CALL TRANS(YX*FLOAT(M),YX*FLOAT(1-M),X1,Y1)
      DEL=X1*FLOAT(1-2*M)
      UU=VXY+DEL
      H=VZ-Y1
      DU=DZ*(1.-DEL/VYX)
      A1=DX*FLOAT(1-M)+YX*FLOAT(M)
      A2=DY*FLOAT(M)+YX*FLOAT(1-M)
      CALL TRANS(A1,A2,X2,Y2)
      UN=(X1-X2)*FLOAT(1-2*M)
      CALL XFORM(1.,0.,X2,Y2)
      X0=X1+X2+.0101
      IXX=100.*(X0-XREF)
      ISGN=1
      IF(UU) 170,170,18
  170 ISGN=-1
   18 Y0=Y1
      IFLAG=-1
      K=0
      U1=0.
      F1=0.
      U2=0.
      F2=SURF(I+NX*(1-M),J+M)
      Z(1)=F2*DU+Y0
   19 DO 28 L=1,1200
      U=.01*L
      IF(U-U2) 24,24,20
   20 K=K+1
      IF(K-NXY+1) 22,22,29
   22 U1=U2
      F0=F1
	      F1=F2
      U2=AA(UN,UU,FLOAT(K)/FLOAT(NXY-1))*FLOAT(ISGN)
      F2=SURF((NX-K)*(1-M)+I,J+(K+1)*M)
      IF(U-U2) 220,220,20
  220 D=AMAX1(U2-U1,.001)
      IF(K-1) 23,23,24
   23 F0=2.*F1-F2
   24 P=(U-U1)/D
      IF(LN) 26,26,25
   25 F=F1*(1.-P)+F2*P
      GO TO 27
   26 F=.5*P*((P-1.)*F0+(P+1.)*F2)+(1.-P*P)*F1
   27 F=AMIN1(F,TRUNC)
      Y=F*DU*(1.-U/UU)+U*H/UU
      Z(L+1)=Y*FLOAT(ISGN)+Y0
   28 CONTINUE
   29 DO 30 K=1,L
      IX=IXX+((K-1)*IDIR+(L-K)*(1-IDIR))*(2*M-1)*ISGN
      X=.01*FLOAT(IX)+XREF
      KK=K*IDIR+(L+1-K)*(1-IDIR)
      IF(KFL) 290,290,291
  290 Z0(IX)=Z(KK)
      GO TO 30
  291 CALL PLGIC(X,Z(KK),Z0(IX),IFLAG)
   30 CONTINUE
      CALL BSINL(I,J)
      RETURN
      END
      SUBROUTINE BSINL(I,J)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      DIMENSION IDUM(9),DUM(5),B(10),D2(9),Z0(2001)
      COMMON NX,NY,IDUM,DX,DY,DZ,VX,VY,VZ,XREF,DUM,B,D2,Z0
	      IX=1
      IF(I-1) 32,31,32
   31 B(4)=Z0(IX)
   32 IF(J-1) 34,33,34
   33 B(4)=Z0(IX)
      IX=IX+100.*DX
      B(6)=Z0(IX)
   34 IF(I-NX) 36,35,36
   35 IX=IX+100.*DX
      B(6)=Z0(IX)
      IX=IX+100.*DY-1.
      B(8)=Z0(IX)
   36 IF(J-NY) 38,37,38
   37 IX=IX+100.*(DX+DY)-1.
      B(8)=Z0(IX)
   38 CONTINUE
      RETURN
      END
      SUBROUTINE SIDEP(IP,M)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      DIMENSION IDUM(8)
      COMMON NX,NY,JFL,IDUM,DX,DY,DZ,VX,VY,VZ,XREF
      JFL=1
      KFL=1
      L=M+1
      GO TO(10,11,13,12),L
   10 KFL=0
   11 JFL=0
   12 CALL CUT(VX,DX,VY,DY,0,0,NX,NY,0)
   13 GO TO(21,22,23,24),IP
   21 CALL CUT(VX,DX,VY,DY,0,1,NX,NY,KFL)
      GO TO 30
   22 CALL CUT(VY,DY,VX,DX,NX,0,NY,NX,KFL)
      GO TO 30
   23 CALL CUT(VX,DX,VY,DY,0,NY,NX,NY,KFL)
      GO TO 30
   24 CALL CUT(VY,DY,VX,DX,1,0,NY,NX,KFL)
	   30 RETURN
      END
      SUBROUTINE XFORM(SX,SY,CX,CY)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC++CC+++++
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      DIMENSION IDUM(9)
      COMMON NX,NY,IDUM,DX,DY,DZ,VX,VY,VZ,XREF
      U(D,V,A)=A*D/(1.-D*(1.-A)/V)
      SXX=1.-SX
      CALL TRANS(U(DX,VX,SXX),U(DY,VY,SY),CX,CY)
      CX=CX+XREF+DX
        IF(VX)1,1,2
1       CX=CX-DX
      GO TO 4
    2 IF(VY+DX) 3,3,4
    3 CALL TRANS(U(DX,VX,1.),U(DY,VY,1.),X1,Y1)
      CX=CX-DX-X1
    4 RETURN
      END
      SUBROUTINE TRANS(XL,YL,XP,YP)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      DIMENSION IDUM(9)
      COMMON NX,NY,IDUM,DX,DY,DZ,VX,VY,VZ
      X=XL
      Y=YL
      D=1.-(X/VX)*(Y/VY)
      XP=Y*(1.-X/VX)-X*(1.-Y/VY)
      XP=XP/D
      YP=X/VX+Y/VY-2.*(X/VX)*(Y/VY)
      YP=VZ*YP/D
      RETURN
      END
      SUBROUTINE AXISP(I1,V,D)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      DIMENSION IDUM(9),DUMMY(25)
      COMMON IDUM,IP,LN,DUMMY,X1,X2,X3,Y1,Y2,Y3
      IP=I1
      I=0
      X1=V
      X2=V
      Y1=V
      Y2=V
      GO TO(1,2,3,4),IP
    1 I=1
      Y1=0.
      Y2=-D
      GO TO 10
    2 I=1
      X1=1.
      X2=1.+D
      GO TO 10
    3 Y1=1.
      Y2=1.+D
      GO TO 10
    4 X1=0.
      X2=-D
   10 CALL XFORM(X1,Y1,X1,Y1)
      CALL XFORM(X2,Y2,X2,Y2)
      CALL LNE(I)
      RETURN
      END
      FUNCTION VERT(X,Y)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      DIMENSION IDUM(11)
      COMMON IDUM,DX,DY,DZ,VX,VY
      CALL XFORM(1.,Y,CX,CY)
      U=VX+CX-DX
      H=1.-(CX-DX)/VY
      CALL XFORM(X,Y,CX,CY)
      V=VX+CX-DX
      VERT=(1.-(U-V)/U)*H
	      RETURN
      END
      SUBROUTINE BASE
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      DIMENSION IDUM(11),DUMMY(12),B(10)
      COMMON IDUM,DUMMY,B
      CALL PPL(B(1),B(4),3)
      CALL PPL(B(1),B(5),2)
      CALL PPL(B(2),B(7),2)
      CALL PPL(B(2),B(6),2)
      CALL PPL(B(2),B(7),3)
      CALL PPL(B(3),B(9),2)
      CALL PPL(B(3),B(8),2)
      RETURN
      END
      SUBROUTINE LNE(IFL)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      DIMENSION IDUM( 9),DUMMY(22),Z0(2001)
      COMMON IDUM,IP,LN,DUMMY,S,S1,S2,X1,X2,X3,Y1,Y2,Y3,Z0
      IF(IFL) 8,8,15
    8 IF(ABS(X2-X1)-.01) 9,9,10
    9 IX=X2*100./S1
      X3=X2
      Y3=Z0(IX)
      GO TO 16
   10 DO 13 J=1,1000
      X=X2-(J-1)*SIGN(.01,X2-X1)/S
      IF((X-X1)*SIGN(1.,X2-X1)) 14,14,11
   11 Y=Y2+(X-X2)*(Y2-Y1)/(X2-X1)
      IX=100.*X*S
      IF(IX) 13,13,12
   12 IF(Y-Z0(IX)) 14,14,13
   13 CONTINUE
   14 X3=X
      Y3=Y
      GO TO 16
   15 X3=X1
      Y3=Y1
   16 CALL PPL(X3,Y3,3)
      CALL PPL(X2,Y2,2)
      RETURN
      END
      SUBROUTINE LABEL(LAB,N,H)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      DIMENSION LAB(10),DUMMY(22)
      COMMON NI,NJ,IDEL,JDEL,MODE,KMODE,NX,NY,JFL,IP,LN,DUMMY,S,S1,S2,
     1X1,X2,X3,Y1,Y2,Y3
      R=SQRT(((X3-X2)*S1)**2+((Y3-Y2)*S2)**2)
      IF(R) 41,41,16
   16 IF(ABS(X3-X2)-.01) 17,17,18
   17 ANGLE=1.57079
      GO TO 19
   18 ANGLE=ATAN((Y3-Y2)*S2/((X3-X2)*S1))
   19 IF(S-.9) 20,20,22
   20 IF(MODE+1) 21,21,22
   21 GO TO(32,32,23,23),IP
   22 GO TO(23,32,32,23),IP
   23 R1=AMAX1(R,(2.+N)*H)
      A=-ATAN(.1/R1)-3.14159
      GO TO 40
   32 R1=AMAX1(R-N*H,2.*H)
      A=ATAN(.1/R1)
   40 A=ANGLE+A
      R2=SQRT(R1**2+.01)
      X4=X3+R2*COS(A)/S1
      Y4=Y3+R2*SIN(A)/S2
      CALL SYMBOL(X4*S1,Y4*S2,H,LAB,ANGLE*57.3,N)
   41 RETURN
      END
      SUBROUTINE LNR(I)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      DIMENSION IDUM(10)
      COMMON IDUM,LN
      LN=0
      IF(I-1) 1,1,2
    1 LN=1
    2 RETURN
      END
      SUBROUTINE PPL(X,Y,M)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      DIMENSION IDUM(11),DUMMY(22)
      COMMON IDUM,DUMMY,S,S1,S2
      CALL PLOT(S1*X,S2*Y,M)
      RETURN
      END
      SUBROUTINE PLGIC(X,F,Z,IFLAG)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      DIMENSION IDUM(11),DUMMY(22)
      COMMON IDUM,DUMMY,S,S1,S2
      IF(IFLAG) 37,30,33
   30 IF(F-Z) 40,31,31
   31 IF(Z) 38,38,39
   33 IF(F-Z) 34,35,35
   34 IFLAG=0
      GO TO 36
   35 Z=F
   36 M=2
      GO TO 390
   37 IF(F-Z) 40,38,38
   38 Z=F
   39 IFLAG=1
      M=3
  390 CALL PLOT(S1*X,S2*Z,M)
   40 RETURN
      END
    