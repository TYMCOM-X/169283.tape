C***************************************************
C*
C*      PLOT PROGRM FOR COMBUSTION POWER DATA TAPES
C*      PLOT DISC TRACK DATA ON ZETA PLOTTER
C*
C*      WRITTEN BY B.T.POWELL,TYMSHARE
C*
C*      VERSION 6-4-73.OFFLINE PLOT....CHANGE ORDER OF CALLS TO PLOT BEFORE
C*       RETURNING THRU DYNARY ROUTINE
C***********************************************************************************
C
C
        INTEGER TABLE(1234),RESPONSE
        INTEGER YES,TCHARS,ITRK(13),KTEN(0/13),PTITLE(12),IXLABEL(12)
     1,IYLABEL(12),INERR,NTRACE,ASKTRK(13),NSYMB(13),IXCHARS,IYCHARS
        COMMON /COMPKG/ TABLE
        REAL XLENGTH,XSMALL,XLARGE,XDELTA,YLARGE,YSMALL,YLENGTH,YDELTA
        DOUBLE PRECISION DFILE
        COMMON /DVAL/NTRACE,KTEN,XSMALL,XLARGE,YSMALL,YLARGE,ASKTRK,YES
     1,NSYMB,XDELTA,XLENGTH,IXCHARS,IXLABEL,YDELTA,YLENGTH,IYCHARS
     2,IYLABEL,TCHARS,PTITLE,DFILE
        REAL XARRAY(1),Y1(1),Y2(1),Y3(1),Y4(1),Y5(1),Y6(1),Y7(1)
     1,Y8(1),Y9(1),Y10(1),Y11(1),Y12(1),Y13(1)
        EXTERNAL DVALUE
C
C
C.......INITIALIZE SECTION...TABLE(3)=UNIT #
C
        IREPEAT=0
        DATA YES /'Y'/
        TABLE(3)=10
C
C.......OPEN FILE
C
5       WRITE(5,910)
910     FORMAT(//25H NAME OF INPUT DATA FILE?$)
        ACCEPT 912,DFILE
912     FORMAT(2A5)
        OPEN(10,DFILE,INPUT,SYMBOLIC,ERR=15)
10      GO TO 20
15      WRITE(5,914)
914     FORMAT(' BAD FILE,RETYPE')
        GO TO 5
C
C
20      CALL NEWLINE
        JLENGTH=TABLE(5)
        WRITE(5,916)
916     FORMAT(//' FILE CONTAINS:'/)
        CALL WRINLIN(5,1,JLENGTH)
        TYPE 918
918     FORMAT(/' OK?(Y OR N)'$)
        ACCEPT 920,RESPONSE
920     FORMAT(A1)
        IF(RESPONSE.EQ.YES)GO TO 30
C
C.......WRONG DATA FILE
C
        CLOSE(10)
        GO TO 5
C
C.......READ VARIOUS INPUTS
C
30      READ(10,922)DISCNO,KPR,NC,ZER
922     FORMAT(I5,2I4,F8.2)
C
C.......READ TRACK NUMBERS INTO ARRAY
C
        DO 40 I=1,NC
40      READ(10,924)ITRK(I)
924     FORMAT(I4)
C
C.......READ IN POWERS OF 10
        READ(10,926)(KTEN(J),J=0,NC)
926     FORMAT(I4,13I3)
        INITLIN=NC+3
C*****************************
C
C.......GET TERMINAL INPUTS
C
C****************************************************
49      TABLE(3)=5
50      WRITE(5,927)
927     FORMAT(/' TYPE IN PLOT TITLE(60 CHARS OR LESS)'/)
        CALL NEWLINE
        TCHARS=TABLE(5)
C
C.......TITLE LENGTH CHECK
C
        IF (TCHARS.LE.60)GO TO 60
        WRITE(5,928)
928     FORMAT(/' ERROR, TOO LONG - RETYPE'/)
        GO TO 50
60      CALL GETSTR(PTITLE,LENGTH,60)
C
C

70      TYPE 930
930     FORMAT(/' ABCISSA SCALE IDENTIFICATION(60 CHARS OR LESS)'/)
        CALL NEWLINE
        IXCHARS=(-1)*TABLE(5)
        IF(IXCHARS.LE.60)GO TO 80
        TYPE 928
        GO TO 70
80      CALL GETSTR(IXLABEL,LENGTH,60)
C
C
90      TYPE 932
932     FORMAT(/' LENGTH OF ABCISSA SCALE - IN INCHES;LOWER AND UPPER
     1 LIMITS'/' OF DATA - IN FORM:10,0,200'/)
        ASSIGN 90 TO INERR
        READ(5,934,ERR=500)XLENGTH,XSMALL,XLARGE
934     FORMAT(3F)
C
C.......CALC INCREMENT
C
        XDELTA=(XLARGE-XSMALL)/XLENGTH
        WRITE(5,936)XDELTA
936     FORMAT(/' THIS WILL GIVE PLOTTING INCREMENT OF ',1F)
        TYPE 918
        ACCEPT 920,RESPONSE
        IF(RESPONSE.EQ.YES)GO TO 100
        GO TO 90
C
C
C
100     TYPE 938
938     FORMAT(/' ORDINATE SCALE IDENTIFICATION(60 CHARS OR LESS)?'/)
        CALL NEWLINE
        IYCHARS=TABLE(5)
        IF(IYCHARS.LE.60)GO TO 105
        WRITE(5,928)
        GO TO 100
C
105     CALL GETSTR(IYLABEL,LENGTH,60)
C
110     TYPE 940
940     FORMAT(/' LENGTH OF ORDINATE AXIS (9 INCHES OR LESS);LOWER
     1 AND UPPER'/' LIMITS OF AXIS SCALE'/)
        ASSIGN 110 TO INERR
        READ(5,934,ERR=500)YLENGTH,YSMALL,YLARGE
C
C.......CHECK AXIS LENGTH
C
        IF(YLENGTH.LE.9.)GO TO 115
        TYPE 942
942     FORMAT(/' AXIS LENGTH MUST BY LESS THAN 9 INCHES, RETYPE LINE'/)
        GO TO 110
C
C.......CALC INCREMENT
C
115     YDELTA=(YLARGE-YSMALL)/YLENGTH
        WRITE(5,936)YDELTA
        TYPE 918
        ACCEPT 920,RESPONSE
        IF(RESPONSE.EQ.YES)GO TO 120
        GO TO 110
C
C.......SET NUMBER OF TRACES
C
120     TYPE 944
944     FORMAT(/' NUMBER OF TRACES FOR THIS PLOT?'/)
        ASSIGN 120 TO INERR
        READ(5,946,ERR=500)NTRACE
946     FORMAT(I)
        IF(NTRACE.LE.13)GO TO 125
        TYPE 995
        GO TO 120
C
C.......GET REQUITRED DISC TRACKS AND ASSOC. PLOT SYMBOLICS
C
125     TYPE 948
948     FORMAT(/' TYPE IN THE NUMBER OF A DISC TRACK TO BE PLOTTED
     1  AND ITS ASSOCIATED'/' PLOT SYMBOL NUMBER.   RANGES:'/' TRACK
     2 - 1 TO 13;  SYMBOLS - 0 TO 58'/)
        DO 140 INO=1,NTRACE
122     TYPE 950
950     FORMAT(' NO.TRACK,SYMBOL?'$)
        ASSIGN 122 TO INERR
        READ(5,952,ERR=500)IASK,ISYMB
952     FORMAT(2I)
        IF((ISYMB.GT.-1).AND.(ISYMB.LT.59)) GO TO 124
        TYPE 954
954     FORMAT(/' SYMBOL NUMBER OUT OF RANGE, RETYPE LINE'/)
        GO TO 122
124     DO 130 JNO=1,NC
        IF(IASK.EQ.ITRK(JNO))GO TO 135
130     CONTINUE
C
C.......INVALID TRACK REQUEST
C
        TYPE 956
956     FORMAT(/' ERROR INVALID TRACK, RETYPE LINE'/)
        GO TO 122
C
C.......STORE TRACK REQUEST - NOTE THAT FILE DATA COLUMN IS STORED
C.......NOT DISC TRACK
C
135     ASKTRK(INO)=JNO
        NSYMB(INO)=ISYMB
140     CONTINUE
C**********************************************:
C*
C*      READ IN DATA THRU DYNAMIC SUBROUTINE
C*
C*******************************************************
C
C
        IF(IREPEAT.EQ.1)GO TO 153
150     TYPE 958
958     FORMAT(/' TYPE IN THE NUMBER OF DATA RECORDS IN THIS DATA'/
     1' FILE (USE HIGH ESTIMATE IF UNKNOWN)'/)
        ACCEPT    946,LCOUNT
C
C
C IN TO DYNAMIC STORAGE ROUTINE
C
C
C.......SET ARRAY SIZES TO MINIMUM
C
        IRAY1=1
        IRAY2=1
        IRAY3=1
        IRAY4=1
        IRAY5=1
        IRAY6=1
        IRAY7=1
        IRAY8=1
        IRAY9=1
        IRAY10=1
        IRAY11=1
        IRAY12=1
        IRAY13=1
C
C # OF WORDS REQUIRED FOR XARRAY IS 1*# OF DATA RECORDS
C
153     IXARRAY=LCOUNT
C
C # OF WORDS REQUIRED FOR YARRAYS=1 X LCOUNT
C
        IRAY1=LCOUNT
        IF(NTRACE.EQ.1)GO TO 155
        IRAY2=LCOUNT
        IF(NTRACE.EQ.2)GO TO 155
        IRAY3=LCOUNT
        IF(NTRACE.EQ.3)GO TO 155
        IRAY4=LCOUNT
        IF(NTRACE.EQ.4)GO TO 155
        IRAY5=LCOUNT
        IF(NTRACE.EQ.5)GO TO 155
        IRAY6=LCOUNT
        IF(NTRACE.EQ.6)GO TO 155
        IRAY7=LCOUNT
        IF(NTRACE.EQ.7)GO TO 155
        IRAY8=LCOUNT
        IF(NTRACE.EQ.8)GO TO 155
        IRAY9=LCOUNT
        IF(NTRACE.EQ.9)GO TO 155
        IRAY10=LCOUNT
        IF(NTRACE.EQ.10)GO TO 155
        IRAY11=LCOUNT
        IF(NTRACE.EQ.11)GO TO 155
        IRAY12=LCOUNT
        IF(NTRACE.EQ.12)GO TO 155
        IRAY13=LCOUNT
C
C
C     IN TO ROUTINE
C
155     CALL DYNARY(IERR,DVALUE,IXARRAY,IRAY1,IRAY2,IRAY3,IRAY4,
     1IRAY5,IRAY6,IRAY7,IRAY8,IRAY9,IRAY10,IRAY11,IRAY12,IRAY13,
     20,IREPEAT)
C
C
C
C IF IERR IS NOT -1 THERE HAS BEEN AN ERROR IN TRYING TO DYNAMICALLY
C ALLOCATE STORAGE
C
C
        IF(IERR)170,160,160
160     TYPE 960
960     FORMAT(/' UNABLE TO DYNAMICALLY ALLOCATE STORAGE SPACE..WAIT'
     1 /' A MINUTE AND TYPE ONE CHARACTER TO TRY AGAIN'/)
        ACCEPT 920, RESPONSE
        IERR=0
        GO TO 155
C
C.......REPEAT PLOT
170     GO TO 49
C
C
C.......ERROR ON INPUT, RETYPE
C
500     TYPE 995
995     FORMAT(/' ERROR - RETYPE LINE'/)
        GO TO INERR
C
        END
C**************************************************************
C*
C*      SUBROUTINE DVALUE -READ DATA,FIGURE RANGE,CONVERT TO REAL
C*      AND STORE FOR PLOTTING
C*
C*
C*********************************************:***************:
C
C
        SUBROUTINE DVALUE(XARRAY,Y1,Y2,Y3,Y4,Y5,Y6,Y7,Y8,Y9,Y10
     1,Y11,Y12,Y13,IREPEAT)
        COMMON /DVAL/NTRACE,KTEN,XSMALL,XLARGE,YSMALL,YLARGE,ASKTRK,YES
     1,NSYMB,XDELTA,XLENGTH,IXCHARS,IXLABEL,YDELTA,YLENGTH,IYCHARS
     2,IYLABEL,TCHARS,PTITLE,DFILE
        INTEGER TABLE(1234),RESPONSE,YES,IXCHARS,IXLABEL(12),IYCHARS
     1,IYLABEL(12),PTITLE(12),TCHARS
        COMMON /COMPKG/ TABLE
        INTEGER JVAL(0/13),LPLOT,KTEN(0/13),ASKTRK(13),NSYMB(13)
        REAL XARRAY(1),Y1(1),Y2(1),Y3(1),Y4(1),Y5(1),Y6(1),Y7(1)
     1,Y8(1),Y9(1),Y10(1),Y11(1),Y12(1),Y13(1)
C
C.......LCOUNT IS MAX SIZE OF ARRAYS - EXPECTED # OF PLOTTER POINTS
C.......LPLOT IS ACTUAL # F PLOTTERPOINTS - IGNORE ANY DATA RECORDS
C      WHERE X VALUE IS ABOVE OR BELOW ASKED-FOR RANGE
C
        LPLOT=1
700     READ(10,800,END=750)(JVAL(J),J=0,13)
800     FORMAT(14(1X,I5))
C
C.......LAST CONVERTED DATA LINE WILL HAVE 99999'S
C
        IF((JVAL(0).NE.99999).AND.(JVAL(1).NE.99999))GO TO 705
C
C.......LAST LINE. DO NOT PLOT
C
        LPLOT=LPLOT-1
        GO TO 750
C
C.......CONVERT ABCISSA DATA
C
705     IF(KTEN(0))710,710,712
710     XTEN=1
        GO TO 713
712     XTEN=10**KTEN(0)
713     XARRAY(LPLOT)=JVAL(0)/XTEN
C
C.......CHECK IF XVALUE IS WITHIN PLOT RANGE
C
        IF(XARRAY(LPLOT).LT.XSMALL)GO TO 700
        IF(XARRAY(LPLOT).GT.XLARGE)GO TO 750
C
C.......CONVERT ORDINATE DATA
C
C*****NOTE*****
C.......THERE SHOULD BE A MEANS TO CLIP ORDINATE VALUES THAT
C       EXCEED MAXIMUM ALLOWABLE...ROUTINE GOES HERE
C
        DO 740 J=1,NTRACE
        IF(KTEN(ASKTRK(J)))715,715,716
715     XTEN=1
        GO TO 718
716     XTEN=10**KTEN(ASKTRK(J))
718     GO TO (719,720,721,722,723,724,725,726,727,728,729,730,
     1731),J
719     Y1(LPLOT)=JVAL(ASKTRK(J))/XTEN
        GO TO 740
720     Y2(LPLOT)=JVAL(ASKTRK(J))/XTEN
        GO TO 740
721     Y3(LPLOT)=JVAL(ASKTRK(J))/XTEN
        GO TO 740
722     Y4(LPLOT)=JVAL(ASKTRK(J))/XTEN
        GO TO 740
723     Y5(LPLOT)=JVAL(ASKTRK(J))/XTEN
        GO TO 740
724     Y6(LPLOT)=JVAL(ASKTRK(J))/XTEN
        GO TO 740
725     Y7(LPLOT)=JVAL(ASKTRK(J))/XTEN
        GO TO740
726     Y8(LPLOT)=JVAL(ASKTRK(J))/XTEN
        GO TO 740
727     Y9(LPLOT)=JVAL(ASKTRK(J))/XTEN
        GO TO 740
728     Y10(LPLOT)=JVAL(ASKTRK(J))/XTEN
        GO TO 740
729     Y11(LPLOT)=JVAL(ASKTRK(J))/XTEN
        GO TO 740
730     Y12(LPLOT)=JVAL(ASKTRK(J))/XTEN
        GO TO 740
731     Y13(LPLOT)=JVAL(ASKTRK(J))/XTEN
C
C
740     CONTINUE
        LPLOT=LPLOT+1
C
C
        GO TO 700
C
C.......END OF FILE  OR XCALE BEYOND LARGEST VALUE
C
750     TYPE 814
814     FORMAT(' TYPE DATA? (0=NO;1 TO N=DATA VALUES TO TYPE)'$)
        ACCEPT 924,RESPONSE
        IF (RESPONSE.EQ.0)GO TO 752
        WRITE(5,815)(XARRAY(J1),Y1(J1),Y2(J1),J1=1,RESPONSE)
815     FORMAT(3(2X,F)/)
752     WRITE(5,810)LPLOT
810     FORMAT(/' THE DATA FILE HAS BEEN READ IN AND VALUES
     1 CONVERTED'/' A TOTAL OF ',I5,' DATA RECORDS WILL BE
     2 PLOTTED'/)
C
C
C
C
C
C
C**************************************************
C*
C*
C*      IN TO PLOT SUB PROGRAM
C*
C*
C********************************************
C
C TURN CONTROL OVER TO PLOTTER
C
        IF(IREPEAT.EQ.1)GO TO 477
        TYPE  962
962     FORMAT(/' 10 OR 30 CPS?'$)
        ACCEPT 924,ITRANS
924     FORMAT(I4)
C
477     TYPE 961
961     FORMAT(/' NAME OF PLOTTING OUTPUT FILE?(5 CHAR MAX)'$)
        ACCEPT 963,OUTFIL
963     FORMAT(2A5)
        OPEN(15,OUTFIL,OUTPUT)
        CALL PLOTF(ITRANS,15)
C
C.....SET SCALE AND OFFSET PARAMETERS
C
        CALL OFFSET(XSMALL,XDELTA,YSMALL,YDELTA)
C
C.....PLOT X AXIS
C
C       
        CALL AXIS(0.0,0.0,IXLABEL,IXCHARS,XLENGTH,0.,XSMALL,XDELTA)
C
C.......PLOT Y AXIS
C
        CALL AXIS(0.0,0.0,IYLABEL,IYCHARS,YLENGTH,90.,YSMALL,YDELTA)
C
C.......PLOT TITLE
C
C......FIRST DETERMINE STARTING LOCATION - ASSUME .3 INCH
C.......WIDTH PER LETTER
C
        TITLEN=TCHARS*.3
        TSTART=(XLENGTH-TITLEN)/2
        IF(TSTART)478,478,479
478     TSTART=.3
479     CALL SYMBOL(TSTART,8.5,.2,PTITLE,0.,TCHARS)
C
C
C
C
C
C.......FORCE LINE SUB ROUTINE TO OFFSET SUB FOR SCALE INFO
C
        NPTS=-LPLOT
        KCYCLE=12
        NDP=20
C
C
        LETT=NSYMB(1)
        CALL LINE(XARRAY,Y1,NPTS,KCYCLE,NDP,LETT)
        IF(NTRACE.EQ.1)GO TO 480
        LETT=NSYMB(2)
        CALL LINE(XARRAY,Y2,NPTS,KCYCLE,NDP,LETT)
        IF(NTRACE.EQ.2)GO TO 480
        LETT=NSYMB(3)
        CALL LINE(XARRAY,Y3,NPTS,KCYCLE,NDP,LETT)
        IF(NTRACE.EQ.3)GO TO 480
        LETT=NSYMB(4)
        CALL LINE(XARRAY,Y4,NPTS,KCYCLE,NDP,LETT)
        IF(NTRACE.EQ.4)GO TO 480
        LETT=NSYMB(5)
        CALL LINE(XARRAY,Y5,NPTS,KCYCLE,NDP,LETT)
        IF(NTRACE.EQ.5)GO TO 480
        LETT=NSYMB(6)
        CALL LINE(XARRAY,Y6,NPTS,KCYCLE,NDP,LETT)
        IF(NTRACE.EQ.6) GO TO 480
        LETT=NSYMB(7)
        CALL LINE(XARRAY,Y7,NPTS,KCYCLE,NDP,LETT)
        IF(NTRACE.EQ.7) GO TO 480
        LETT=NSYMB(8)
        CALL LINE(XARRAY,Y8,NPTS,KCYCLE,NDP,LETT)
        IF(NTRACE.EQ.8)GO TO 480
        LETT=NSYMB(9)
        CALL LINE(XARRAY,Y9,NPTS,KCYCLE,NDP,LETT)
        IF(NTRACE.EQ.9)GO TO 480
        LETT=NSYMB(10)
        CALL LINE(XARRAY,Y10,NPTS,KCYCLE,NDP,LETT)
        IF(NTRACE.EQ.10)GO TO 480
        LETT=NSYMB(11)
        CALL LINE(XARRAY,Y11,NPTS,KCYCLE,NDP,LETT)
        IF(NTRACE.EQ.11)GO TO 480
        LETT=NSYMB(12)
        CALL LINE(XARRAY,Y12,NPTS,KCYCLE,NDP,LETT)
        IF(NTRACE.EQ.12)GO TO 480
        LETT=NSYMB(13)
        CALL LINE(XARRAY,Y13,NPTS,KCYCLE,NDP,LETT)
C480***
480     CALL POFF
        CLOSE(15)
        TYPE 964
964     FORMAT(/' ANOTHER PLOT?'$)
        ACCEPT 920,RESPONSE
920     FORMAT(A1)
        IF(RESPONSE.EQ.YES)GO TO 485
        CALL EXIT
C
C......REPEAT PLOTS..RE-INITIALIZE AND RUN THRU FILE UNTIL DATA REACHED
C
485     IREPEAT=1
        IERR=0
        NTRACE=00
        CLOSE(10)
        TABLE(3)=10
        LPLOT=1
        OPEN(10,DFILE,INPUT,SYMBOLIC,ERR=490)
        GO TO 495
490     TYPE 966
966     FORMAT(/' UNABLE TO RE-OPEN FILE..RECALL PROGRAM')
        CALL EXIT
C
C......GET BACK DATA VALUES
C
495     DO 498 JN=1,INITLIN
498     CALL NEWLINE
        RETURN
C
C
        END
C
C
C
