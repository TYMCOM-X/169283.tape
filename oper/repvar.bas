100 '
110 '     R E P V A R
120 '     -----------
130 '
140 '     COPYRIGHT 1973, LUPFER & LONG COMPUTER SERVICES.
150 '
160 DIM G$(30),V$(25)
170 DIM I(132),O(132)
180 DIM A(12,8),T(50)
190 '
200 REM =========== INIT =============
210 B7$=SPACE$(72)
220 CHANGE B7$ TO O
230 P6=P8=69
240 FILE #3, "COMCOM.TMP"
250 FOR I=1 TO 10
260   READ #3, F$(I)
270 NEXT I
280 '
290 FILE :4: F$(5)		'  .COA
300   GOSUB 8500
310 REM ======== DETERMINE FORMAT ==========
320 V6=2
330 IF G7=2 GO TO 430
340 PRINT "NAME OF VARIANCE CATEGORY";
350 INPUT V$
360 IF LEN(V$)>14 GO TO 410
370 V$=SPACE$(15-LEN(V$))+V$
380 FOR V6=2 TO G7
390   IF V$=V$(V6) GO TO 430
400 NEXT V6
410 PRINT "CAN'T FIND ";V$
420   GO TO 340
430 '   - RANGE -
440 PRINT "WHAT TYPE OF REPORT -"
450 M1=1
460 M2=G4
470 H$=Q$="YEAR TO DATE"
480   GOSUB 2100
490   IF R$="YES" GO TO 700
500 M1=M2
510 H$=Q$="CURRENT PERIOD"
520   GOSUB 2100
530   IF R$="YES" GO TO 700
540 GO TO 430
550 '
700 H$(1) = "VARIANCE (" + H$ + ")"
710 H$(2)=F$(1)
720 H$(3)="PERIOD ENDING "+G2$
730 '
740 MAT READ C(6)
750 L$(2)="ACCOUNT"
760 L$(3)="         ACTUAL"
770 L$(4)=V$(V6)
780 L$(5)="       VARIANCE"
790 L$(6)="  %"
800 FOR I=6 TO 2 STEP -1
810   CHANGE L$(I) TO T
820   V1=C(I)
830   GOSUB 2600
840 NEXT I
850 O(0)=C(5)+16
860 CHANGE O TO H$(5)
870 CHANGE B7$ TO O
880 REM ========== REPORT ==============
890 GOSUB 8700                  '  READ .COA RECORD
900 IF S1=1 GO TO 1510
910 REM --------- SELECT ------------
920 S$=G$(5+V6)
930 IF MID$(S$,10*G4,10)="0000000000" GO TO 890
940 V0=1
950 F$=LEFT$(G$(2),1)
960 IF F$="R" GO TO 990
970 IF F$="E" GO TO 990
980   V0=0			'  NOT R/E
990 IF M1=M2 GO TO 1020
1000 IF V0=1  GO TO 1020
1010   GO TO 890
1020 '   ACCT NO.
1030 IF C(1)=0 GO TO 1080
1040   CHANGE G$(1) TO T
1050   V3=G1
1060   GOSUB 2900
1070   V1=C(1)
1080   GOSUB 2600
1090 '   ACCT DESC.
1100 IF C(2)=0 GO TO 1140
1110   CHANGE G$(4) TO T
1120   V1=C(2)
1130   GOSUB 2600
1140 REM ------- BALANCES -------------
1150 FOR I3=M1 TO M2
1160   A$(1)=MID$(G$(5+V0),10*I3,10)
1170   A$(2)=MID$(G$(5+V6),10*I3,10)
1180   FOR I=1 TO 2
1190   CHANGE A$(I) TO T
1200   GOSUB 3000
1210   A9=I
1220   GOSUB 5000
1230   NEXT I
1240 NEXT I3
1250 REM ------ CALC. VARIANCE, PRINT -----
1260 A9=1
1270 GOSUB 5200
1280 A9=3
1290 GOSUB 5000
1300 A9=2
1310 GOSUB 5200
1320 GOSUB 3100
1330 A9=3
1340 GOSUB 5000
1350 FOR I=3 TO 1 STEP -1
1360   A9=I
1370   GOSUB 5200
1380   GOSUB 2700
1390   V1=C(I+2)
1400   GOSUB 2600
1410 NEXT I
1420 IF F$=Z7$ GO TO 1460
1430   Z7$=F$
1440   PRINT
1450   P8=P8+1
1460 GOSUB 4000
1470 FOR A9=1 TO 3
1480   GOSUB 5600
1490 NEXT A9
1500   GO TO 880
1510 REM ====== TERMINATION ==========
1520 P1$="DONE"
1530 GOSUB 4030
1540 CHAIN F$(10)+F$(9)
2000 REM ====== SUBROUTINES ==========
2010 '
2100 REM ------ YES/NO -------
2110 PRINT
2120 PRINT TAB(2);Q$;
2130 INPUT R$
2132   IF R$<>"Y" GO TO 2136
2134     R$="YES"
2136   IF R$<>"N" GO TO 2140
2138     R$="NO"
2140   IF R$="YES" GO TO 2180
2150   IF R$="NO" GO TO 2180
2160 PRINT "PLEASE ANSWER 'YES' OR 'NO'"
2170   GO TO 2100
2180 RETURN
2500 REM -------- STR$ ------------
2510 FOR I=T(0) TO 1 STEP -1
2520   T2=V1-INT(V1/10)*10
2530   T(I)=ASC(0)+T2
2540   V1=INT(V1/10)
2550 NEXT I
2560 RETURN
2600 REM -------- INSERT ----------
2610 K1=1
2620 FOR K2=V1 TO V1+T(0)-1
2630   O(K2)=T(K1)
2640   K1=K1+1
2650 NEXT K2
2660 RETURN
2700 REM -------- $ FORMAT --------
2710 K1=T(0)
2720 T(0)=T(0)+INT(K1/3)
2730 FOR K2=1 TO T(0)
2740   IF INT(K2)=4*INT(K2/4) GO TO 2780
2750     T(T(0)+1-K2)=T(K1)
2760     K1=K1-1
2770     GO TO 2790
2780   T(T(0)+1-K2)=ASC(,)
2790 NEXT K2
2800 T(T(0)-3)=ASC(.)
2810 V3=4
2820 GOSUB 2900
2830 '   - REVERSE SIGN -
2840 IF F$="L" GO TO 2870
2845 IF F$="R" GO TO 2870
2848 IF S7=1 GO TO 2870
2850   GO TO 2880
2870 GOSUB 3100
2880 '  - MAKE SURE .00- DOESN'T HAPPEN -
2882 IF T(T(0)-4)<>ASC(SP) GO TO 2890
2884 IF T(T(0)-2)<>ASC(0)  GO TO 2890
2886 IF T(T(0)-1)<>ASC(0)  GO TO 2890
2888   T(T(0))=ASC(SP)
2890 RETURN
2900 REM ------ LEFT STRIP --------
2910 FOR K1=1 TO T(0)-V3
2920   IF T(K1)>ASC(0) GO TO 2950
2930   T(K1)=32
2940 NEXT K1
2950 RETURN
3000 REM --------- UNPACK SIGN ---------
3010 T(0)=11
3020 T(11)=ASC(SP)
3030 IF T(10)<=ASC(9) GO TO 3060
3040   T(10)=T(10)-10
3050   T(11)=ASC(-)
3060 RETURN
3100 REM -------- REVERSE SIGN ---------
3110 T(T(0))=T(T(0))+13
3120 IF T(T(0))=ASC(-) GO TO 3140
3130   T(T(0))=ASC(SP)
3140 RETURN
3200 REM ----- STRIP TRAILING BLANKS ---
3210 FOR K1=O(0) TO 1 STEP -1
3220   IF O(K1)<>32 GO TO 3240
3230 NEXT K1
3240 O(0)=K1
3250 RETURN
4000 REM --- TOP OF PAGE/PRINT ----
4010 IF P8<59 THEN 4210
4020 IF P7=0 THEN 4070
4030 FOR P9=P8 TO 61
4040   PRINT
4050 NEXT P9
4060 PRINT TAB(31);"PAGE";P7
4070 PRINT
4080 PRINT "."
4090 PRINT
4100 P7=P7+1
4110 IF P1$="DONE" THEN 4320
4120 GOSUB 4330
4130 FOR P9=1 TO 3
4135 T=34-INT(LEN(H$(P9))/2)
4140 PRINT TAB(T);H$(P9)
4150 NEXT P9
4160 PRINT
4165 PRINT
4170 PRINT H$(4)
4180 PRINT H$(5)
4190 PRINT
4200 P8=12
4210 '   PRINT LINE
4212 GOSUB 3200
4216 CHANGE O TO O$
4220 PRINT O$
4230 P8=P8+1
4240 CHANGE B7$ TO O
4270 P5=0
4280 IF P5=0 THEN 4320
4290 IF P8=51 THEN 4320
4300 PRINT
4310 P8=P8+1
4320   RETURN
4330 PRINT
4340 PRINT
4350 PRINT
4360   RETURN
5000 REM ---ACCUMULATE---
5010 A1=13-T(0)
5020 A2=1
5030 IF T(13-A1)<>ASC(-) THEN 5050
5040 A2=-1
5050 FOR A8=A1 TO 11
5060   IF T(A8-A1+1)=ASC(0) THEN 5100
5070   A4=T(A8-A1+1)-48
5080   A5=INT((A2*A4)+.5)
5090   A(A8,A9)=A(A8,A9)+A5
5100 NEXT A8
5110   RETURN
5200 REM ---READ ACCUMULATOR---
5210 T(12)=32
5220 FOR A8=11 TO 1 STEP -1
5230   A1=0
5240   IF A(A8,A9)=0 THEN 5260
5250   A1=A(A8,A9)/10
5260   A2=INT(A1)
5270   A(A8-1,A9)=A(A8-1,A9)+A2
5280   A(A8,A9)=INT(.5+10*(A1-A2))
5290 NEXT A8
5300 IF A(0,A9)=0 THEN 5350
5310 A(11,A9)=A(11,A9)-1
5320 A(0,A9)=0
5330 T(12)=ASC(-)
5340   GO TO 5220
5350 FOR A8=1 TO 11
5360   IF T(12)<>ASC(-) THEN 5390
5370   T(A8)=ASC(0)+9-A(A8,A9)
5380     GO TO 5400
5390   T(A8)=ASC(0)+A(A8,A9)
5400 NEXT A8
5410 T(0)=12
5420 IF T(12)<>ASC(-) THEN 5450
5430 A(0,A9)=-1
5440 A(11,A9)=A(11,A9)+1
5450 RETURN
5600 REM ---CLEAR ACCUMULATOR---
5610 FOR A8=0 TO 12
5620   A(A8,A9)=0
5630 NEXT A8
5640 RETURN
6100 REM ---- UNKLUDGE PDP-10 CHARS -----
6110 FOR K1=1 TO I(0)
6120   IF I(K1)<100 GO TO 6140
6130     I(K1)=I(K1)-100
6140 NEXT K1
6150 RETURN
8500 REM ----- READ .COA HEADER ---------
8510 S1=0
8520 GOSUB 8900
8521 G1$=I$
8530 CHANGE G1$ TO I
8535 GOSUB 6100
8540 G1=I(10)
8550 G2=I(11)
8560 G3=I(12)
8570 G4=I(13)
8580 G5=I(14)
8590 G6=I(15)
8600 G7=I(16)
8601 G8=I(16)
8602 S$=G1$
8604 G2$=MID$(S$,29+8*(G4-G6),8)
8610 GOSUB 8900
8620 FOR T=1 TO G7
8630   GOSUB 8900
8640   V$(T)=MID$(I$,10,15)
8650 NEXT T
8690 RETURN
8700 REM ----- READ .COA RECORD -----------
8710 IF LOC(4)<=LOF(4) GO TO 8800
8720   S1=1
8730   GO TO 8890
8800 GOSUB 8900
8830 G$(1)=LEFT$(I$,8)
8840 G$(2)=MID$(I$,10,4)
8850 G$(3)=MID$(I$,14,10)
8860 G$(4)=MID$(I$,24,G2)
8865 FOR T=0 TO G7
8870   GOSUB 8900
8875   G$(5+T)=I$
8880 NEXT T
8890 RETURN
8900 '   SPECIAL READ WITH RE-TRY
8910 READ :4: I$
8920 SET :4, LOC(4)-1
8930 READ :4: I2$
8940 IF I$=I2$ GO TO 8990
8960   SET :4, LOC(4)-1
8970   GO TO 8910
8990 RETURN
9600 '
9610 DATA 0,1,23,38,51,0
9999 END
