MODULE S1COMP(DOLLAR,STACK=GLOBAL($CSTK$,#177),CCL,
                FSAVE,TIMING,TIMER=EXTERNAL(SIX12))=
BEGIN


REQUIRE KDEFS.BLI[7,107355];
REQUIRE FDEFS.BLI[7,107355];
REQUIRE CDEFS.BLI[7,107355];
REQUIRE ADEFS.BLI[7,107355];
REQUIRE BDEFS.BLI[7,107355];
REQUIRE PDEFS.BLI[7,107355];
REQUIRE EDEFS.BLI[7,107355];
REQUIRE UDEFS.BLI[7,107355];

EXTERNAL JOBDDT;

BIND    TRUE =1,
        FLASE=0;

LOCAL KEEPCCLVREG, RETCSTK4;

MACHOP  TTCALL=#051,
        HALT  =#254;


ROUTINE BARE(RTNADR)=
   BEGIN

   WHILE 1 DO
     BEGIN

     $CSRCF();

     $UAPSZ($USPTR('COMPILING'));
     $UPRPT();

     FLEVL$[FV$WARNING] _ FLEVL$[FV$FATAL] _ 0;
     $CSTART(CV$ERROROUT);


     $ASCAN();

     IF .JOBDDT NEQ 0 THEN
        $UMESS($USPTR('?M?JSCANNER DONE'));

     PS$$$();
     BSCHF$ _ TRUE;
     $BEXEC();

     IF .JOBDDT EQL 0 THEN $UOUTL();
     $UMESS($USPTR('SYNTAX DONE'));

     IF .FLEVL$[FV$FATAL] LEQ 0 THEN
          BEGIN
          $EEXEC();
          $UMESS($USPTR('SCHEMA CREATED'))
          END
     ELSE $UMESS($USPTR('NO SCHEMA CREATED'));

     $FFERROR();

     IF NOT .FNWRN$ THEN  $FLER()
     ELSE IF .FLEVL$[FV$FATAL] NEQ 0 THEN $FLER();

     RTNADR _ EXCHJ($CSTK$,-1)
     END

   END;



KEEPCCLVREG _ .VREG;

IF .KEEPCCLVREG EQL 0 THEN
  BEGIN
  TTCALL(3,PLIT(ASCIZ'?M?JThis file may not be RUN directly.?M?J'));
  HALT(4,0,0,0)
  END;

$CIHDT$ALIGN;
$CISREN();

$CDDT$RESET;


BEGIN
  MAP KFCB$ CTERM$;
  CTERM$[K$RR] _ $KGLED;
  CTERM$[K$WR] _ $KTYPL;
  CTERM$[K$SCPR] _ $KILIO;
  CTERM$[K$EXCEPT] _ $KIOAB
END;


IF .CSTK4$ EQL 0 THEN   % initializing %
  BEGIN
  CSTK4$ _ -1;
  $UMESS($USPTR('CSTK4$ Initialized for S1COMP'));
  $COLAY()
  END;

IF .CSTK4$ EQL -1 THEN  % new execution instance %
  CSTK4$ _ CREATE BARE(.BREG)
                AT $CGTZM(#2777)
                LENGTH #2777
                THEN EXCHJ($CSTK$,-1);

RETCSTK4 _ EXCHJ(.CSTK4$,.BREG);

IF .RETCSTK4 EQL -1 THEN
   $CFREEM(.CSTK4$);
CSTK4$ _ .RETCSTK4;

$COLAY()

END
ELUDOM
