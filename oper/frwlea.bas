10 REM LEASE ANALYZER - MAY, 1973  F. WALKER
20 REM PGM IS DONE IN SECTIONS.  INPUT VARIALBES LISTED BELOW.
30 REM L$  LESSEE
40 REM S$  SLSMN
50 REM  E$  EQUIP
60 REM  A$  ADV OR ARR
70 REM  C  COST
80 REM  T  TERM IN YEARS
90 REM  R  RESIDUAL PERCENT
100 REM  I  ITC OPTION
110 REM  I1  ITC NONSTD PERCENT
120 REM  D  DEPREC
130 REM  D1  SALVAGE VALUE
140 REM  F PAYMENT FREQ
150 REM  C2  C2C
160 REM  D2  DRR
170 REM  B  BROKERS OR BRANCH FEE
180 DIM T$ (15)
190 DIM M(200,15)
191 T$(1) = "RECPT"
192 T$(2) = "  EXP"
193 T$(3)= "  EXP"
194 T$(4) = " PAID"
195 T$(5)= " CASH"
196 T$(6) = "PAID"
197 T$(7) = " CASH"
198 T$(8)= " CASH"
199 T$(9) = " DEPN"
200 T$(10)= "INCOM"
201 T$(11)= " EQTY"
202 T$(12) = " PROF"
203 T$(13) = "FUND"
204 T$(14) = "  INT"
205 T$(15) = "  BAL"
210 PRINT "LESSEE,SLSMN,EQUIP"
220 INPUT L$,S$,E$
230 PRINT "COST,TERM(YRS),RESID"
240 INPUT C,T,R
250 PRINT "ITC(STD=1,NONSTD=2,NONE=0),(IF 2)NONSTD %"
260 INPUT I,I1
270 PRINT "DEPRECIATION(NEW=1,USED=2,CSA=3),SALVAGE VALUE"
280 INPUT D,D1
290 PRINT "PAYMENTS/YR,ADV(Y OR N)"
300 INPUT F,A$
310 PRINT "C2C,DRR"
320 INPUT C2,D2
330 PRINT "BROKER/BRANCH FEE"
340 INPUT B
350 T9=T*12+15
360 MAT M = ZER
370 DIM X$(15)
380 DIM L(15)
390 X$(2)= "MISC"
391 X$(3)="  INT"
392 X$(4)= "PRINC"
393 X$(5)="PRETX"
394 X$(6)="  TAX"
395 X$(7)="  A-T"
396 X$(9)="PRETX"
397 X$(14)=" FUND"
398 X$(15)="  BAL"
400 FOR K=1 TO 15
410 READ L(K)
420 NEXT K
430 DATA 0,0,.0795,0.08,0.0805,0.0805,0.081,0.081,0.081,0.0815,0.082
440 DATA 0.0825,0.083,0.083,0.083,52.7,7,9
450 READ R2,X3,M1
460 F1=0
500 REM: LOAN PAYMENT & INTEREST SECTION
510 REM:     T1=LOAN TERM IN PERIODS
520 REM:       L(T)=LOAN RATE APPLICABLE FOR LEASE TERM T
530 REM:       L1=TOTAL LOAN=.80*COST THEN DECREASES BY PYMT
540 REM:       A=LOAN PAYMENT AMT
550 REM:       I2=INTEREST AMT
556 REM        B1=BEGINNING PERIOD
557 REM    T2=NO. OF PERIODS ADJUSTED FOR ADV/ARR
560 REM:       P=LOAN PRINCIPAL PYMT
563 REM:       F2=12/F
565 REM      L2=PERIOD SPEC LOAN RATE
568 F2=12/F
570 T1=T*12/F2
575 L1=80
580 K=0
585 L2=(1+L(T))^(1/F)-1.0
590 A=L1*(L2*((1.0+L2)^T1)/(((1.0+L2)^T1)-1.0))
595 T2=T1+1
610 IF A$="N" GOTO 650
620 T2=T2-F2
630 B1=1
640 GOTO670
650 B1=F2+1
670 FOR K=B1 TO T2 STEP F2
680 I2=L1*L2
690 P=A-I2
700 M(K,3)=M(K,3)+I2
710 M(K,4)=M(K,4)+P
720 L1=L1-P
730 NEXT K
740 REM END OF LOAN SEGMENT
800 REM THIS IS THE EXPENSE ALLOC SECTION
810 REM  R8  RATE PER PERIOD
820 REM  E2  EXPENSE IN PERIOD ZERO
830 REM  B  BROKERS EXP - INPUT
833 R8 = .125/F
835 IF C > 2500000. GOTO 880
840 IF C > 1000000. GOTO 900
850 IF C > 500000. GOTO 920
860 E2 = 1
870 GOTO 930
880 E2 = .25
890 GOTO 930
900 E2 =.5
910 GOTO 930
920 E2 = .75
930 M(1,2) = E2 + M(1,2) + B
940 FOR K =14 TO T*12 STEP 12/F
950 M(K,2) = M(K,2) + R8
960 NEXT K
970 REM EXIT EXPENSE RTN
1000 REM:      DEPRECIATION SECTION
1010 REM:      A2=ACCUM DEPRECIATION
1020 REM:      D3=DDB OR 150 DB DEPR AMT
1030 REM:      D4=SL DEPR AMT
1040 REM:      R3=DEPR RATE
1050 REM:      T4=REMAINING TERM IN YEARS
1055 REM D6=DIFF IN 100-A2 AND D1
1060 A2=0
1070 D4=0
1080 D3=0
1090 T4=T
1100 IF D=3 GO TO 1260
1110 IF D=2 GO TO 1140
1120 R3=2.0/T
1130 GO TO 1150
1140 R3=1.5/T
1150 D3=((100-A2)*R3)/12
1160 D4=((100-A2-D1)/(T4*12))
1169 PRINT D3,D4
1170 IF D3>D4 GO TO 1190
1180 GO TO 1260
1190 J=(T-T4)*12+1+1
1200 FOR K=J TO J+11
1210 M(K,9)=M(K,9)+D3
1212 A2=A2+D4
1214 IF (100-A2)<D1 GOTO 1350
1215 NEXT K
1220 A2=A2+(12*D3)
1230 T4=T4-1
1240 IF T4=0 GO TO 1310
1250 GO TO 1150
1260 D4=(100-A2-D1)/(T4*12)
1270 J=(T-T4)*12+1+1
1280 FOR K=J TO T*12
1290 M(K,9)=M(K,9)+D4
1295 A2=A2+D4
1300 NEXT K
1310 GOTO 1370
1350 D6=(100-A2)-D1
1360 M(K,9)=M(K,9)+D6
1370 REM END DEPR RTN
2500 REM:      LEASE RECEIPTS CALCULATION; BASED ON EITHER C2C OR DRR
2510 REM:      F1=FIRST TIME SW-INIT AT ZERO
2520 REM:      F2=12/F
2530 REM:      T2=T1 ADJUSTED FOR ADV/ARR
2540 REM:      A1=LEASE PAYMENT AMOUNT
2550 REM:      N=NEW LEASE RATE-EITHER C2C OR DRR FIRST TIME
2560 REM:      R1=RATE FOR CALC LR"S
2570 REM:      B1=BEGINNING PERIOD
2580 REM:      E1=ENDING PERIOD
2590 IF F1=1 GO TO 2650
2595 F1=1
2600 IF D2=0 GO TO 2640
2610 N=D2/100
2630 GO TO 2650
2640 N=C2/100
2650 IF D2=0 GO TO 2680
2660 R1=N/F
2670 GO TO 2690
2680 R1=(1.0+N)^(1.0/F)-1.0
2690 T2=T1+1
2695 PRINT "N ",N,"R1",R1
2700 IF A$="N" GO TO 2720
2710 T2=T2-F2
2720 A1=(R1*((1.0+R1)^T2))/(((1.0+R1)^T2)-1.0)
2730 IF A$="N" GO TO 2780
2740 A1=100*(A1/(1.0+A1))
2750 B1=1
2760 E1=T2
2770 GO TO 2810
2780 A1=A1*100
2790 B1=1+F2
2800 E1=T2
2810 FOR K=B1 TO E1 STEP F2
2820 M(K,1)=A1
2840 NEXT K
2850 REM:      END OF LEASE RECPTS SECTION
3100 REM:      PRETAX INCOME SECTION
3110 REM:      T3=12*T=RESIDUAL PERIOD
3120 REM:      D3=SUM OF DEPR=SUM(M(*,9))
3125 REM:      T9=T*12+15
3130 K=0
3140 IF A$="N" GO TO 3190
3150 FOR K=2 TO T9
3160 M(K,10)=M(K-1,1)
3170 NEXT K
3180 GO TO 3220
3190 FOR K=1 TO T9
3200 M(K,10)=M(K,1)
3210 NEXT K
3220 FOR K=1 TO T9
3230 M(K,10)=M(K,10)-M(K,2)-M(K,3)
3240 NEXT K
3250 T3=T*12+1
3260 M(T3,1)=M(T3,1)+R
3270 M(T3,10)=M(T3,10)+R
3280 D3=0
3290 M(2,10)=M(2,10)+M(1,10)
3300 M(1,10)=0
3310 FOR K=1 TO T9
3320 M(K,10)=M(K,10)-M(K,9)
3330 D3=D3+M(K,9)
3340 NEXT K
3350 M(T3,10)=M(T3,10)-(100.0-D3)
3360 REM:      END OF PRETAX INCOME
3600 REM:      PRETAX CASH FLOW SECTION
3610 FOR K=1 TO T9
3620 M(K,5)=M(K,1)-M(K,2)-M(K,3)-M(K,4)
3630 NEXT K
3640 REM:      END OF PRETAX CASH SECTION
4100 REM:      TAX SECTION-ALL TAXES ARE DELAYED 1 YEAR, AND PD QTRLY
4110 REM:      F4=MONTHS BETWEEN TAX PAYMENTS-READ FROM FILE
4130 REM:      I=INPUT ITC OPTION
4140 REM:      R2=TAX RATE-READ FROM FILE
4150 REM:      S=PERIODIC SUM OF TAXABLE INCOME
4160 REM:      X3=STD ITC % READ FROM FILE
4170 REM:      M1=STD ITC MONTH- READ FROM FILE
4180 S=0
4190 X1=12
4195 F4=3
4200 X2=X1+T*12
4210 R2=R2/100
4220 FOR J=2 TO T9 STEP F4
4230 L=J+F4-1
4240 FOR K=J TO L
4250 S=S+M(K,10)*R2
4260 NEXT K
4270 M(L+12,6)=M(J+12,6)+S
4280 S=0
4290 NEXT J
4300 IF I=0 GO TO 4350
4310 IF I=1 GO TO 4340
4320 M(M1,6)=M(M1,6)-I1
4330 GO TO 4350
4340 M(M1,6)=M(M1,6)-X3
4350 REM:      END OF TAXES SECTION
4600 REM:      AFTER TAX CASH SECTION
4610 REM:      M(K,7) IS MISC CASH- NOT CURRENTLY USED
4620 FOR K=1 TO T9
4630 M(K,8)=M(K,5)-M(K,6)+M(K,7)
4640 NEXT K
4650 M(1,8)=M(1,8)-20
4660 REM:      END OF AFTER TAX CASH
5000 REM SINKING FUND ROUTINE
5010 REM  A3  BAL
5020 REM  F  FIRST POSITIVE INDICATOR (0 = OF,1=ON)
5030 REM  R4  S.F. RATE = .5 * DEBT COST UP TO 4%
5040 REM  S1  SIGNCOUNT
5050 REM  S2  LASTSIGN (0=+,1=-,2=START)
5060 A3 = 0
5070 F5 = 0
5080 S1 = 0
5090 S2 = 0
5100 R4 = .5 * L(T) 
5110 IF R4 > .04 GOTO 5130
5120 GOTO 5140
5130 R4 = .04
5140 FOR K = 1 TO T9
5150 IF M(K,8) >0  GOTO 5230
5160 IF M(K,8) = 0 GOTO 5310
5170 L = K
5180 IF S2 = 1 GOTO 5310
5190 IF S2 = 0 GOTO 5210
5200 S1 = S1 + 1
5210 S2 = 1
5220 GOTO 5310
5230 IF F5 = 1 GO TO 5260
5240 J = K
5250 F5 = 1
5260 IF S2 = 0 GOTO 5310
5270 IF S2=2 GOTO 5290
5280 S1 = S1 + 1
5290 S2 = 0
5310 NEXT K
5320 IF S1 < 2 GOTO 5540
5330 FOR K =L TO J STEP -1
5340 IF A3 > 0 GOTO 5360
5350 GOTO 5370
5360 A3 = A3 / (1 + R4)
5370 IF M(K,8) = 0 GOTO 5460
5380 IF M(K,8) < 0 GOTO 5440
5390 IF A3 = 0 GOTO 5460
5400 IF M(K,8) < A3 GOTO 5440
5410 M(K,8) = A3
5420 A3 = 0
5430 GOTO 5460
5440 M(K,13) = M(K,8)
5450 A3 = A3 - M(K,8)
5460 NEXT K
5470 IF A3 > 0 GOTO 5490
5480 M(J,13) = M(J,13) + A3
5490 M(J,15) = M(J,13)
5500 FOR K=J+1 TO L
5510 M(K,14) = R4 * M(K-1,15)
5520 M(K,15) = M(K-1,15) + M(K,14) + M(K,13)
5530 NEXT K
5540 REM END SINKING FUND
5595 PRINT "INPUT K,L"
5598 INPUT K,L
5599 IF K=0 GOTO 8100
5600 FOR J = 1 TO L
5620 PRINT M(J,K)
5630 NEXT J
5635 PRINT
5640 GOTO 5595
8100 REM ROR CALCULATION
8110 REM  R5  ROR
8120 REM  R6  TEST ROR
8130 REM  P1  PV
8140 REM  P2  DERIVATIVE OF PV
8145 REM  S3  CF HOLDING AREA
8150 R5=(1.1)^(1/12)-1.0
8160 R6 = R5
8170 P1 = 0
8180 P2 = 0
8190 FOR K = 1 TO T9
8200 S3 = M(K,8) - M(K,13)
8205 IF S3=0 GOTO 8230
8210 P1=P1+(S3/((1.0+R6)^K))
8220 P2=P2-K*(S3/((1.0+R6)^(K+1)))
8230 NEXT K
8240 R5 = R6 - (P1/P2)
8245 PRINT R5,R6
8250 IF ABS(R5-R6) < 1.00001 ^(1/12) - 1.0 GOTO 8270
8260 GOTO 8160
8270 R5=(1.0+R5)^12-1.0
8275 PRINT "DRR ",R5
8280 REM END OF ROR CALCULATION
8600 REM DETERMINE IF LEASE RATE REQUIRES ADJUSTMENT
8620 IF D2 = 0 GOTO 10000
8640 REM TEST TARGET AGAINST CURRENT RATE
8650 IF ABS(R5-(D2/100))<.00001 GOTO 10000
8660 REM IF THERE IS AN ACCEPTABLE MARGIN, GO TO CASH ALLOC
8670 REM OTHERWISE ADJUST LEASE RAATE
8680 REM  F6  FIRST TIME SW - INIT TO ZERO IN HSKPG
8690 REM  R7  NEXT RLRATE
8700 REM  D5  DIFF IN ROR AND D2
8710 REM  Q   OLD LEASE RATE (PRIOR N)
8720 REM  Q1  OLD YIELD (PRIOR ROR: R5)
8800 IF F6=1 GOTO 8880
8810 F6=1
8820 D5=(R5-(D2/100))/5
8830 IF D5 < N GOTO 8860
8840 R7=N/2
8850 GOTO 8890
8860 R7=N-D5
8870 GOTO 8890
8880 R7 = Q - (((Q-N) * (Q1-D2))/(Q1-R5))
8890 Q = N
8900 Q1 = R5
8905 N=R7
8910 FOR K=1 TO T9
8911 M(K,1)=0
8912 M(K,5)=0
8913 M(K,6)=0
8914 M(K,8)=0
8915 M(K,10)=0
8916 M(K,13)=0
8917 M(K,14)=0
8918 M(K,15)=0
8919 NEXT K
8920 GOTO 2500
8930 REM GO RECALC LR"S ,ETC.
8940 REM END OF ADJ LEASE RATE
10000 REM ALLOCATION OF AFTER-CASH TAX SECTION
10010 REM  A4  BALANCE
10020 REM  A5  AMOUNT - HOLDING AREA.
10100 A4 = 0
10110 FOR K = 1 TO T9
10120 A5 = M(K,8) - M(K,13)
10130 IF (A4 + A5) < 0 GOTO10150
10140 GOTO 10190
10150 M(K,11) = A5
10160 A4 = A4 + A5
10170 NEXT K
10180 GOTO 10240
10190 M(K,11) = -A4
10200 M(K,12) = A4 + A5
10210 FOR L = K + 1 TO T9
10220 M(L,12) = M(L,8) - M(L,13)
10230 NEXT L
10240 REM END OF ALLOCATION SECTION
11000 REM OUTPUT SECTION. ALSO DOES MINOR CALCULATIONS - PTY, A-T-CASH%
11010 REM 1ST CALC = PTY - REUSING VALIABLES FROM ROR RTN
11020 REM  R9  NEW  STARTING VALUE
11030 REM  R6,P1,P2,S3
11100 R9=(1.1)^(1/12)-1.0
11110 R6 = R9
11120 P1 = 0
11130 P2 = 0
11135 P1=-C-B
11140 FOR K=2 TO T9
11150 S3=M(K,1)
11155 IF S3=0 GOTO 11180
11160 P1 = P1 + (S3/((1.0 + R6) ^ K))
11170 P2 = P2 - K * (S3/((1.0+R6) ^ (K+1)))
11175 PRINT P1;P2;K;S3
11180 NEXT K
11190 IF I = 0 GOTO 11238
11200 IF I = 2 GOTO 11220
11210 I1 = 7
11215 REM NEXT 2 ADD IN ITC IF APPLICABLE
11220 P1=P1+((I1/(1-R2))/((1+R6)^9))
11230 P2=P2-9*((I1/(1-R2))/((1+R6)^10))
11233 GOTO 11240
11238 I1 = 0
11240 REM NEXT STMTS ADD RESID
11250 P1 = P1 + R/((1.0+R6) ^ (T*12))
11260 P2 = P2 - (T*12) * (R/((1.0+R6) ^ (T*12+1)))
11280 R9 = R6 - (P1/P2)
11290 IF ABS(R9-R6) < (1.00001 ^ (1/12) - 1.0) GOTO 11310
11300 GOTO 11110
11310 R9=((1.0+R9)^12)-1.0
11320 REM END PTY CALC
11400 REM DETERMINE  $ AMT OF LR"S
11410 REM  A6  $ AMT OF LR"S
11420 REM  A1  % AMT OF LR"S
11430 A6=(A1*C)/100
11450 REM LOAN PIMTS IN $
11460 REM  A  AMT IN %
11470 REM  A7  AMT IN $
11480 A7=(A*C)/100
11490 REM AFTER TAX CASH
11500 REM  S4 SUM A-T CASH
11510 S4 = 0
11520 FOR K = 1 TO T9
11530 S4 = S4 + M(K,8)
11540 NEXT K
11550 S4=(S4/C)*100
11560 REM C2C TO ANNUAL BASIS
11570 R1=(((1.0+R1)^12)-1.0)*100
11600 REM THIS THE SUMMARY OUTPUT AREA
11610 PRINT "SUMMARY OUTPUT"
11620 PRINT  "LESSEE ";L$;"SLSMN ";S$;"EQUIP ";E$
11630 PRINT
11640 PRINT "COST";C;"TERM (YRS)";T;"RESIDUAL";R
11650 PRINT
11660 PRINT "ITC%";I1;"DEPREC TYPE";D;"FEE";B
11670 PRINT
11680 PRINT "   *   *   *   "
11690 PRINT
11700 PRINT "DRR ";R5*100;" PTY ";R9*100;" C2C ";R1*100
11710 PRINT
11730 IF F = 12 GOTO 11780
11740 IF F = 4 GOTO 11800
11750 IF F = 2 GOTO 11820
11760 B$ = "ANNUALLY"
11770 GOTO 11830
11780 B$ = "MONTHLY"
11790 GOTO 11830
11800 B$ = "QUARTERLY"
11810 GOTO 11830
11820 B$ = "SEMI-ANNUALLY"
11830 IF A$ = "Y" GOTO 11860
11840 C$ = "ARREARS"
11850 GOTO 11870
11860 C$ = "ADVANCE"
11870 PRINT "LSE PYMTS $ ";A6;" LSE PYMT % ";A1;B$;"IN ";C$
11880 PRINT
11890 PRINT "LOAN AMORT PYMTS $ ";A7;"AFTER TAX CASH % ";S4
11900 PRINT
11920 PRINT "CASH FLOWS"
11930 INPUT F$
11940 IF F$ = "N" GOTO 13500
11942 PRINT "BY COL"
11944 INPUT F$
11946 IF F$ = "Y" GOTO 12500
11950 PRINT "SUMMARIZED?"
11960 INPUT F$
11970 L=1
11975 IF F$ = "N" GOTO 12070
11980 PRINT "Q,S,A"
11990 INPUT F$
12000 IF F$ = "Q" GOTO 12040
12010 IF F$ = "S" GOTO 12060
12020 L = 12
12030 GOTO 12070
12040 L = 3
12050 GOTO 12070
12060 L = 6
12070 FOR K = 0 TO T9 STEP L
12080 FOR J=K+1 TO K+L
12090 A9=A9+M(J,1)
12100 B9 = B9 +M(J,2)
12110 C9=C9+M(J,3)
12120 D9=D9+M(J,4)
12130 E9=E9+M(J,5)
12140 F9=F9+M(J,6)
12150 H9=H9+M(J,8)
12160 NEXT J
12170 PRINT J-1;A9;B9;C9;D9;E9;F9;H9
12190 NEXT K
12250 FOR K=0 TO T9 STEP L
12260 FOR J=K+1 TO K+L
12280 I9=I9+M(J,9)
12290 J9=J9+M(J,10)
12300 K9=K9+M(J,11)
12310 L9=L9+M(J,12)
12320 M9=M9+M(J,13)
12322 N9=N9+M(J,14)
12324 O9=O9+M(J,15)
12330 NEXT J
12340 PRINT J-1;I9;J9;K9;L9;M9;N9;O9
12360 NEXT K
12400 GOTO 13500
12500 REM THIS IS THE COLUMN PRINT SECTION
12510 PRINT "ENTER COL DESIRED"
12520 INPUT X4
12522 IF X4=0 GOTO 13500
12530 PRINT "M,Q,S,A"
12540 INPUT F$
12550 IF F$="M" GOTO 12600
12560 IF F$="Q" GOTO 12620
12570 IF F$= "S" GOTO 12640
12580 L=12
12590 GOTO 12650
12600 L=1
12610 GOTO 12650
12620 L=3
12630 GOTO 12650
12640 L=6
12650 A9=0
12652 PRINT X$(X4)
12654 PRINT T$(X4)
12660 FOR K=0 TO T9 STEP L
12670 FOR J=K+1 TO K+L
12680 A9=A9+M(J,X4)
12690 NEXT J
12700 PRINT J,A9
12710 K=K+L
12720 NEXT K
12730 GOTO 12510
13500 END
 