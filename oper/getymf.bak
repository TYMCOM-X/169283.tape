1 * TEXT OUTPUT BEGINS IN LINE 16, VERSION IN LINE 20E TRANSLATOR ONLY IF"
2 STRING QSTR(10)(100),LNUM(15),SNUM(15)
,STMTHD(32)(11),COMNT(32)(25)
3 INTEGER CFLG,NST(32),IFF(100)
4 COMMON QSTR,IXQ,CFLG,LNUM
5 STRING FNI(40),FNO(40),SNR(4),SCR(3),FND(40)
6 IFFX=0 ; FLNUM=999.
7 SNR='(/S&)'
8 SCR="(S)"
9 DATA NST(5),NST(11),NST(13),NST(14),NST(15),NST(16),NST(18)
,NST(19),NST(20),NST(21),NST(22),NST(23),NST(24),NST(25)
,NST(26),NST(27),NST(28),NST(29),NST(30)/19*1/
10 DATA NST(1),NST(2),NST(3),NST(4),NST(6),NST(7),NST(8),NST(9)
,NST(10),NST(12),NST(17),NST(31),NST(32)/2,3,4,5,6,7,8,
,9,10,11,12,13,14/
11 DATA STMTHD/ALPHA,FILENAME,DATA,FORMAT,IMPLICIT,
EQUIVALENCE,IF,READ,INPUT,PRINT,ENTRY,RETURN,LOAD,CALLBREAK,
CALLPID,CALLEXITLM,CALLBYE,CHECK,NOCHECK,LINE,NOLINE,
ENCODE,DECODE,FILELIST,SET,OPENFILE,CLOSEFILE,BACKSPACE
,REWIND,ENDFILE,CHAIN,WRITE/
12 DATA COMNT(5),COMNT(22),COMNT(23),COMNT(11),COMNT(13),COMNT(18),COMNT(19)
,COMNT(20),COMNT(21)/3*'USE BFO',6*'MANUALLY REPROGRAM'/
13 DATA COMNT(14),COMNT(15),COMNT(16),COMNT(17)/4*''/
14 DATA COMNT(24),COMNT(25),COMNT(26),COMNT(27),
COMNT(28),COMNT(29),COMNT(30)/7*'CONVERT I-O'/
15 STRING INPSTR(300),CRSTR(300),NXSTR(100),RSTR(300),TSTR(12)
16 ON INTERRUPT GO TO 910
17 IF (TCP(0).NE.0) GO TO 910 .ELSE. DISPLAY ""
18 DISPLAY "TYPE ALTMODE TO STOP LISTING"
19 DISPLAY ""
20 DISPLAY "                    GETYMFORTRAN VERSION A 1.00"
21 DISPLAY "                FOR GE FORTRAN TO TYMSHARE SUPERFORTRAN"
22 DISPLAY "                            TRANSLATION"
23 DISPLAY ""
24 DISPLAY "GENERAL:"
25 DISPLAY ""
26 DISPLAY "       1. RENUMBERING WILL TAKE PLACE IN THE TRANSLATOR ONLY IF"
27 DISPLAY "          LINE NUMBERS ARE TOO LARGE FOR SFO."
28 DISPLAY ""
29 DISPLAY "TRANSLATIONS:"
30 DISPLAY ""
31 DISPLAY "       1. COMMENTS: CHANGES C TO *, LEAVES * ALONE"
32 DISPLAY ""
33 DISPLAY "       2. MULTIPLE STATEMENT LINES (;): LEFT ALONE UNLESS --"
34 DISPLAY "           A) THERE IS A STATEMENT LABEL ANYWHERE IN THE LINE.  THE"
35 DISPLAY "              STATEMENT LABEL MAY BE NUMERIC OR ALPHA.  THE NUMERIC"
36 DISPLAY "              LABEL MAY HAVE A ':' AFTER IT, AN ALPHA LABEL WILL HAVE"
37 DISPLAY "              A ':' AFTER IT.  SPLITS THE LINE AT THIS POINT."
38 DISPLAY "           B) STOP; END  -- WILL BE SPLIT."
39 DISPLAY ""
40 DISPLAY "       3. OCTAL CONSTANTS IN DATA & FORMAT STATEMENTS WILL BE MADE"
41 DISPLAY "          INTO COMMENTS,& FLAGGED (E.G., 'OCTAL CONSTANTS FOUND IN"
42 DISPLAY "          LINE XXX, MADE INTO COMMENTS .... MANUAL CONVERSION TASK')"
43 DISPLAY ""
44 DISPLAY "       4. CONVERTS 'ALPHA' DECLARATIONS TO 'STRING(4)'"
45 DISPLAY "          CONVERTS 'FILENAME' DECLARATIONS TO 'STRING(8)'"
46 DISPLAY "          FOR BOTH SINGLE VARIABLES & ARRAYS.  ALSO LOOKS FOR THE"
47 DISPLAY "          POSSIBILITY OF THE SAME VARIABLE IN BOTH DIMENSION STATEMENTS"
48 DISPLAY "          & ALPHA/FILENAME DECLARATIONS."
49 DISPLAY ""
50 DISPLAY "       5. 'IMPLICIT' STATEMENT: MAKES INTO COMMENT & FLAG"
51 DISPLAY "          WITH 'IMPLICIT DECLARATION IN LINE XXX ... USE BFO FOR"
52 DISPLAY "          THIS PROGRAM'"
53 DISPLAY ""
54 DISPLAY "       6. 'EQUIVALENCE' STATEMENT: PASS THRU + MESSAGE 'EQUIVALENCE"
55 DISPLAY "          FOUND IN LINE XXX ... BE CAREFUL THAT VARIABLE TYPES MATCH'"
56 DISPLAY ""
57 DISPLAY "       7. RELATIONAL OPERATORS:"
58 DISPLAY "              '<' --> '.LT.'"
59 DISPLAY "              '>' --> '.GT.'"
60 DISPLAY ""
61 DISPLAY "       8. CHAIN --> LINK"
62 DISPLAY ""
63 DISPLAY "       9. READ,A,B,C --> ACCEPT '?',A,B,C"
64 DISPLAY "          INPUT,A,B,C"
65 DISPLAY ""
66 DISPLAY "       10. READ 3,A,B --> READ(0,3) A,B"
67 DISPLAY "           INPUT 3,A,B"
68 DISPLAY ""
69 DISPLAY "       11. PRINT,A,B,'TEXT' --> DISPLAY A,B,'TEXT'"
70 DISPLAY "           PRINT 3,A,'TEXT' --> WRITE(1,3) A,B,'TEXT'"
71 DISPLAY ""
72 DISPLAY "       12. FORMAT STATEMENTS - CARRIAGE CONTROL  (CAN OCCUR AFTER"
73 DISPLAY "           A '/' OR AT THE BEGINNING OF A FORMAT)"
74 DISPLAY ""
75 DISPLAY "            1H + (1,&,SPACE,+,0,-)  FLAG - 'CARRIAGE CONTROL"
76 DISPLAY "           CHARACTER IN FORMAT STMT ON LINE XXX'"
77 DISPLAY ""
78 DISPLAY "       13. FORMAT (V) - CHANGES STATEMENT REFERRING TO THIS FORMAT TO"
79 DISPLAY "           HAVE NO FORMAT REFERENCE  (FREE FORM)"
80 DISPLAY ""
81 DISPLAY "       14. CONVERTS THE FOLLOWING TO REMARKS & FLAGS FOR LATER CONVERSION"
82 DISPLAY "           ROUTINE (FOR FILE I/O):"
83 DISPLAY ""
84 DISPLAY "            FILELIST               BACKSPACE 'TEXT'"
85 DISPLAY "            SET('TEXT')            REWIND 'TEXT' OR I()"
86 DISPLAY "            WRITE('TEXT')          ENDFILE 'TEXT'"
87 DISPLAY "            OPENFILE 'TEXT'        READ(FILE1,.... )"
88 DISPLAY "            CLOSEFILE 'TEXT'       WRITE(FILE1,.... )"
89 DISPLAY ""
90 DISPLAY "       15. ENCODE, DECODE - MAKES REMARK + MESSAGE 'ENCODE <DECODE>"
91 DISPLAY "           FOUND IN LINE XXX & MADE INTO COMMENT - MAY WANT TO"
92 DISPLAY "           USE BFO'"
93 DISPLAY ""
94 DISPLAY "       16. ENTRY - MAKES REMARK & MESSAGE 'ENTRY' FOUND IN LINE"
95 DISPLAY "           XXX & MADE INTO COMMENT - MANUAL REPROGRAMMING NEEDED'"
96 DISPLAY ""
97 DISPLAY "       17. SUBROUTINE(......,*,*)"
98 DISPLAY "           ....."
99 DISPLAY "           ....."
100 DISPLAY "           RETURN 2 -- MAKES REMARK & MESSAGE 'ALTERNATE RETURN FOUND"
101 DISPLAY "                       IN LINE XXX, MADE INTO COMMENT, MANUALLY"
102 DISPLAY "                       REPROGRAM'"
103 DISPLAY ""
104 DISPLAY "       18. LOAD - MAKES REMARK & MESSAGE 'LOAD STMT FOUND ON LINE XXX,"
105 DISPLAY "                  MADE INTO COMMENT, MANUALLY REPROGRAM'"
106 DISPLAY ""
107 DISPLAY "       19. CHECK, NOCHECK, LINE, NOLINE - MAKES REMARK + MESSAGE"
108 DISPLAY "           'UNCONVERTIBLE STMT FUNCTION FOUND IN LINE XXX, MADE"
109 DISPLAY "           INTO COMMENT, MANUALLY REPROGRAM'"
110 DISPLAY ""
111 DISPLAY "       20. FUNCTIONS:"
112 DISPLAY ""
113 DISPLAY "            AND, EOR, OR - FLAG - 'USE BFO'"
114 DISPLAY "            BCLK --> BKCLK(X)=VAL(SUBSTR3(DATE(Z),8,2)+VAL(SUBSTR"
115 DISPLAY "                     (DATE(X),11)/60"
116 DISPLAY "            CLK --> SUBSTR(DATE(X),8)"
117 DISPLAY "            DAT - UNCONVERTIBLE"
118 DISPLAY "            IDATE(X) --> VAL(RIGHT(STR(YEAR(X)),2)+LEFT(DATE,2)+"
119 DISPLAY "                         SUBSTR3(DATE,4,2))"
120 DISPLAY "            DINT, DFIX, IDFIX --> FIX"
121 DISPLAY "            LOC(X) --> POSITION(X)"
122 DISPLAY "            LOF(X) --> SIZE(X)"
123 DISPLAY "            NUMF - USE BFO"
124 DISPLAY "            USE - FLAG"
125 DISPLAY "            RRAND(X) --> SETRAND(-1)"
126 DISPLAY "            RND(X) --> RAND(X)"
127 DISPLAY ""
128 DISPLAY "       21. CALLS TO SYSTEM:"
129 DISPLAY ""
130 DISPLAY "            CALL BREAK - FLAG"
131 DISPLAY "            CALL BYE --> LOGOUT"
132 DISPLAY "            CALL PID - FLAG"
133 DISPLAY "            CALL EXITLM - FLAG"
134 DISPLAY ""
135 DISPLAY "       22. CONTINUATION CHARACTER:"
136 DISPLAY ""
137 DISPLAY "            <LINE LABEL>& --> <LF>   AND FLAGS LINES THAT ARE TOO LONG."
138 DISPLAY ""
139 DISPLAY "MARK I FEATURES:"
140 DISPLAY ""
141 DISPLAY "ALPHA STMT LABELS -"
142 DISPLAY ""
143 DISPLAY "       E.G., WRITE #2 FMTBAL1,A,B"
144 DISPLAY "             FMTBAL1 (F8.3,I6)"
145 DISPLAY ""
146 DISPLAY "             GOTO MOSS"
147 DISPLAY "             IF (X) PICK, YOUR, LABEL   <GOES TO 'PICK' IF X<0,"
148 DISPLAY "                                         'YOUR' IF X=0, 'LABEL' IF X>0>"
149 DISPLAY ""
150 DISPLAY "SMALL 'IF' STMTS -"
151 DISPLAY ""
152 DISPLAY "       IF(X) 20 --> IF(X.LT.0) GOTO 20"
153 DISPLAY "       IF(X) 46,47 --> IF(X.LT.0) GOTO 46 .ELSE. (IF(X.EQ.0) GOTO 47)"
154 DISPLAY ""
155 DISPLAY "$DATA BLOCK (@ END OF PROGRAM) -"
156 DISPLAY ""
157 DISPLAY "       PUTS DATA INTO SEPARATE FILE & PRINT MESSAGE '$DATA BLOCK FOUND"
158 DISPLAY "         AND PLACED  IN FILE 'FILE' - MANUALLY CONVERT THE READ"
159 DISPLAY "         STATEMENTS'"
160 DISPLAY ""
161 DISPLAY ""
162 DISPLAY ""
163 910 DISPLAY ""
164 ON INTERRUPT GO TO 900
165 * CLOSE (*)
166 GO TO 930
167 900 CLOSE (*)
168 930 WRITE(1,SNR)'INPUT FILE: '
169 READ(*,SCR,ERR=900,END=900)FNI
170 CLOSE (2);OPEN(2,FNI,INPUT,ERR=900)
171 GO TO 931
172 901 CLOSE (*)
173 931 WRITE(1,SNR)'OUTPUT FILE: '
174 READ(*,SCR,ERR=901,END=901)FNO
175 CLOSE (3);OPEN (3,FNO,OUTPUT,ERR=901)
176 CLOSE (3);OPEN(3,"GETYM'SCR'",OUTPUT,ERR=902)
177 GO TO 933
178 903 CLOSE (*)
179 933 WRITE(1,SNR)'DIAGNOSTIC FILE (OR TEL):  '
180 READ(*,SCR,ERR=903,END=903)FND
181 CLOSE (4);OPEN(4,FND,OUTPUT,ERR=903)
182 ON INTERRUPT GO TO 906
183 READ(2,SCR)INPSTR
184 5 I=NUMPUL(INPSTR); IORG=1 ; IXIF=1
185 LNUM=LEFT(INPSTR,I)+' '; INPSTR=SUBSTR(INPSTR,I+1)
186 
187 I=NUMPUL(INPSTR)
188 IF (I.EQ.0)(SNUM='' ;  GOTO10)
189 SNUM=LEFT(INPSTR,I)+" "; INPSTR=SUBSTR(INPSTR,I+1)
190 
191 10 READ(2,SCR,END=999)NXSTR
192 I=NUMPUL(NXSTR)+1
193 17 IF(SUBSTR3(NXSTR,I,1).EQ.' ')(I=I+1; GOTO17)
194 IF(SUBSTR3(NXSTR,I,1).NE.'&') GOTO20
195 INPSTR=INPSTR+SUBSTR(NXSTR,I+1); GOTO10
196 
197 20 CALL CRUNCH(INPSTR,CRSTR)
198 IF (SNUM.NE.'') GOTO21
199 IF(LEFT(INPSTR,1).EQ.'C')
(INPSTR='*'+SUBSTR(INPSTR,2); GOTO 70)
200 IF(LEFT(CRSTR,1).EQ.'*') GOTO70
201 21 ISC=INDEX(CRSTR,';')
202 16 DO 25 I=1 , 32
203  IF(INDEX(CRSTR,STMTHD(I)).EQ.IXIF) GOTO30
204 25 CONTINUE
205 GOTO 80
206 
207 
208 * FOUND A STMT THAT NEEDS TRANSLATING
209 30 GOTO(31,32,33,34,35,36,37,38,39,40,41
,42,43,44),NST(I)
210 31 WRITE(4,SCR)STMTHD(I)+' FOUND IN LINE '+LNUM
211 IF(COMNT(I).NE.'') WRITE(4,SCR)COMNT(I)
212 CRSTR='*'+CRSTR; GOTO90
213 *
214 * ALPHA AND FILENAME HERE
215 *
216 32 CONTINUE
217 33 CRSTR='STRING '+SUBSTR(CRSTR,NST(I)*3)
218 TSTR='('+STR((NST(I)-1)*4)+')'
219 CRSTR=CRSTR+TSTR; J=1
220 330 I=INDEX3(CRSTR,',',J)
221 IF(I.EQ.0)GOTO90
222 CRSTR=LEFT(CRSTR,I-1)+TSTR+SUBSTR(CRSTR,I); J=I+5
223 GOTO330
224 *
225 ******* HANDLE OCTAL CONSTANTS IN DATA STMT HERE****
226 *
227 34 I=1
228 340 I=INDEX3(CRSTR,'/',I); J=INDEX3(CRSTR,'/',I+1)
229 IF(I.EQ.0) GOTO90
230 342 IF(SUBSTR3(CRSTR,I+1,1).EQ.'O') GOTO341
231 I=INDEX3(CRSTR,',',I+1)
232 IF(I.GT.J)GOTO340
233 GOTO342
234 341 WRITE(4,SCR)'OCTAL CONSTANT FOUND IN LINE '+LNUM
235 WRITE(4,SCR)'MANUALLY REPROGRAM'
236 CRSTR='*'+CRSTR; GOTO90
237 *
238 ********EQUIVALENCE****
239 *
240 36 WRITE(4,SCR)'EQUIVALENCE FOUND IN LINE '+LNUM
241 WRITE(4,SCR)'BE SURE TYPES MATCH!!'
242 GOTO90
243 *
244 ******IF(X> ** IF X< ******HERE***
245 *
246 37 I=INDEX(CRSTR,'<'); J=INDEX(CRSTR,'>')
247 IF(I.EQ.0.AND.J.EQ.0) GOTO50
248 IF(I.GT.J)(CRSTR=LEFT(CRSTR,I-1)+'.LT.'+SUBSTR
(CRSTR,I+1); GOTO 37)
249 CRSTR=LEFT(CRSTR,J-1)+'.GT.'+SUBSTR(CRSTR,J+1); GOTO37
250 50 IPCNT=1
251 DO 51 I=4,LENGTH(CRSTR)
252 TSTR=SUBSTR3(CRSTR,I,1)
253 IF(TSTR.EQ.')')(IPCNT=IPCNT-1; GOTO52)
254 IF(TSTR.EQ.'(')IPCNT=IPCNT+1
255 GOTO51
256 52 IF(IPCNT.EQ.0)(IXIF=I+1; GOTO16)
257 51 CONTINUE
258 *
259 *
260 *******RETURN #****
261 *
262 41 IF(LENGTH(CRSTR).EQ.IXIF+5) GOTO90
263 IF (NUMPUL(SUBSTR(CRSTR,7)).EQ.0) GOTO90
264 WRITE(4,SCR)'ALTERNATE RETURN IN LINE '+
LNUM+'...MANUALLY REPROGRAM'
265 CRSTR='*'+CRSTR ; GOTO90
266 *
267 *****CALL BYE******
268 42 CRSTR=LEFT(CRSTR,IXIF-1)+'LOGOUT' ; GOTO90
269 *
270 *****CHAIN***
271 *
272 43 CRSTR=LEFT(CRSTR,IXIF-1)+'LINK '+SUBSTR(CRSTR,IXIF+5)
   ; GOTO90
273 *
274 *****************
275 *
276 * FORMATS TREATED HERE****
277 *
278 ****************
279 35 IF(CRSTR.EQ.'FORMAT(V)')(IFFX=IFFX+1; IFF(IFFX)=VAL(SNUM);
     CRSTR='*'+CRSTR; GOTO90)
280 I=8; J=1
281 IF(SUBSTR3(CRSTR,I,1).EQ.'"')(I=9;GOTO55)
282 57 I=INDEX3(CRSTR,'"',I)+1 ;J=J+1
283 IF(I.EQ.1)GOTO90
284 IF(.NOT.(SUBSTR3(CRSTR,I-2,1).EQ.'/'))GOTO57
285 *
286 *****PERHAPS CARR.CONTROL
287 *
288 55 TSTR=QSTR(J)
289 IF(.NOT.(TSTR.EQ.'1'.OR.TSTR.EQ.' '.OR.TSTR.EQ.'-'.OR.TSTR.EQ.'+'
.OR.TSTR.EQ.'&'.OR.TSTR.EQ.'0'))GOTO57
290 CRSTR='*'+CRSTR
291 WRITE(4,SCR)'CARRIAGE CONTROL CHAR FOUND IN FORMAT IN LINE '+LNUM
292 GOTO90
293 *
294 ****************************
295 *****READ,WRITE,INPUT,PRINT*********
296 **********
297 *
298 44 CONTINUE
299 38 CONTINUE
300 39 CONTINUE
301 40 J=NST(I)
302 IF(J.EQ.8)I=IXIF+4.ELSE.(I=IXIF+5)
303 TSTR=SUBSTR3(CRSTR,I,1)
304 IF(TSTR.EQ.',')GOTO60
305 IF(TSTR.GE.'0'.AND.TSTR.LE.'9')GOTO65
306 IF(TSTR.EQ.'(')(IRFLG=-1; IF (J.EQ.8.OR.J.EQ.14)GOTO66)
307 GOTO69
308 *
309 *::: DISPLAY AND ACCEPT CONVERSION***
310 *
311 60 IF(J.EQ.10.OR.J.EQ.14)(TSTR='DISPLAY ';I=I+1).ELSE.(
TSTR="ACCEPT '?'")
312 68 CRSTR=LEFT(CRSTR,IXIF-1)+TSTR+SUBSTR(CRSTR,I); GOTO69
313 *
314 ******WRITE(1,FMT)---READ(0,FMT)*********
315 *
316 65 IF(J.EQ.10.OR.J.EQ.14)TSTR='WRITE(1,'.ELSE.(TSTR='READ(0,')
317 K=INDEX3(CRSTR,',',I+1); IF(K.EQ.0)CRSTR=CRSTR+')'.ELSE.(
CRSTR=LEFT(CRSTR,K-1)+')'+SUBSTR(CRSTR,K+1)); IRFLG=-1
318 GOTO68
319 *
320 * LOOK FOR POSIBLE FILENAME INSTEAD OF NUMMBER**
321 *
322 66 TSTR=SUBSTR3(CRSTR,I+1,1)
323 IF(TSTR.EQ.'"')(CRSTR='*'+CRSTR;GOTO67)
324 IF('A'.LE.TSTR.AND.TSTR.LE.'Z')WRITE(4,SNR)
'POSSIBLE '.ELSE.(GOTO69)
325 67 WRITE(4,SCR)'FILE NAME USED AS FILE NUMBER IN LINE '+LNUM
326 69 IF(J.EQ.10.OR.J.EQ.14)GOTO80
327 GOTO90
328 *
329 *
330 *
331 *
332 *
333 **************
334 80 CALLFUNCSRCH ( CRSTR)
335 90 IF(ISC.EQ.0)GOTO100
336 ISC=INDEX(CRSTR,';'); RSTR=SUBSTR(CRSTR,ISC+1)
337 CRSTR=LEFT(CRSTR,ISC-1)
338 100 K=1
339 DO 101 I=IORG,IXQ
340 J=INDEX3(CRSTR,'"',K);IF(J.EQ.0) GOTO106
341 CRSTR=LEFT(CRSTR,J)+QSTR(I)+'"'+SUBSTR(CRSTR,J+1)
342 K=J+LENGTH(QSTR(I))+2
343 101 CONTINUE
344 * QUOTES NOW ALL FILLED IN
345 *
346 106 IORG=I+1
347 IF(VAL(LNUM).GT.999)(FLNUM=FLNUM+.001 ;
LNUM=SUBSTR(STR(FLNUM),2)+' ')
348 IF(IRFLG.NE.0)(LNUM='\'+LNUM; IRFLG=0)
349 WRITE(3,SCR)LNUM+SNUM+CRSTR
350 IF(ISC.EQ.0)(INPSTR=NXSTR; GOTO5)
351 LNUM=SUBSTR(STR(VAL(LNUM)+.001),2)+' '
352 CRSTR=RSTR
353 I=NUMPUL(CRSTR)
354 IF(I.EQ.0)SNUM=''.ELSE
.(SNUM=LEFT(CRSTR,I)+' '; CRSTR=SUBSTR(CRSTR,I+1))
355 GOTO21
356 
357 70 IF(VAL(LNUM).GT.999)(FLNUM=FLNUM+.001 ;
LNUM=SUBSTR(STR(FLNUM),2)+' ')
358 WRITE(3,SCR)LNUM+SNUM+INPSTR
359 INPSTR=NXSTR; GOTO5
360 
361 999 IF(IEOF.EQ.0)(IEOF=1; GOTO20)
362 *
363 *
364 *  FILL IN FORMAT WITH FREE FORM
365 *
366 CLOSE(3); CLOSE(2); OPEN(2,"GETYM'SCR'",INPUT); OPEN(3,FNO,OUTPUT)
367 105 READ(2,SCR,END=9999)INPSTR
368 IF (LEFT(INPSTR,1).NE.'\') GOTO110
369 INPSTR=SUBSTR(INPSTR,2)
370 IF(IFFX.EQ.0)GOTO110
371 J=INDEX(INPSTR,','); K=INDEX(INPSTR,')')
372 IF(J.GT.K)GOTO110; CRSTR=SUBSTR3(INPSTR,J+1,K-J-1)
373 DO 115 L=1,LENGTH(CRSTR)
374 TSTR=SUBSTR3(CRSTR,L,1)
375 IF(TSTR.LT.'0'.OR.TSTR.GT.'9')GOTO110
376 115 CONTINUE
377 JVAL=VAL(CRSTR)
378 DO 120 I=1,IFFX
379 IF(IFF(I).EQ.JVAL)GOTO140
380 120 CONTINUE
381 GOTO110
382 *
383 * REPAIR FREE FORMAT
384 *
385 140 INPSTR=LEFT(INPSTR,J-1)+SUBSTR(INPSTR,K)
386 110 IF(LENGTH(INPSTR).GT.72)(WRITE(3,SNR)
LEFT(INPSTR,72)+CHAR(106);INPSTR=SUBSTR(INPSTR,73); GOTO110)
387 WRITE(3,SCR)INPSTR; GOTO105
388 *
389 9999 CLOSE(2); CLOSE(3); CLOSE("GETYM'SCR'")
390 DISPLAY 'EOF'
391 QUIT
392 902 DISPLAY "UNABLE TO OPEN SCRATCH FILE, ABORTING JOB"
393 CLOSE (*)
394 QUIT
395 906 CLOSE (*);CLOSE(2);CLOSE(3);CLOSE(4);
CLOSE("GETYM'SCR'")
396 DISPLAY CHAR(109)+'ABORTED'
397 ON INTERRUPT GO TO 900
398 GO TO 900
399 *
400 END
401 *





402 SUBROUTINE CRUNCH(INPSTR,CRSTR)
403 STRING QSTR(10)(100)
404 COMMON QSTR,IXQ
405 * REMOVE BLANKS AND STRING EXPRS FROM INPSTR
406 STRING CRSTR(100),INPSTR(100),TCHR(1)
407 L=1 ; IXQ=0; CRSTR=''
408 10 DO 20 I=L,LENGTH(INPSTR)
409 TCHR=SUBSTR3(INPSTR,I,1)
410 IF(TCHR.EQ.' '.OR.TCHR.EQ.'
') GOTO 20
411 IF(TCHR.NE.'"')GOTO 45
412 * QUOTES HANDLED HERE
413 IXQ=IXQ+1; QSTR(IXQ)=''
414 DO 25 J=I+1,LENGTH(INPSTR)
415 TCHR=SUBSTR3(INPSTR,J,1)
416 IF(TCHR.EQ.'"')GOTO 26
417 25 QSTR(IXQ)=QSTR(IXQ)+TCHR
418 *
419 26 CRSTR=CRSTR+'"'
420 L=J+1
421 GOTO10
422 *
423 * HOLLERITH CONVERTED HERE
424 *
425 45 IF (TCHR.NE.'H')GOTO31
426 J=LENGTH(CRSTR)
427 TCHR=SUBSTR3(CRSTR,J,1)
428 IF(TCHR.LT.'0'.OR.TCHR.GT.'9') GOTO30
429 *
430 * #H
431 *
432 K=VAL(TCHR)
433 32 J=J-1; TCHR=SUBSTR3(CRSTR,J,1)
434 IF(TCHR.LT.'0'.OR.TCHR.GT.'9') GOTO40
435 K=K+VAL(TCHR)*10
436 GOTO32
437 *
438 * NOW CHECK TO MAKE SURE CHAR PRECEEDING HOLLERITH FIELD IS NOT ALPHA
439 *
440 40 IF(TCHR.GE.'A'. AND.TCHR.LE.'Z')GOTO30
441 CRSTR=LEFT(CRSTR,J)+'"'
442 IXQ=IXQ+1; QSTR(IXQ)=SUBSTR3(INPSTR,I+1,K); L=I+K+1
443 GOTO10
444 *
445 * TACK ON CHAR
446 *
447 30 TCHR='H'
448 31 CRSTR=CRSTR+TCHR
449 20 CONTINUE
450 *
451 RETURN
452 END
453 *







454 FUNCTION NUMPUL(STR)
455 * RETURNS A NUMBER=NUMBER OF NUMERIC
456 * CHARS AT HEAD OF 'STR'+LEADING BLANKS
457 STRING STR(100),TCH(1)
458 I=0; J=1; K=0
459 9 IF(SUBSTR3(STR,J,1).EQ.' ')(J=J+1; I=I+1; GOTO9)
460 *
461 DO 10 J=J,LENGTH(STR)
462 TCH=SUBSTR3(STR,J,1)
463 IF(TCH.LT.'0'.OR.TCH.GT.'9') GOTO20
464 10 I=I+1; K=1
465 20 IF(K.EQ.0)(NUMPUL=0; RETURN)
466 NUMPUL=I
467 RETURN
468 END
469 
470 
471 
472 
473 SUBROUTINE FUNCSRCH(STR)
474 INTEGER CFLG
475 STRING QSTR(10)(100),LNUM(15)
476 COMMON QSTR,IXQ,CFLG,LNUM
477 STRING STR(300),TSTR(1),FNAMES(16)(5),FSUB(10)(60)
478 DATA FNAMES/AND,OR,EOR,NUMF,USE,DAT,DINT,DFIX
,IDFIX,LOC,LOF,RND,RRAND,CLK,IDATE,BCLK/
479 DATA FSUB/3*FIX,POSITION,SIZE,RAND,SETRAND(-1),
'SUBSTR(DATE(X),8)','VAL(RIGHT(STR(YEAR(X)),2)+
 LEFT(DATE,2)+SUBSTR3(DATE,4,2))'/
480 FSUB(10)='VAL(SUBSTR3(DATE(Z),8,2))+VAL(SUBSTR(DATE(X),11))/60'
481 
482 
483 
484 *FIND A FUNCTION**************
485 *
486 *
487 DO 10 I=1,16
488 J=INDEX(STR,FNAMES(I))
489 IF(J.EQ.0)GOTO10
490 IF(J.EQ.1)GOTO15
491 TSTR=SUBSTR3(STR,J-1,1)
492 IF((TSTR.GE.'A'.AND.TSTR.LE.'Z').OR.TSTR.EQ.'.')GOTO10
493 15 TSTR=SUBSTR3(STR,J+LENGTH(FNAMES(I)),1)
494 IF(TSTR.GE.'A'.AND.TSTR.LE.'Z')GOTO10
495 IF(TSTR.GE.'0'.AND.TSTR.LE.'9')GOTO10
496 IF(I.LE.6)WRITE(4)FNAMES(I)+' FUNCTION FOUND IN LINE '+LNUM
497 IF(I-7)16,18,18
498 16 IF(I.LE.4)WRITE(4)'USE BFO'.ELSE.(WRITE(4)'MANUALLY TRANSLATE')
499 STR='*'+STR
500 GOTO10
501 18 IF(I.GE.13)STR=LEFT(STR,J-1)+SUBSTR(STR,INDEX3(STR
,')',J)+12 STR=LEFT(STR,J-1)+FSUB(I-6)+SUBSTR(STR,J+LENGTH(FNAMES(I)))
503 10 CONTINUE
504 RETURN
505 END
506 
507 
508 
5                                                                Q@¶