    P R O G R A M   S A L P G M 		COBOL 4(56)	 3-APR-73  08:41		PAGE 1

    0001    IDENTIFICATION DIVISION.
    0002    PROGRAM-ID. 'SALPGM'.
    0003    REMARKS.  THIS PROGRAM PROVIDES A SORTED WEEKLY REPORT OF ALL
    0004             EMPLOYEES AND THEIR CALCULATED GROSS SALARIES BASED
    0005             ON A SALARY CODE.
    0006    ENVIRONMENT DIVISION.
    0007    INPUT-OUTPUT SECTION.
    0008    FILE-CONTROL.
    0009           SELECT EMPLOYEE-LIST ASSIGN TO DSK
    0010             RECORDING MODE IS ASCII.
    0011           SELECT RATE-TABLE    ASSIGN TO DSK
    0012             RECORDING MODE IS ASCII.
    0013           SELECT SORTFILE      ASSIGN TO DSK, DSK, DSK.
    0014           SELECT SALARY-REPORT ASSIGN TO DSK.
    0015    I-O-CONTROL.
    0016           RERUN EVERY 2000 RECORDS OF EMPLOYEE-LIST.
    0017    DATA DIVISION.
    0018    FILE SECTION.
    0019    FD      EMPLOYEE-LIST  VALUE OF IDENTIFICATION IS 'EMPLSTDAT'.
    0020    01      EMPLST-REC      PIC X(25).
    0021    SD      SORTFILE.
    0022    01      SORTREC.
    0023           05 FILLER       PIC X(15).
    0024           05 S-EMPNO      PIC X(5).
    0025           05 FILLER       PIC X(3).
    0026           05 S-SALCDE1    PIC X.
    0027           05 FILLER       PIC X.
    0028    FD      RATE-TABLE  VALUE OF IDENTIFICATION IS 'RATES DAT'.
    0029    01      RATE-REC        PIC X(7).
    0030    FD      SALARY-REPORT VALUE OF IDENTIFICATION IS 'SALRPTDAT'.
    0031    01      SALRPT-REC      PIC X(46).
    0032    WORKING-STORAGE SECTION.
    0033    77 SEQ-IP       PIC XX.
    0034    77 COMPUTED-AMT PIC S9(5)V99  VALUE ZEROES  COMP.
    0035    01  IP-EMPLST.
    0036           05  IP-NAME     PIC X(15).
    0037           05  IP-NO       PIC X(5).
    0038           05  IP-HRS      PIC S9(3).
    0039           05  IP-HRS-RE REDEFINES IP-HRS PIC S9(2)V9.
    0040           05  IP-SALCDE.
    0041                   10  IP-SALCDE1  PIC X.
    0042                   10  IP-SALCDE2  PIC X.
    0043    01  SAL-CODE-TABLE.
    0044           05  SCODE-TABLE OCCURS 18  TIMES INDEXED BY IDX.
    0045                   10  SCODE1.
    0046                           15  SCODE-HS  PIC X.
    0047                           15  SCODE-LVL PIC X.
    0048                   10  SCODE-RATE  PIC S9(3)V99.
    0049    01  OP-SALRPT.
    0050           05  OP-NAME     PIC X(15).
    0051           05  FILLER      PIC X(3)  VALUE SPACES.
    0052           05  OP-NO       PIC X(5).
    0053           05  FILLER      PIC X(4)  VALUE SPACES.
    0054           05  OP-HRS      PIC ZZ.Z.
    0055           05  FILLER      PIC X(4)  VALUE SPACES.
    0056           05  OP-SALCDE   PIC XX.    P R O G R A M   S A L P G M 		COBOL 4(56)	 3-APR-73  08:41		PAGE 1-1

    0057  
    0058           05  OP-GRS-AMT  PIC $$$$$$.99.
    0059    01  OP-HDG1     PIC X(46)  VALUE
    0060       '        * * WEEKLY SALARY ANALYSIS * *'.
    0061    01  OP-HDG2     PIC X(46)  VALUE
    0062       ' EMPLOYEE NAME      EMP.   HRS.   SAL.   GROSS'.
    0063    01  OP-HDG3     PIC X(46)  VALUE
    0064       '                    NO.          CODE   AMOUNT'.
    0065    01  OP-HDGEND   PIC X(46)  VALUE
    0066       '                END OF REPORT'.
    0067  
    0068    PROCEDURE DIVISION.
    0069    HSE-KEEP.
    0070           OPEN INPUT RATE-TABLE.
    0071           OPEN OUTPUT SALARY-REPORT.
    0072           SET IDX TO 0.
    0073           PERFORM BUILD-RATE-TABLE THRU BUILD-EXIT.
    0074           WRITE SALRPT-REC FROM OP-HDG1 BEFORE ADVANCING 2 LINES.
    0075           WRITE SALRPT-REC FROM OP-HDG2.
    0076           WRITE SALRPT-REC FROM OP-HDG3 BEFORE ADVANCING 2 LINES.
    0077    TRACE ON.
    0078    BEGIN.
    0079           DISPLAY '---INDICATE SEQUENCE OF REPORT DESIRED.'.
    0080           DISPLAY '    -EMPLOYEE NO. (EN).'.
    0081           DISPLAY '    -SALARY CODE (SC).'.
    0082           ACCEPT SEQ-IP.
    0083           IF SEQ-IP = 'SC' GO TO B1.
    0084           SORT SORTFILE ON ASCENDING KEY S-EMPNO, S-SALCDE1
    0085             USING EMPLOYEE-LIST
    0086             OUTPUT PROCEDURE MAIN-PGM THRU MAIN-EXIT.
    0087           STOP RUN.
    0088    B1.     SORT SORTFILE ON ASCENDING KEY S-SALCDE1, S-EMPNO
    0089             USING EMPLOYEE-LIST
    0090             OUTPUT PROCEDURE MAIN-PGM THRU MAIN-EXIT.
    0091           STOP RUN.
    0092    MAIN-PGM.
    0093           RETURN SORTFILE INTO IP-EMPLST AT END GO TO WRITE-ENDLINE.
    0094           MOVE IP-NAME   TO OP-NAME.
    0095           MOVE IP-NO     TO OP-NO.
    0096           MOVE IP-HRS-RE TO OP-HRS.
    0097           MOVE IP-SALCDE TO OP-SALCDE.
    0098           PERFORM SRCH-RATES THRU SRCH-EXIT.
    0099           MOVE COMPUTED-AMT TO OP-GRS-AMT.
    0100           WRITE SALRPT-REC FROM OP-SALRPT.
    0101           GO TO MAIN-PGM.
    0102    SRCH-RATES.
    0103           SET IDX TO 1.
    0104           SEARCH SCODE-TABLE AT END GO TO S1,
    0105             WHEN IP-SALCDE = SCODE1 (IDX) GO TO S2.
    0106    S1.     MOVE ZEROES TO COMPUTED-AMT.
    0107  
    0108           GO TO SRCH-EXIT.
    0109    S2.     IF SCODE-HS (IDX) = 'H'
    0110  
    0111             COMPUTE COMPUTED-AMT ROUNDED = IP-HRS-RE * SCODE-RATE (IDX)
    0112           ELSE MOVE SCODE-RATE (IDX) TO COMPUTED-AMT.    P R O G R A M   S A L P G M 		COBOL 4(56)	 3-APR-73  08:41		PAGE 1-2

    0113  
    0114    SRCH-EXIT.      EXIT.
    0115    WRITE-ENDLINE.
    0116           WRITE SALRPT-REC FROM OP-HDGEND AFTER ADVANCING 2 LINES.
    0117           CLOSE SALARY-REPORT.
    0118           DISPLAY '*** END OF JOB. TYPE SALRPT.DAT FOR SALARY REPORT.'.
    0119    MAIN-EXIT.      EXIT.
    0120  
    0121    BUILD-RATE-TABLE.
    0122           SET IDX UP BY 1.
    0123  
    0124  
    0125           READ RATE-TABLE INTO SCODE-TABLE (IDX) AT END
    0126             CLOSE RATE-TABLE, GO TO BUILD-EXIT.
    0127  
    0128           GO TO BUILD-RATE-TABLE.
    0129    BUILD-EXIT.     EXIT.

NO ERRORS DETECTED
