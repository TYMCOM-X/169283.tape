MODULE P1COMP(DOLLAR,STACK=GLOBAL($CSTK$,#177),CCL,
                FSAVE,TIMING,TIMER=EXTERNAL(SIX12))=
BEGIN


REQUIRE KDEFS.BLI[7,107355];
REQUIRE FDEFS.BLI[7,107355];
REQUIRE CDEFS.BLI[7,107355];
REQUIRE ADEFS.BLI[7,107355];
REQUIRE BDEFS.BLI[7,107355];
REQUIRE PDEFS.BLI[7,107355];
REQUIRE UDEFS.BLI[7,107355];

EXTERNAL JOBDDT;

BIND    TRUE=1,
        FALSE=0;

LOCAL KEEPCCLVREG, RETCSTK1;

MACHOP  TTCALL=#051,
        HALT  =#254;


ROUTINE FOOB(RTNADR)=
   BEGIN

   WHILE 1 DO
     BEGIN
  
     $CSRCF();

     $UAPSZ($USPTR('COMPILING'));
     $UPRPT();

     FLEVL$[FV$WARNING] _ FLEVL$[FV$FATAL] _ 0;
     $CSTART(CV$ERROROUT);
  
  
     $ASCAN();
  
     IF .JOBDDT NEQ 0  THEN
       $UMESS($USPTR('?M?JSCANNER DONE'));
  
     P$$$(); BSCHF$_FALSE; $BEXEC();
  
     IF .JOBDDT EQL 0 THEN $UOUTL();
     $UMESS($USPTR('SYNTAX DONE'));
  
     $FFERROR();
  
     IF NOT .FNWRN$  THEN  $FLER()
     ELSE IF .FLEVL$[FV$FATAL] NEQ 0 THEN  $FLER();
  
     RTNADR _ EXCHJ($CSTK$,-1)
     END

   END;




KEEPCCLVREG _ .VREG;

IF .KEEPCCLVREG EQL 0 THEN
  BEGIN
  TTCALL(3,PLIT(ASCIZ'?M?JThis file may not be RUN directly.?M?J'));
  HALT(4,0,0,0)
  END;

$CIHDT$ALIGN;
$CISREN();

$CDDT$RESET;

BEGIN
  MAP KFCB$ CTERM$;
  CTERM$[K$RR] _ $KGLED;
  CTERM$[K$WR] _ $KTYPL;
  CTERM$[K$SCPR] _ $KILIO;
  CTERM$[K$EXCEPT] _ $KIOAB
END;


IF .CSTK1$ EQL 0 THEN   % initializing %
  BEGIN
  CSTK1$ _ -1;
  $UMESS($USPTR('CSTK1$ Initialized for P1COMP'));
  $COLAY()
  END;

IF .CSTK1$ EQL -1 THEN   % new execution incarnation %
   CSTK1$ _ CREATE FOOB(.BREG)
                AT $CGTZM(#11777)
                LENGTH #11777
                THEN  EXCHJ($CSTK$,-1);

RETCSTK1 _ EXCHJ(.CSTK1$,.BREG);

IF .RETCSTK1 EQL -1 THEN
   $CFREEM(.CSTK1$);
CSTK1$ _ .RETCSTK1;

$COLAY()


END
ELUDOM
