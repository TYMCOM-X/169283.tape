1 STOP
100 '	D E F S T R
110 '
120 '   COMPANY PROPRIETARY, LUPFER & LONG COMPUTER SERVICES
140 '
150 '   VERSION 1.0
160 '
170 DIM F(16,15),N$(60),H(72),L$(400),U$(30)
180 DIM I(132),O(132),T(40)
185 DIM N(16,15)
190 DIM G$(10)
200 DIM F$(10),T$(4),R$(15)
210 '
220 FILE #3, "COMCOM.TMP"
230 FOR X=1 TO 10
240   READ #3, F$(X)
250 NEXT X
270 FILE :4: F$(5)		'  .COA
275    GOSUB 8500		'  READ HEADER
280 F$(3) = F$(3) + "132"
290 FILE :1: F$(3)		' STRUCTURE
300   IF LOF(1)>0 GO TO 2840
310 PRINT "==== DEFINITION OF ";F$(7);" - ";F$(1);" ===="
320 '
330 REM ========= PARAMETERS =================
340 O9=15
350 F1=1
360 F(6,F1)=G2
365 '
368 READ N9
370 FOR Y=1 TO N9+1
380   READ N$(Y),N(1,Y),N(2,Y),N(3,Y),N(4,Y),N(5,Y),N(6,Y)
390 NEXT Y
392 FOR J1=N9+2 TO 15
393   N$(J1)=N$(N9+1)
394   FOR I=1 TO 6
395     N(I,J1)=N(I,N9+1)
396   NEXT I
397 NEXT J1
398 '
400 MAT READ T$
410 '
440 '		FIELD TABLE
442 DATA 7			'  NO. OF PRE-DEFINED FIELDS
450 DATA ACCOUNT,	1,1,1, 9,1,8
455 DATA DATE,		0,1,0, 9,3,6
460 DATA EMPLOYEE,      1,1,0,13,0,9
470 DATA CHECK,		0,1,0, 4,1,5
480 DATA DESCRIPTION,	0,0,0, 9,2,32
500 DATA JOB,		1,1,0,13,0,9
510 DATA AMOUNT,	0,1,1, 2,4,10
515 '
520 DATA USER,		1,1,2, 9,0,32
530 '		FIELD FORMAT NAMES
540 DATA NUMERIC,TEXT,DATE,DOLLAR
550 '
560 REM ======== FIELD DEFINITION =============
570 PRINT
580 PRINT "- FIELD DESCRIPTION -"
600 Y=1
610 FOR Z=1 TO 15
620   GO TO 1052
650   F(0,Y)=16
660   FOR J=1 TO F(8,Y)
670     O(J)=ASC(SP)
680   NEXT J
690   O(0)=F(8,Y)
700   GOSUB 6000
710   CHANGE O TO N$(Y+O9)
720   Y=Y+1
790 NEXT Z
800 REM ======== WRITE .STR HEADER ===========
805 'SCRATCH :1 	****
810 H(0)=33
812 H(1)=1
814 H(2)=1
815 H(3)=Y-1
820 H(6)=H(6)+2
825 H(7)=2+INT((H(6)+3)/4)
828 H(9)=1
830 '
835 T(0)=3
840 V1=H(6)
845 GOSUB 4600
850 CHANGE T TO S$
855 N$=F$(4)+S$			'  FORMS F9999.DAT$NNN
860 '
865 H(10)=1
870 IF F(2,5)=0 GO TO 880
875   H(11)=5
880 IF F(2,2)=0 GO TO 890
885   H(12)=2
890 H(13)=7
895 '
900 CHANGE N$ TO T
905 FOR I=20 TO 32
910   H(I)=T(I-19)
915 NEXT I
920 '
925 H(33)=LEN(F$(7))
930 FOR I=0 TO H(0)
935   O(I)=H(I)
940 NEXT I
945 GOSUB 6000
950 CHANGE O TO S$
955 O$ = S$ + F$(7)
960 WRITE:1,O$
965 REM ========= INITIALIZE .DAT ============
970 FILE :2: N$
975 'SCRATCH :2		*****
980 FOR X=1 TO H(6)
985   O(X)=0
990 NEXT X
995 O(0)=H(6)
1000 GOSUB 6000
1005 CHANGE O TO O$
1010 WRITE :2: O$
1012 S$="EOF"
1014 WRITE :2: S$
1015   GO TO 1870
1050 REM ====== FIELD DEFINITION (CONT.) ========
1052 ON N(3,Z)+1 GO TO 1190,1130,1060
1060 '     - USER FIELD -
1065 IF Z>N9+1 GO TO 1100
1070 Q$="DEFINE ADDITIONAL FIELDS"
1080   GOSUB 4500
1090   IF I$="NO" THEN 800
1100 PRINT
1102 PRINT "FIELD NAME";
1104 IF Z=N9+1 GO TO 1110
1106   PRINT " (OR 'DONE')";
1110 INPUT N$(Z)
1112 IF N$(Z)="DONE" GO TO 800
1120   GO TO 1230
1130 '     - REQUIRED FIELD -
1140 PRINT
1150 PRINT "FOR THE '";N$(Z);"' FIELD (REQUIRED)"
1180   GO TO 1230
1190 '     - OPTIONAL FIELD -
1200 Q$="INCLUDE THE '" + N$(Z) +"' FIELD"
1210   GOSUB 4500
1220   IF I$="NO" THEN 790
1230 '     - COMMON ROUTINE -
1235 H(8)=Z
1240 N$(Y)=N$(Z)
1250 IF F$(2)="MERG" THEN 1390
1255 IF Z=F1 THEN 1300
1260 IF N(1,Z)=0 THEN 1330
1270 PRINT "EDIT BY LIST";
1280 INPUT I$
1290 IF I$="NO" THEN 1330
1300 F(3,Y)=1
1310 H(4)=H(4)+1
1320   GO TO 1390
1330 IF N(2,Z)=0 THEN 1390
1340 PRINT "EDIT BY RANGE";
1350 INPUT I$
1360 IF I$="NO" THEN 1390
1370 F(3,Y)=2
1380 H(5)=H(5)+1
1390 F(4,Y)=N(4,Z)
1400 F(1,Y)=Y
1410 F(2,Y)=Z
1420 F(5,Y)=N(5,Z)
1430 F(6,Y)=N(6,Z)
1440 '     - MORE USER DEFINED -
1450 IF F(5,Y)>0 THEN 1550
1460 PRINT "FIELD'S FORMAT (NUMERIC, TEXT, DATE OR DOLLAR)";
1470 INPUT I$
1480 FOR J=1 TO 4
1490   IF I$=T$(J) THEN 1520
1500 NEXT J
1510 GO TO 1460
1520 F(5,Y)=J
1522 ON F(5,Y) GO TO 1524,1530,1530,1540
1524 F(4,Y)=13
1526   GO TO 1550
1530 F(4,Y)=9
1535   GO TO 1550
1540 F(4,Y)=2
1550 '     - LENGTH (COMMON) -
1560 IF Z=F1 THEN 1630
1570 IF F(5,Y)<>3 GO TO 1580
1572   F(6,Y)=6
1574   GO TO 1630
1580 PRINT "MAXIMUM NUMBER OF CHARACTERS";
1590 INPUT F(6,Y)
1600 IF F(6,Y)<=N(6,Z) THEN 1630
1610 PRINT "MAX ALLOWED IS ";N(6,Z)
1620   GO TO 1580
1630   F(13,Y)=H(6)+3
1640   H(6)=H(6)+F(6,Y)
1650 F(9,Y)=1
1660 F(7,Y)=LEN(N$(Z))
1665 '     - PICTURES -
1670 F(8,Y)=F(6,Y)
1672 IF Z<>F1 THEN 1680
1674   F(8,Y)=G1
1676   GO TO 1730
1680 IF F(5,Y)<>3 THEN 1710
1690   F(8,Y)=8
1700   GO TO 1730
1710 IF F(5,Y)<>4 THEN 1730
1720   F(8,Y)=1+F(6,Y)+INT((F(6,Y)-4)/3)
1730 '     - HEADINGS -
1740 PRINT "HEADINGS MAY BE UP TO ";F(8,Y);" CHARACTERS LONG"
1750 N$(Y+2*O9)=""
1760 FOR J=1 TO 2
1770   PRINT TAB(2);"HEADING ";J;
1780   INPUT R$
1790   IF LEN(R$)<=F(8,Y) GO TO 1820
1800     PRINT "TOO LONG"
1810     GO TO 1770
1820   IF LEN(R$)=F(8,Y) GO TO 1840
1830     R$=R$+SPACE$(F(8,Y)-LEN(R$))
1840   N$(Y+2*O9)=N$(Y+2*O9)+R$
1850 NEXT J
1860 GO TO 650
1870 REM ========== BUILD LISTS ==============
1880 IF F$(2)="MERG" THEN 2260
1890 IF H(4)=0 THEN 2260
1900 PRINT
1910 PRINT "- LISTS OF LEGAL VALUES -"
1920 PRINT
1930 L=1
1940 PRINT "TYPE 'DONE' TO END A LIST"
1950 FOR Y=1 TO H(3)
1960 IF F(3,Y)<>1 THEN 2250
1970 T1=F(2,Y)
1980 PRINT
1990 PRINT "SUPPLY VALUES FOR '";N$(T1);"' LIST"
1992 IF Y<>F1 THEN 2000
1994   PRINT "TYPE 'ALL' TO TAKE VALUES FROM CHART OF ACCOUNTS"
2000 F(11,Y)=L
2010 IF L<401 THEN 2014
2011 PRINT "*** LIST STORAGE EXCEEDED - CAN'T TAKE MORE VALUES ***"
2012   GO TO 2220
2014 INPUT L$(L)
2015 '   TAKE ALL ACCT'S FROM .COA
2020 IF L$(L)<>"ALL" THEN 2090
2030 IF Y<>F1 THEN 2110
2040   GOSUB 8700
2050   L$(L)=G$(1)
2060   IF S1=1 GO TO 2220
2070     L=L+1
2075     IF L>400 GO TO 2011
2080     GO TO 2040
2090 '   USER LIST
2095 IF L$(L)="DONE" GO TO 2220
2100 R$(Y)=L$(L)
2110   GOSUB 3000		'  EDIT
2120     IF E1<>0 GO TO 2010
2130   L$(L)=R$(Y)
2140 '   CHECK ACCT VS .COA
2141 IF Y<>F1 THEN 2200
2142 IF L$(L)>G$(1) GO TO 2148
2144   SET :4,1
2146   GOSUB 8500
2148 GOSUB 8700
2152   IF L$(L)=G$(1) GO TO 2200
2156 IF S1=0 GO TO 2148
2180 PRINT " * INVALID - NOT ON CHART OF ACCOUNTS - RETYPE *"
2190   GO TO 2010
2200 L=L+1
2210   GO TO 2010
2220 F(12,Y)=L-F(11,Y)
2230 T1=INT(132/F(6,Y))
2240 F(10,Y) = INT( F(12,Y)/T1 + .99 )
2250 NEXT Y
2260 REM ========= WRITE TO FILE =============
2270   O(0)=16
2280 FOR Y=1 TO H(3)
2290   F(14,Y)=1
2300   FOR X=1 TO 16
2310     O(X)=F(X,Y)
2320   NEXT X
2330 GOSUB 6000
2340   CHANGE O TO S1$
2350   S2$ = S1$ + N$(Y)
2360   S3$ = N$(Y+O9) + N$(Y+2*O9)
2370   O$ = S2$ + S3$
2380   GOSUB 4730		'  WRITE TO .STR
2390 NEXT Y
2400 IF F$(2)="MERG" THEN 2840
2410 O(0)=72
2420 FOR Y=1 TO H(3)
2430   IF F(3,Y)<>1 THEN 2550
2440   Z=F(11,Y)
2450   FOR Q=1 TO F(10,Y)
2460      O$=L$(Z)
2470     Z=Z+1
2480     FOR J=2 TO INT(132/F(6,Y))
2490       IF Z>F(12,Y)+F(11,Y)-1 THEN 2520
2500       O$ = O$ + L$(Z)
2510       Z=Z+1
2520     NEXT J
2530   GOSUB 4730		'  WRITE TO .STR
2540   NEXT Q
2550 NEXT Y
2560 REM ======== RANGE DEFINITION =============
2570 IF H(5)=0 THEN 2840
2580 PRINT
2590 PRINT "- DEFINITION OF LEGAL RANGES -"
2600 FOR Y=1 TO H(3)
2610   IF F(3,Y)<>2 THEN 2830
2620   PRINT
2630   PRINT "RANGE FOR '";N$(Y);"'"
2640   PRINT "  LOW VALUE";
2650 INPUT R$(Y)
2660 GOSUB 3000			'  EDIT
2670   IF E1<>0 GO TO 2640
2680 CHANGE R$(Y) TO I
2690   FOR X=1 TO F(6,Y)
2700     O(X+1)=I(X)
2710   NEXT X
2720   PRINT "  HIGH VALUE";
2730 INPUT R$(Y)
2740 GOSUB 3000
2750   IF E1<>0 GO TO 2720
2760 CHANGE R$(Y) TO I
2770   FOR X=1 TO F(6,Y)
2780     O(X+1+F(6,Y))=I(X)
2790   NEXT X
2800   O(0)=1+2*F(6,Y)
2810   O(1)=F(2,Y)
2820   GOSUB 6000
2822   CHANGE O TO O$
2824   GOSUB 4730		'  WRITE TO .STR
2830 NEXT Y
2840 REM ============ DONE ===================
2850 CHAIN F$(10)+F$(9)
2900 REM ====== S U B R O U T I N E S =========
2910 '
3000 REM ------ EDIT ----------
3005 J1=Y		'  FOR DEFSTR
3010 E1=0
3020 E1$="-"
3030 CHANGE R$(J1) TO T
3040 L6=F(6,J1)
3050 IF F(5,J1)<>3 GO TO 3070
3060   L6=8
3070 REM    - START -
3080 REM
3090 REM     - $ FIELD -
3100 IF F(5,J1)<>4 GO TO 3300
3110 IF T(T(0))=ASC(-) GO TO 3160
3120 IF T(T(0))=ASC(+) GO TO 3150
3130 IF T(T(0))=32     GO TO 3150
3140   T(0)=T(0)+1
3150   T(T(0))=32
3160 IF T(0)<4 GO TO 3270
3170 IF T(T(0)-3)<>ASC(.) GO TO 3270
3180 FOR K1=T(0)-3 TO T(0)
3190   T(K1)=T(K1+1)
3200 NEXT K1
3210 T(0)=T(0)-1
3260   GO TO 3300
3270 E1$="NO DECIMAL"
3280   GO TO 4120
3290 REM
3300 REM     - LENGTH -
3310 IF F(5,J1)=3 GO TO 3380
3320 IF T(0)>L6 GO TO 3350
3330 IF T(0)<F(9,J1) GO TO 3350
3340   GO TO 3380
3350 E1$="INCORRECT LENGTH"
3360   GO TO 4120
3370 REM
3380 REM     - FILL -
3390 IF T(0)>=L6 GO TO 3560
3400   D=L6-T(0)
3410   IF F(5,J1)=2 GO TO 3500
3420 REM    "0"
3430 FOR K1=L6 TO 1 STEP -1
3440   IF K1<=D GO TO 3470
3450   T(K1)=T(K1-D)
3460     GO TO 3480
3470   T(K1)=ASC(0)
3480 NEXT K1
3490 GO TO 3540
3500 REM    " "
3510 FOR K1=T(0)+1 TO L6
3520   T(K1)=32
3530 NEXT K1
3540 T(0)=L6
3550 REM
3560 REM     - DATE -
3570 IF F(5,J1)<>3 GO TO 3790
3580 IF T(6)<>ASC(-) GO TO 3760
3590 IF T(3)= ASC(-) GO TO 3650
3600 IF T(4)<>ASC(-) GO TO 3760
3610   FOR K1=1 TO 3
3620     T(K1)=T(K1+1)
3630   NEXT K1
3640   T(4)=ASC(0)
3650 IF T(1)> ASC(1) GO TO 4120
3660 IF T(4)> ASC(3) GO TO 4120
3670 IF T(7)<>ASC(7) GO TO 4120
3680 T(6)=T(5)
3690 T(5)=T(4)
3700 T(4)=T(2)
3710 T(3)=T(1)
3720 T(1)=T(7)
3730 T(2)=T(8)
3740 T(0)=6
3750   GO TO 3790
3760 E1$="USE FORM 'MM-DD-YY'"
3770   GO TO 4120
3780 REM
3790 REM     - NUMERIC -
3800 IF F(5,J1)=2 GO TO 3910
3810 T1=T(0)
3820 IF F(5,J1)<>4 GO TO 3840
3830   T1=T1-1
3840 FOR K1=1 TO T1
3850   IF T(K1)>ASC(9) GO TO 3890
3860   IF T(K1)<ASC(0) GO TO 3890
3870 NEXT K1
3880   GO TO 3910
3890 E1$="NON-NUMERIC CHARACTER"
3900   GO TO 4120
3910 GO TO 4140
4110 '
4120 PRINT N$(J1);" IN ERROR - ";E1$;" - RE-TYPE LINE"
4130 E1=1
4140 CHANGE T TO R$(J1)
4150 RETURN
4500 REM ------ YES/NO -------
4510 PRINT
4520 PRINT Q$;
4530 INPUT I$
4540   IF I$="YES" GO TO 4580
4550   IF I$="NO" GO TO 4580
4560 PRINT "PLEASE ANSWER 'YES' OR 'NO'"
4570   GO TO 4500
4580 RETURN
4600 REM -------- STR$ ------------
4610 FOR I=T(0) TO 1 STEP -1
4620   T2=V1-INT(V1/10)*10
4630   T(I)=ASC(0)+T2
4640   V1=INT(V1/10)
4650 NEXT I
4660 RETURN
4730 REM --------- WRITE TO .STR ----------
4735 WRITE :1: O$
4740 FOR X=1 TO 72
4750   O(X)=0
4760 NEXT X
4770   RETURN
6000 REM --- KLUDGE CHAR SET FOR PDP-10 ---
6010 FOR K1=1 TO O(0)
6020   IF O(K1)>13 GO TO 6040
6030     O(K1)=100+O(K1)
6040 NEXT K1
6050 RETURN
6100 REM ---- UNKLUDGE PDP-10 CHARS -----
6110 FOR K1=1 TO I(0)
6120   IF I(K1)<100 GO TO 6140
6130     I(K1)=I(K1)-100
6140 NEXT K1
6150 RETURN
8500 REM ----- READ .COA HEADER ---------
8510 S1=0
8520 GOSUB 8900
8521 G1$=I$
8522 S$=G1$
8524 G2$=MID$(S$,37+8*(G4-G6),8)
8530 CHANGE G1$ TO I
8535 GOSUB 6100
8540 G1=I(10)
8550 G2=I(11)
8560 G3=I(12)
8570 G4=I(13)
8580 G5=I(14)
8590 G6=I(15)
8600 G7=I(16)
8610 SET :4, LOC(4)+1
8690 RETURN
8700 REM ----- READ .COA RECORD -----------
8705 SET :4, LOC(4)+G7
8710 IF LOC(4)<=LOF(4) GO TO 8800
8720   S1=1
8730   GO TO 8890
8800 GOSUB 8900
8830 G$(1)=LEFT$(I$,8)
8840 G$(2)=MID$(I$,10,4)
8850 G$(3)=MID$(I$,14,10)
8860 G$(4)=MID$(I$,24,G2)
8870 GOSUB 8900
8880 G$(5)=I$
8890 RETURN
8900 '   SPECIAL READ WITH RE-TRY
8910 READ :4: I$
8920 SET :4, LOC(4)-1
8930 READ :4: I2$
8940 IF I$=I2$ GO TO 8990
8960   SET :4, LOC(4)-1
8970   GO TO 8910
8990 RETURN
9999 END
    