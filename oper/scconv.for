C  PROGRAM SCCONV; SUBROUTINE SCANTM; SUBROUTINE CPCERR
C
C
C
C ***********************************************************
C           THIS PROGRAM IS PART OF THE SCANER-10 SYSTEM
C ***********************************************************
C 
C (AUTHOR) SAM COHEN    5/17/73         VERSION         000001 000000
C MODIFIED FROM CPCONV BY JON SHEPHERD
C
C*
C ***********************************************************
C
C
        IMPLICIT INTEGER (A-Z)
        DIMENSION LXTIDX(512)
C
C
        COMMON/CPLIST/LIST(20) /CPLIDX/LSTIDX(0/4)

        COMMON/ZLISTJ/ITOTCNT,ZLIST(1000),ZTERM(101),ZMATCH(101)
     +  ,ZTOKE(101),ZSIZE(101),IZLCNT,NENTRY,ZPOS(101),ZCHARS(101)
C
C
        COMMON/CPGLOB/ KURSOR, LINSIZ, NATCH, INLINE(270), ISTTY,
     1          HUSH, UNCOLA, IPROMP, IDFILE(5)
        LOGICAL  ISTTY, HUSH, UNCOLA, FETCHL, LOOKFN, KANDO,L
C
C
C
C
        IDUNIT = 1
        IZLCNT=1
        ITOTCNT=1
        NENTRY=0
C
100     CALL CPINIT
C DO NOT WANT KEYWORD DICTIONARY ECHOED ON TERMINAL, SO:
        HUSH=.TRUE.
210     TYPE 201
201     FORMAT(' ENTER OUTPUT FILE ID: '$)
300     IF(.NOT. FETCHL(NOARGS)) GO TO 210
400     IF(LOOKFN(NOARGS)) GO TO 410
        TYPE 401
401     FORMAT('+INVALID FILENAME.',/)
        GO TO 210
410     GO TO (430,420,420,420,420,440,423,421,422,423,423),IOTEST(0)
421     TYPE 9421
9421    FORMAT('+INVALID USERNAME.',/)
        GO TO 210
422     TYPE 9422
9422    FORMAT('+FILE BUSY.',/)
        GO TO 210
420     TYPE 9420
9420    FORMAT ('+FILE PROTECTED.',/)
        GO TO 210
423     TYPE 9423
9423    FORMAT('+SYSTEM ERROR.',/)
        GO TO 210
C
430     TYPE 9430
9430    FORMAT(' NEW FILE - OK? '$)
        IF (.NOT. FETCHL(0)) GO TO 430
        IF(NOWCH(4,K) .NE. 5HY    ) GO TO 210
        GO TO 450
C
440     TYPE 9440
9440    FORMAT(' EXISTING FILE - OK? '$)
        IF (.NOT. FETCHL(0)) GO TO 440
        IF(NOWCH(4,K) .NE. 5HY    ) GO TO 210
C
450     OPEN(IDUNIT,IDFILE,OUTPUT)
C
C
C
C
C
C AT THIS POINT THE OUTPUT FILE HAS BEEN OPENED.
C
C
C
800     TYPE 801
801     FORMAT(' ENTER NAME OF KEYWORD DICTIONARY (INPUT) FILE,'/
     +  ' FOLLOWED BY TWO CARRIAGE RETURNS: ',$)
900     IF(.NOT.FETCHL(0)) GO TO 800
1000    IF(LOOKFN(0)) GO TO 1010
        TYPE 1001
1001    FORMAT(' INVALID FILENAME.' )
        GO TO 800
C
C NOW HAVE VALID FILENAME; BEGIN CODE TO INSERT "." IF NO
C EXTENSION IS SPECIFIED, SO THAT CPDO CAN BE CALLED WITHOUT 
C INSERTING THE NORMAL ".CMD" DEFAULT EXTENSION.
C
1010    KURSAV=KURSOR
        DO 1020 I=1,250
        J=LASTCH(8,KANDO)
        IF((.NOT.KANDO).OR.(J .EQ. 5H)    )) GO TO 1030
        IF (J .EQ. 5H.    ) GO TO 1100
1020    CONTINUE
1030    INLINE(KURSAV)="56
        INLINE(KURSAV+1)=0
C
1100    KURSOR=1
        CALL CPDO(0)
C
C IF INPUT FILE IS OPEN, ISTTY SHOULD BE .FALSE.
        IF(ISTTY) GO TO 800
C
C NEED EXTRA C.R. IN TTY INPUT BUFFER TO SATISFY FETCHL
C (SEE FETCHL SPECS)... ELSE FETCHL WILL WAIT FOR ENTRY
        TYPE 1151
1151    FORMAT(' NOW PROCESSING... ')
C
C
C OUTPUT THE SFE TO GHE FILE
        WRITE(1,4001)
        WRITE(1,4002)
        WRITE(1,4003)
        WRITE(1,4004)
        WRITE(1,4005)
        WRITE(1,4006)
        WRITE(1,4007)
        WRITE(1,4008)
        WRITE(1,4009)
        WRITE(1,4010)
        WRITE(1,4011)
        WRITE(1,4012)
        WRITE(1,4013)
        WRITE(1,4014)
        WRITE(1,4015)
        WRITE(1,4016)
        WRITE(1,4017)
        WRITE(1,4018)
        WRITE(1,4019)
        WRITE(1,4020)
4001    FORMAT('0010020801')
4002    FORMAT('TELETYPE')
4003    FORMAT('0010020801')
4004    FORMAT('TERMINAL')
4005    FORMAT('0010000301')
4006    FORMAT('YES')
4007    FORMAT('0020000201')
4008    FORMAT('NO')
4009    FORMAT('0010000301')
4010    FORMAT('OLD')
4011    FORMAT('0020000301')
4012    FORMAT('NEW')
4013    FORMAT('0010020303')
4014    FORMAT('ALL')
4015    FORMAT('0010020404')
4016    FORMAT('SAME')
4017    FORMAT('0010020303')
4018    FORMAT('NOT')
4019    FORMAT('0010020404')
4020    FORMAT('HELP')

C
        WRITE(1,5001)
        WRITE(1,5002)
        WRITE(1,5003)
        WRITE(1,5004)
        WRITE(1,5005)
        WRITE(1,5006)
        WRITE(1,5007)
        WRITE(1,5008)
        WRITE(1,5009)
        WRITE(1,5010)
        WRITE(1,5011)
        WRITE(1,5012)
        WRITE(1,5013)
        WRITE(1,5014)
        WRITE(1,5015)
        WRITE(1,5016)
        WRITE(1,5017)
        WRITE(1,5018)
        WRITE(1,5019)
        WRITE(1,5020)
        WRITE(1,5021)
        WRITE(1,5022)
        WRITE(1,5023)
        WRITE(1,5024)
        WRITE(1,5025)
        WRITE(1,5026)
        ITOTCNT=58
5001    FORMAT('0010000701')
5002    FORMAT('VERSION')
5003    FORMAT('0020000702')
5004    FORMAT('CREDITS')
5005    FORMAT('0030000702')
5006    FORMAT('CHARGES')
5007    FORMAT('0040001202')
5008    FORMAT('CAPABILITIES')
5009    FORMAT('0050001202')
5010    FORMAT('INSTRUCTIONS')
5011    FORMAT('0060000101')
5012    FORMAT('?')
5013    FORMAT('0060000402')
5014    FORMAT('HELP')
5015    FORMAT('0070000201')
5016    FORMAT('DO')
5017    FORMAT('0080000402')
5018    FORMAT('HUSH')
5019    FORMAT('0090000701')
5020    FORMAT('NO HUSH')
5021    FORMAT('0100000402')
5022    FORMAT('TYPE')
5023    FORMAT('0110000702')
5024    FORMAT('INCLUDE')
5025    FORMAT('0120000402')
5026    FORMAT('TOUT')

1200    DTERM=-1
        DMATCH=-1
C
C
C
1300    L=FETCHL(0)
        IF(ISTTY) CALL CPCERR(1)
        IF(.NOT. L) GO TO 1300
C PARSE FOR !DICTIONARY LINE.
        IF (NOWCH(4,K) .NE. 5H!    ) CALL CPCERR(2)
        KURSOR=KURSOR+1
        IF (LPARSE(1) .NE. 1) CALL CPCERR(2)
C NOW RECOGNIZED "!DICTIONARY"
        IF (NOWCH(4,KANDO) .NE. 5H!    ) GO TO 1320
        KURSOR=KURSOR+1
        CALL SCANTM(DTERM,DMATCH)
        GO TO 1390
1320    IF(KANDO) CALL CPCERR(12)
1390    LCNT=0
        JINDEX=1
C "!DICTIONARY" LINE NOW PROCESSED.
C
C
C
C READ IN A LINE.
1400    L=FETCHL(0) 
        IF(ISTTY) GO TO 1800
        IF(.NOT. L) GO TO 1400
C NOW HAVE A NON-EMPTY LINE; CHECK FOR "!LIST".
1500    IF (NOWCH(4,KANDO) .NE. 5H!    ) GO TO 1700
        KURSOR=KURSOR+1
        IF(LPARSE(1) .NE. 2) CALL CPCERR(13)
C NOW HAVE "!LIST"
C
C
C PROCESS END OF LAST LIST (UNLESS THIS IS THE FIRST).
1600    NATCHN=NATCHN+1
C PROCESS BEGINNING OF NEW LIST
        IF(LCNT.NE.0) CALL LISTPR(LCNT,LXTIDX)
        LXTIDX(LCNT+1)=ITOTCNT
        NATCHN=0
        TCNT=0
        LCNT=LCNT+1
        TYPE 1611, LCNT
1611    FORMAT(' LIST ',I3)
        LTERM=DTERM
        LMATCH=DMATCH
        IF(LOOKIN(INTGER) .NE. 2) CALL CPCERR(14)
        IF(INTGER .NE. LCNT) CALL CPCERR(14)
        CALL NEXTCH(5,KANDO)
        IF(NOWCH(4,KANDO) .NE. 5H!    ) GO TO 1620
        KURSOR=KURSOR+1
        CALL SCANTM(LTERM,LMATCH)
        GO TO 1400
1620    IF(KANDO) CALL CPCERR(12)
        GO TO 1400
C FINISHED PROCESSING BEGINNING OF NEW LIST
C
C
C   ***********************************************
C PROCESS KEYWORD DEFINITION LINE.
C
1700    IF (LCNT .EQ. 0) CALL CPCERR(15)
        TCNT=TCNT+1
1710    IF(NEXTCH(4,KANDO) .EQ. 5H!    ) GO TO 1711
        IF(KANDO) GO TO 1710
        CALL CPCERR(16)
1711    KBANG=KURSOR
        KURSOR=KURSOR+1
        IF(LOOKIN(TOKNUM) .NE. 2) CALL CPCERR(17)
        IF ((TOKNUM .LT. 1) .OR. (TOKNUM .GT. 500))  CALL CPCERR(17)
        NATCHN=MAX0(NATCHN,TOKNUM)
        CALL SCANTM (TTERM, TMATCH)
C
1720    KURSOR=1
        CALL NOWCH(1,KANDO)
        KBEGIN=KURSOR
1730    KURSOR=KBANG
        CALL LASTCH(1,KANDO)
        KEND=KURSOR
        NUMCHS=KEND-KBEGIN+1
        IF(NUMCHS .GT. 63) CALL CPCERR(20)
        ITEMSZ=1+ (NUMCHS+4)/5
        INDEX1=JINDEX
        JINDEX=JINDEX+ITEMSZ
        INDEX2=JINDEX-1
C
C
C
C
C
1740    DO 1742 KURSOR=KEND+1,KEND+4
1742    INLINE(KURSOR)=5H     
C
1750    TERM=TTERM
        IF(TERM.EQ.-1) TERM=LTERM
        IF(TERM.EQ.-1) TERM=DTERM
        IF(TERM.EQ.-1) CALL CPCERR(18)
C
        IF(LMATCH.EQ.0) GO TO 1755
        MATCH=TMATCH
        IF(MATCH.EQ.-1) MATCH=LMATCH
        IF(MATCH.EQ.-1) MATCH=DMATCH
        IF(MATCH.EQ.-1) CALL CPCERR(19)
C
        IF(MATCH.GT.63) MATCH=NUMCHS
        GO TO 1760
C
1755    IF(TMATCH.NE.-1) CALL CPCERR(21)
        MATCH=0
C NOTE THAT CPSORT WILL ADJUST THESE MATCH NUMBERS AT A LATER TIME.
C
1760    DOPEWD=TERM.OR.(ITEMSZ*"100000000).OR.(MATCH*"1000).OR.TOKNUM
C
1770    CALL INSTOK(TOKNUM,MATCH,ITEMSZ,TERM,KBEGIN,KEND,LCNT)
        GO TO 1400
C
C
C
C  *******************************************************
C
C
1800    CALL LISTPR(LCNT,LXTIDX)
C
C WRITE OUT LIST ADDRESSES
        WRITE(1,1801)
        WRITE(1,1802)
        WRITE(1,1803)
        WRITE(1,1804)
        WRITE(1,1805)
1801    FORMAT('1')
1802    FORMAT('7')
1803    FORMAT('11')
1804    FORMAT('15')
1805    FORMAT('23')
C
        DO 1810 I=1,LCNT
1810    WRITE (1,1811) LXTIDX(I)
1811    FORMAT(I5)
C
        TYPE 1850,ITOTCNT,LCNT
1850    FORMAT(/' DIMENSION LIST >=',I4,'   LSTIDX >= (-4:',I3,')'/)
        CALL EXIT
        END

        BLOCK DATA
C
        COMMON/CPLIST/LIST(20) /CPLIDX/LSTIDX(0/4)
        DATA (LIST(I), I=1,20) / 
     +  "400300001001, 5HDICTI, 5HONARY,
     +  "400200001002, 5HLIST ,
     +  "400300001001, 5HTERMI, 5HNATOR,
     +  "400200001002, 5HMATCH,
     +  "400200001001, 5HBLANK,
     +  "400200002002, 5HALPHA,
     +  "400200001003, 5HNONAL,
     +  "400200003004, 5HANY  ,
     +  "400200001001, 5HEXACT /
        DATA (LSTIDX(I), I=0,4) /
     +  4,
     +  "003002000001,
     +  "003002000006,
     +  "005004000013,
     +  "002001000023 /
C
        END



        SUBROUTINE SCANTM (TERM, MATCH)
        IMPLICIT INTEGER (A-Z)
C
C SCANS AND PROCESSES TERMINATOR AND MATCH DECLATRATIONS,
C RETURNING VALUES IN THE PARAMETERS.  IF NONE ARE FOUND IN THE 
C SCANNED LINE, THE PARAMS ARE RETURNED = -1.  NOTE: MATCH IS A
C SIMPLE INTEGER VALUE, BUT TERM IS A BINARY CONSTANT IN THE PROPER
C FORMAT FOR 'OR'ING INTO THE DOPE WORD IN LIST, WITHOUT SHIFTING.
C
C
C
        COMMON/CPGLOB/ KURSOR, LINSIZ, NATCH, INLINE(270), ISTTY,
     1          HUSH, UNCOLA, IPROMP, IDFILE(5)
        LOGICAL K
C
        TERM = -1
        MATCH = -1
C
        GO TO (10,20,100,200), (LPARSE(2) +2)
C INVALID STRING FOUND
10      CALL CPCERR (3)
C NULL LINE
20      RETURN
C "TERMINATOR"
100     GO TO (101,105,110,120,130,140,190), (LPARSE(3)+2)
C CHECK FOR QUOTED SPECIAL CHARACTER
101     IF((NOWCH(4,K).NE.5H'    ).AND.(NOWCH(4,K).NE.5H"    ))
     +  CALL CPCERR(4)
        TERM= (NEXTCH(5,K))
        IF(.NOT.K) CALL CPCERR(4)
        CALL NEXTCH(5,KANDO)
        IF((NOWCH(8,K).NE.5H'    ).AND.(NOWCH(8,K).NE.5H"    ))
     +  CALL CPCERR(5)
        GO TO 195
C
C NULL LINE
105     CALL CPCERR(6)
C "BLANK"
110     TERM=0
        GO TO 195
C "ALPHA"
120     TERM=1
        GO TO 195
C "NONAL"
130     TERM=2
        GO TO 195
C "ANY"
140     TERM=3
        GO TO 195
C "A" OR "AN"
190     CALL CPCERR(7)
C
C AFTER TERMINATOR DECLARATION, CHECK FOR NULL OR MATCH DECLARATION.
195     CALL NEXTCH(5,KANDO)
        GO TO (196,197,198,200), (LPARSE(2)+2)
C INVALID ITEM
196     CALL CPCERR(3)
C NULL LINE
197     RETURN
C "TERMINATOR" AGAIN
198     CALL CPCERR(8)
C
C
C "MATCH"
200     GO TO (210,220,230),(LPARSE(4)+2)
C DID NOT FIND "EXACT"; LOOK FOR A NUMBER
210     IF(LOOKIN(MATCH) .NE. 2) CALL CPCERR(9)
C MAKE SURE NOTHING FOLLOWS
211     IF (NOWCH(1,K) .NE. 0) CALL CPCERR(10)
        RETURN
C NOTHING FOLLOWS "MATCH"
220     CALL CPCERR(11)
C "EXACT"... USE SPECIAL VALUE OF 100
230     MATCH = 100
        GO TO 211
        END



        SUBROUTINE CPCERR (KODE)
C
C
        COMMON/CPGLOB/ KURSOR, LINSIZ, NATCH, INLINE(270), ISTTY,
     1          HUSH, UNCOLA, IPROMP, IDFILE(5)
C
C
        GO TO (921,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,
     +  18,19,20,21,22), KODE+1
C
1       TYPE 101
        GO TO 900
2       TYPE 102
        GO TO 900
3       TYPE 103
        GO TO 900
4       TYPE 104
        GO TO 900
5       TYPE 105
        GO TO 900
6       TYPE 106
        GO TO 900
7       TYPE 107
        GO TO 900
8       TYPE 108
        GO TO 900
9       TYPE 109
        GO TO 900
10      TYPE 110
        GO TO 900
11      TYPE 111
        GO TO 900
12      TYPE 112
        GO TO 900
13      TYPE 113
        GO TO 900
14      TYPE 114
        GO TO 900
15      TYPE 115
        GO TO 900
16      TYPE 116
        GO TO 900
17      TYPE 117
        GO TO 900
18      TYPE 118
        GO TO 900
19      TYPE 119
        GO TO 900
20      TYPE 120
        GO TO 900
21      TYPE 121
        GO TO 900
22      TYPE 122
        GO TO 900
C
C
101     FORMAT(/' E1: EOF BEFORE 1ST NON-NULL LINE.')
102     FORMAT(/' E2: FIRST LINE NOT "!DICTIONARY".')
103     FORMAT(/' E3: UNRECOGNIZED ITEM IN DECLARATIONS SECTION.')
104     FORMAT(/' E4: UNRECOGNIZED ITEM AFTER "TERMINATOR".')
105     FORMAT(/' E5: QUOTED TERMINATOR NOT A SINGLE CHARACTER.')
106     FORMAT(/' E6: NOTHING FOLLOWS "TERMINATOR".')
107     FORMAT(/' E7: MINIMUM ABBREVIATIONS FOR "ALPHA" AND "ANY" ARE ',
     +  /,'     "AL" AND "ANY", RESPECTIVELY.')
108     FORMAT(/' E8: DUPLICATE TERMINATOR DECLARATIONS.')
109     FORMAT(/' E9: UNRECOGNIZED ITEM AFTER "MATCH".')
110     FORMAT(/' E10: NON-BLANK ITEM FOLLOWS MATCH DECLARATION.')
111     FORMAT(/' E11: NOTHING FOLLOWS "MATCH".')
112     FORMAT(/' E12: MISSING "!" OR INVALID ITEM IN HEADER LINE.')
113     FORMAT(/' E13: MISSING KEYWORD OR EXTRANEOUS "!".')
114     FORMAT(/' E14: MISSING OR UNSEQUENCED LIST NUMBER.')
115     FORMAT(/' E15: "!LIST" HEADER MISSING.')
116     FORMAT(/' E16: MISSING "!" IN KEYWORD DEFINITION LINE.')
117     FORMAT(/' E17: MISSING OR INVALID KEYWORD NUMBER.')
118     FORMAT(/' E18: NO TERMINATOR ASSIGNMENT FOR KEYWORD.')
119     FORMAT(/' E19: NO MATCH ASSIGNMENT FOR KEYWORD.')
120     FORMAT(/' E20: OVER 63 CHARACTERS IN KEYWORD.')
121     FORMAT(/' E21: ATTEMPT TO OVERRIDE "MATCH 0" FEATURE.')
122     FORMAT(/' E22: DICTIONARY OR LIST IS EMPTY.')
C
C
900     TYPE 901
901     FORMAT('     ...LAST LINE PROCESSED:'/)
        DO 910 KURSOR=1,LINSIZ
910     INLINE(KURSOR)=NOWCH(8,K)
        TYPE 920, (INLINE(I),I=1,LINSIZ)
920     FORMAT(1X,270A1,/)
921     TYPE 930
930     FORMAT(/'  *** RUN ABORTED ***',/)
        CALL EXIT
        END
        SUBROUTINE INSTOK(TOKNUM,MATCH,ITEMSZ,TERM,KBEGIN,KEND,LCNT)

        IMPLICIT INTEGER (A-Z)
        DIMENSION SHIFT(5)
        DATA SHIFT/29,22,15,8,1/
        DIMENSION IB(5)
        DATA IB/"0,"1004020100,"4020100,"20100,"100/
C
C
        COMMON/CPGLOB/KURSOR,LINSIZ,NATCH,INLINE(270),ISTTY,HUSH,UNCOLA
     +  ,IPROMP,IDFILE(5)
        LOGICAL ISTTY,HUSH,UNCOLA
C
        COMMON/ZLISTJ/ITOTCNT,ZLIST(1000),ZTERM(101),ZMATCH(101)
     +  ,ZTOKE(101),ZSIZE(101),IZLCNT,NENTRY,ZPOS(101),ZCHARS(101)

C INSERTS THE NEW TOKEN INTO ITS CORRECT (SORTED) PLACEE IN
C THIS LIST.
C
C
C IZLCNT IS THE COUNT OF ITEMS IN THE CURRENT LIST
C ITOTCNT IS THE CCOUNT OF ALL ITEMS IN ALL LISTS.
C
C
C
        NENTRY=NENTRY+1
C
        ZCHARS(NENTRY)=KEND-KBEGIN+1
        ZTERM(NENTRY)=TERM
        ZMATCH(NENTRY)=MATCH
        ZSIZE(NENTRY)=ITEMSZ
        ZTOKE(NENTRY)=TOKNUM
        ZPOS(NENTRY)=IZLCNT
C
CPACK ACTUAL ENTRY INTO TRY
C

        N=1
        DO 5 I= KBEGIN,KEND
        L=INLINE(I)
        L=LSH(L,SHIFT(N))
        ZLIST(IZLCNT)=ZLIST(IZLCNT)+L
        N=N+1
        IF(N.LE.5) GO TO 5
        N=1
        IZLCNT=IZLCNT+1
        ITOTCNT=ITOTCNT+1
5       CONTINUE
C
        IF(N.EQ.1) RETURN
C
C       BLANK FILL THE WORD
C
        ZLIST(IZLCNT)=ZLIST(IZLCNT)+IB(N)
C
        IZLCNT=IZLCNT+1
        ITOTCNT=ITOTCNT+1
        RETURN
        END
C
        SUBROUTINE LISTPR(LCNT,LXTIDX)
C
C
C OUTPUTS A COMPLETE LIST TO THE FILE. ALSO TAKES CARE OF MATCH 0
C BY ASSIGNING THE NATURAL MATCH TO ALL TOKENS IN THE LIST IF SO
C DESIRED.
C
C
        DIMENSION LXTIDX(1)

C
C
        COMMON/ZLISTJ/ITOTCNT,ZLIST(1000),ZTERM(101),ZMATCH(101)
     +  ,ZTOKE(101),ZSIZE(101),IZLCNT,NENTRY,ZPOS(101),ZCHARS(101)

        IMPLICIT INTEGER (A-Z)
C
C
        IF(NENTRY.GT.0) GO TO 5
        TYPE 1
1       FORMAT(' ** NULL LIST **')
        LXTIDX(LCNT)=0
        RETURN
C
C
5       IF(ZMATCH(1).NE.0) GO TO 200
C
C
C TAKE CARE OF MATCH 0 HERE
C
C
        CALL MATCH0(LCNT)
C
C SHOULD NOW BE ALL OK
C
200     L=1
        DO 300 I=1,NENTRY
C
C
C
C
C
C
C WRITE TOKEN NUMBER (EVERYTHING IS WRITTEN WITH LEADING ZEROS)
C
2049    IF(ZTOKE(I).LT.100) GO TO 2050
        WRITE(1,201),ZTOKE(I)
        GO TO 2200
2050    IF(ZTOKE(I).LT.10) GO TO 2100
        WRITE(1,206),ZTOKE(I)
        GO TO 2200
2100    WRITE(1,211),ZTOKE(I)
C
C WRITE TERMINATION CHARACTERISTICS
C
2200    IF(ZTERM(I).LT.100) GO TO 205
        WRITE(1,201),ZTERM(I)
201     FORMAT(I3,$)
        GO TO 220
205     IF(ZTERM(I).LT.10) GO TO 210
        WRITE(1,206),ZTERM(I)
206     FORMAT('0',I2,$)
        GO TO 220
210     WRITE(1,211),ZTERM(I)
211     FORMAT('00',I1,$)
C
C WRITE SIZE
C
220     IF(ZCHARS(I).LT.10) GO TO 225
        WRITE(1,221),ZCHARS(I)
221     FORMAT(I2,$)
        GO TO 230
225     WRITE(1,226),ZCHARS(I)
226     FORMAT('0',I1,$)
C
C WRITE MATCH NUMBER
C
230     IF(ZMATCH(I).LT.10) GO TO 235
        WRITE(1,231),ZMATCH(I)
231     FORMAT(I2)
        GO TO 240
235     WRITE(1,236),ZMATCH(I)
236     FORMAT('0',I1)
C
C WRITE ACTUAL ENTRY
C
C
C
240     WRITE(1,251),(ZLIST(J),J=L,L+ZSIZE(I)-2)
251     FORMAT(20A5,$)
C
        L=L+ZSIZE(I)-1
C
C
C
300     CONTINUE
C
C CLEAR ZLIST
C
        DO 500 I=1,1000
500     ZLIST(I)=0
        ITOTCNT=ITOTCNT+NENTRY
        NENTRY=0
        IZLCNT=1
C
        RETURN
        END
C
        SUBROUTINE MATCH0(LCNT)
C
        IMPLICIT INTEGER (A-Z)
C TAKES CARE OF MATCH 0 SPECIFICATION WHICH IMPLIES THAT ALL ENTRIES
C IN THIS LIST ARE TO TAKE ON THEIR NATURAL MATCHES.
C
        COMMON/ZLISTJ/ITOTCNT,ZLIST(1000),ZTER),ZMATCH(101)
     +  ,ZTOKE(101),ZSIZE(101),IZLCNT,NENTRY,ZPOS(101),ZCHARS(101)
C
C
C IF THERES ONLY ONE ENTRY IN THE LIST THEN SET MATCH=1 AND RETURN
C
        IF(NENTRY.GT.1) GO TO 1
        ZMATCH(1)=1
        RETURN
C
C TAKE EACH CHARACTER OF EACH ENTRY AND COMPARE IT WITH EACH CHAR IN
C THE SAME POSITION FOR ALL ENTRIES.
C
1       DO 1000 I=1,NENTRY
C
        DO 200 J=1,NENTRY
        IF(I.EQ.J) GO TO 200
        NEWM=1
        DO 100 K=1,ZCHARS(I)
        IF(ICHAR(ZLIST(ZPOS(I)),K).NE.ICHAR(ZLIST(ZPOS(J)),K))
     +  GO TO 150
100     NEWM=NEWM+1
C
C IF IT GOT HERE THEN EVERY CHAR MATCHES WITH SOMETHING ELSE SO
C ITS AN AMBIGUITY.
C
        TYPE 201
201     FORMAT(/' LIST ENTRY: '$)
        DO 205 J=ZPOS(I),ZPOS(I)+ZSIZE(J)-1
205     TYPE 206,ZLIST(J)
206     FORMAT(A5,$)
        TYPE 207,LCNT
207     FORMAT(/' CONFLICTS WITH OTHER ENTRIES IN LIST',I3/)
        CALL CPCERR(0)
C
C CHECK FOR INCREASED MATCH
C
150     IF(NEWM.GT.ZMATCH(I)) ZMATCH(I)=NEWM
C
200     CONTINUE
C
C ALL DONE
C
1000    CONTINUE
        RETURN
        END
   pV)Ž